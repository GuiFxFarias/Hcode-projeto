/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={444:(t,e,n)=>{n.d(e,{BH:()=>f,G6:()=>a,L:()=>i,LL:()=>m,P0:()=>h,Sg:()=>p,ZR:()=>g,aH:()=>d,eu:()=>c,hl:()=>u,m9:()=>b,vZ:()=>v,z$:()=>o});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,u=a?t[e+2]:0,c=s>>2,l=(3&s)<<4|o>>4;let h=(15&o)<<2|u>>6,d=63&u;a||(d=64,i||(h=64)),r.push(n[c],n[l],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==o||null==a)throw Error();const u=s<<2|i>>4;if(r.push(u),64!==o){const t=i<<4&240|o>>2;if(r.push(t),64!==a){const t=o<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},i=function(t){return function(t){const e=r(t);return s.encodeByteArray(e,!0)}(t).replace(/\./g,"")};function o(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function a(){return!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function u(){return"object"==typeof indexedDB}function c(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}const l=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},h=t=>{const e=(t=>{var e,n;return null===(n=null===(e=l())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},d=()=>{var t;return null===(t=l())||void 0===t?void 0:t.config};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function p(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}class g extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m.prototype.create)}}class m{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(y,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new g(r,o,n)}}const y=/\{\$([^}]+)}/g;function v(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(w(n)&&w(i)){if(!v(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function w(t){return null!==t&&"object"==typeof t}function b(t){return t&&t._delegate?t._delegate:t}},503:(t,e,n)=>{n.r(e),n.d(e,{FirebaseError:()=>r.ZR,SDK_VERSION:()=>r.Jn,_DEFAULT_ENTRY_NAME:()=>r.l4,_addComponent:()=>r.H9,_addOrOverwriteComponent:()=>r.Vr,_apps:()=>r.Af,_clearComponents:()=>r.Z8,_components:()=>r.lz,_getProvider:()=>r.qX,_registerComponent:()=>r.Xd,_removeServiceInstance:()=>r.wN,deleteApp:()=>r.P2,getApp:()=>r.Mq,getApps:()=>r.C6,initializeApp:()=>r.ZF,onLog:()=>r.TP,registerVersion:()=>r.KN,setLogLevel:()=>r.Ub});var r=n(389);(0,r.KN)("firebase","9.14.0","app")},591:(t,e,n)=>{n.r(e),n.d(e,{AbstractUserDataWriter:()=>mp,AggregateField:()=>Nd,AggregateQuerySnapshot:()=>Fd,Bytes:()=>mf,CACHE_SIZE_UNLIMITED:()=>Zd,CollectionReference:()=>Ed,DocumentReference:()=>bd,DocumentSnapshot:()=>bp,FieldPath:()=>yf,FieldValue:()=>wf,Firestore:()=>Jd,FirestoreError:()=>Sr,GeoPoint:()=>bf,LoadBundleTask:()=>Xd,Query:()=>Id,QueryConstraint:()=>Xf,QueryDocumentSnapshot:()=>Ip,QuerySnapshot:()=>Ep,SnapshotMetadata:()=>wp,Timestamp:()=>Ur,Transaction:()=>$p,WriteBatch:()=>Kp,_DatabaseId:()=>Us,_DocumentKey:()=>zr,_EmptyAppCheckTokenProvider:()=>Rr,_EmptyAuthCredentialsProvider:()=>Ar,_FieldPath:()=>$r,_cast:()=>pd,_debugAssert:()=>Ir,_isBase64Available:()=>xs,_logWarn:()=>yr,_validateIsNotUsedTogether:()=>ld,addDoc:()=>Op,aggregateQuerySnapshotEqual:()=>Up,arrayRemove:()=>Yp,arrayUnion:()=>Wp,clearIndexedDbPersistence:()=>uf,collection:()=>kd,collectionGroup:()=>Sd,connectFirestoreEmulator:()=>wd,deleteDoc:()=>Rp,deleteField:()=>Hp,disableNetwork:()=>hf,doc:()=>_d,documentId:()=>vf,enableIndexedDbPersistence:()=>sf,enableMultiTabIndexedDbPersistence:()=>of,enableNetwork:()=>lf,endAt:()=>hp,endBefore:()=>lp,ensureFirestoreConfigured:()=>nf,executeWrite:()=>Vp,getCountFromServer:()=>qp,getDoc:()=>_p,getDocFromCache:()=>Ap,getDocFromServer:()=>Cp,getDocs:()=>Dp,getDocsFromCache:()=>xp,getDocsFromServer:()=>Np,getFirestore:()=>ef,increment:()=>Xp,initializeFirestore:()=>tf,limit:()=>sp,limitToLast:()=>ip,loadBundle:()=>ff,namedQuery:()=>pf,onSnapshot:()=>Lp,onSnapshotsInSync:()=>Pp,orderBy:()=>np,query:()=>Zf,queryEqual:()=>Ad,refEqual:()=>Td,runTransaction:()=>zp,serverTimestamp:()=>Qp,setDoc:()=>Fp,setIndexConfiguration:()=>Jp,setLogLevel:()=>pr,snapshotEqual:()=>Sp,startAfter:()=>up,startAt:()=>ap,terminate:()=>df,updateDoc:()=>Mp,waitForPendingWrites:()=>cf,where:()=>tp,writeBatch:()=>Zp});var r,s=n(389),i=n(463),o=n(333),a=n(444),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},c={},l=l||{},h=u||self;function d(){}function f(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function v(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function w(t,e,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function I(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Wb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function E(){this.s=this.s,this.o=this.o}E.prototype.s=!1,E.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++m))},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const k=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function S(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function _(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(f(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function T(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",d,e),h.removeEventListener("test",d,e)}catch(t){}return t}();function C(t){return/^[\s\xa0]*$/.test(t)}var D=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function x(t,e){return t<e?-1:t>e?1:0}function N(){var t=h.navigator;return t&&(t=t.userAgent)?t:""}function F(t){return-1!=N().indexOf(t)}function M(t){return M[" "](t),t}M[" "]=d;var R,O,L=F("Opera"),P=F("Trident")||F("MSIE"),V=F("Edge"),B=V||P,U=F("Gecko")&&!(-1!=N().toLowerCase().indexOf("webkit")&&!F("Edge"))&&!(F("Trident")||F("MSIE"))&&!F("Edge"),q=-1!=N().toLowerCase().indexOf("webkit")&&!F("Edge");function j(){var t=h.document;return t?t.documentMode:void 0}t:{var K="",G=(O=N(),U?/rv:([^\);]+)(\)|;)/.exec(O):V?/Edge\/([\d\.]+)/.exec(O):P?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(O):q?/WebKit\/(\S+)/.exec(O):L?/(?:Version)[ \/]?(\S+)/.exec(O):void 0);if(G&&(K=G?G[1]:""),P){var $=j();if(null!=$&&$>parseFloat(K)){R=String($);break t}}R=K}var z,H={};function Q(){return function(t){var e=H;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let t=0;const e=D(String(R)).split("."),n=D("9").split("."),r=Math.max(e.length,n.length);for(let o=0;0==t&&o<r;o++){var s=e[o]||"",i=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;t=x(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||x(0==s[2].length,0==i[2].length)||x(s[2],i[2]),s=s[3],i=i[3]}while(0==t)}return 0<=t}()}()}h.document&&P?z=j()||parseInt(R,10)||void 0:z=void 0;var W=z;function Y(t,e){if(T.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(U){t:{try{M(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:X[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Y.X.h.call(this)}}I(Y,T);var X={2:"touch",3:"pen",4:"mouse"};Y.prototype.h=function(){Y.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Z="closure_listenable_"+(1e6*Math.random()|0),J=0;function tt(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=s,this.key=++J,this.ba=this.ea=!1}function et(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function nt(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function rt(t){const e={};for(const n in t)e[n]=t[n];return e}const st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<st.length;e++)n=st[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){this.src=t,this.g={},this.h=0}function at(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=k(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(et(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ut(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ba&&i.listener==e&&i.capture==!!n&&i.ha==r)return s}return-1}ot.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=ut(t,e,r,s);return-1<o?(e=t[o],n||(e.ea=!1)):((e=new tt(e,this.src,i,!!r,s)).ea=n,t.push(e)),e};var ct="closure_lm_"+(1e6*Math.random()|0),lt={};function ht(t,e,n,r,s){if(r&&r.once)return ft(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)ht(t,e[i],n,r,s);return null}return n=bt(n),t&&t[Z]?t.N(e,n,p(r)?!!r.capture:!!r,s):dt(t,e,n,!1,r,s)}function dt(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=p(s)?!!s.capture:!!s,a=vt(t);if(a||(t[ct]=a=new ot(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){const t=yt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)A||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ft(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ft(t,e[i],n,r,s);return null}return n=bt(n),t&&t[Z]?t.O(e,n,p(r)?!!r.capture:!!r,s):dt(t,e,n,!0,r,s)}function pt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)pt(t,e[i],n,r,s);else r=p(r)?!!r.capture:!!r,n=bt(n),t&&t[Z]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ut(i=t.g[e],n,r,s))&&(et(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=vt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ut(e,n,r,s)),(n=-1<t?e[t]:null)&&gt(n))}function gt(t){if("number"!=typeof t&&t&&!t.ba){var e=t.src;if(e&&e[Z])at(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=vt(e))?(at(n,t),0==n.h&&(n.src=null,e[ct]=null)):et(t)}}}function mt(t){return t in lt?lt[t]:lt[t]="on"+t}function yt(t,e){if(t.ba)t=!0;else{e=new Y(e,this);var n=t.listener,r=t.ha||t.src;t.ea&&gt(t),t=n.call(r,e)}return t}function vt(t){return(t=t[ct])instanceof ot?t:null}var wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function bt(t){return"function"==typeof t?t:(t[wt]||(t[wt]=function(e){return t.handleEvent(e)}),t[wt])}function It(){E.call(this),this.i=new ot(this),this.P=this,this.I=null}function Et(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new T(e,t);else if(e instanceof T)e.target=e.target||t;else{var s=e;it(e=new T(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=kt(o,r,!0,e)&&s}if(s=kt(o=e.g=t,r,!0,e)&&s,s=kt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=kt(o=e.g=n[i],r,!1,e)&&s}function kt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==n){var a=o.listener,u=o.ha||o.src;o.ea&&at(t.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}I(It,E),It.prototype[Z]=!0,It.prototype.removeEventListener=function(t,e,n,r){pt(this,t,e,n,r)},It.prototype.M=function(){if(It.X.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)et(n[r]);delete e.g[t],e.h--}}this.I=null},It.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},It.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var St=h.JSON.stringify;function _t(){var t=Ft;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Tt,At=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ct),(t=>t.reset()));class Ct{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Dt(t){h.setTimeout((()=>{throw t}),0)}function xt(t,e){Tt||function(){var t=h.Promise.resolve(void 0);Tt=function(){t.then(Mt)}}(),Nt||(Tt(),Nt=!0),Ft.add(t,e)}var Nt=!1,Ft=new class{constructor(){this.h=this.g=null}add(t,e){const n=At.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Mt(){for(var t;t=_t();){try{t.h.call(t.g)}catch(t){Dt(t)}var e=At;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Nt=!1}function Rt(t,e){It.call(this),this.h=t||1,this.g=e||h,this.j=w(this.lb,this),this.l=Date.now()}function Ot(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}function Lt(t,e,n){if("function"==typeof t)n&&(t=w(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=w(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function Pt(t){t.g=Lt((()=>{t.g=null,t.i&&(t.i=!1,Pt(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}I(Rt,It),(r=Rt.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Et(this,"tick"),this.ca&&(Ot(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Rt.X.M.call(this),Ot(this),delete this.g};class Vt extends E{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Pt(this)}M(){super.M(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bt(t){E.call(this),this.h=t,this.g={}}I(Bt,E);var Ut=[];function qt(t,e,n,r){Array.isArray(n)||(n&&(Ut[0]=n.toString()),n=Ut);for(var s=0;s<n.length;s++){var i=ht(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function jt(t){nt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&gt(t)}),t),t.g={}}function Kt(){this.g=!0}function Gt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return St(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Bt.prototype.M=function(){Bt.X.M.call(this),jt(this)},Bt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kt.prototype.Aa=function(){this.g=!1},Kt.prototype.info=function(){};var $t={},zt=null;function Ht(){return zt=zt||new It}function Qt(t){T.call(this,$t.Pa,t)}function Wt(t){const e=Ht();Et(e,new Qt(e))}function Yt(t,e){T.call(this,$t.STAT_EVENT,t),this.stat=e}function Xt(t){const e=Ht();Et(e,new Yt(e,t))}function Zt(t,e){T.call(this,$t.Qa,t),this.size=e}function Jt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return h.setTimeout((function(){t()}),e)}$t.Pa="serverreachability",I(Qt,T),$t.STAT_EVENT="statevent",I(Yt,T),$t.Qa="timingevent",I(Zt,T);var te={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ee={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ne(){}function re(t){return t.h||(t.h=t.i())}function se(){}ne.prototype.h=null;var ie,oe={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ae(){T.call(this,"d")}function ue(){T.call(this,"c")}function ce(){}function le(t,e,n,r){this.l=t,this.j=e,this.m=n,this.U=r||1,this.S=new Bt(this),this.O=de,t=B?125:void 0,this.T=new Rt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new he}function he(){this.i=null,this.g="",this.h=!1}I(ae,T),I(ue,T),I(ce,ne),ce.prototype.g=function(){return new XMLHttpRequest},ce.prototype.i=function(){return{}},ie=new ce;var de=45e3,fe={},pe={};function ge(t,e,n){t.K=1,t.v=Re(De(e)),t.s=n,t.P=!0,me(t,null)}function me(t,e){t.F=Date.now(),be(t),t.A=De(t.v);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),He(n.i,"t",r),t.C=0,n=t.l.H,t.h=new he,t.g=Hn(t.l,n?e:null,!t.s),0<t.N&&(t.L=new Vt(w(t.La,t,t.g),t.N)),qt(t.S,t.g,"readystatechange",t.ib),e=t.H?rt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),Wt(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.U,t.s)}function ye(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Da}function ve(t,e,n){let r,s=!0;for(;!t.I&&t.C<n.length;){if(r=we(t,n),r==pe){4==e&&(t.o=4,Xt(14),s=!1),Gt(t.j,t.m,null,"[Incomplete Response]");break}if(r==fe){t.o=4,Xt(15),Gt(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Gt(t.j,t.m,r,null),_e(t,r)}ye(t)&&r!=pe&&r!=fe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Xt(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.$&&(t.$=!0,(e=t.l).g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Bn(e),e.K=!0,Xt(11))):(Gt(t.j,t.m,n,"[Invalid Chunked Response]"),Se(t),ke(t))}function we(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?pe:(n=Number(e.substring(n,r)),isNaN(n)?fe:(r+=1)+n>e.length?pe:(e=e.substr(r,n),t.C=r+n,e))}function be(t){t.V=Date.now()+t.O,Ie(t,t.O)}function Ie(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Jt(w(t.gb,t),e)}function Ee(t){t.B&&(h.clearTimeout(t.B),t.B=null)}function ke(t){0==t.l.G||t.I||jn(t.l,t)}function Se(t){Ee(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ot(t.T),jt(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function _e(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Je(n.h,t)))if(!t.J&&Je(n.h,t)&&3==n.G){try{var r=n.Fa.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;qn(n),Nn(n)}Vn(n),Xt(18)}}else n.Ba=s[1],0<n.Ba-n.T&&37500>s[2]&&n.L&&0==n.A&&!n.v&&(n.v=Jt(w(n.cb,n),6e3));if(1>=Ze(n.h)&&n.ja){try{n.ja()}catch(t){}n.ja=void 0}}else Gn(n,11)}else if((t.J||n.g==t)&&qn(n),!C(e))for(s=n.Fa.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.I=c[1],n.ka=c[2];const e=c[3];null!=e&&(n.ma=e,n.j.info("VER="+n.ma));const s=c[4];null!=s&&(n.Ca=s,n.j.info("SVER="+n.Ca));const l=c[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(tn(i,i.h),i.h=null))}if(r.D){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.za=t,Me(r.F,r.D,t))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=t;if((r=n).sa=zn(r,r.H?r.ka:null,r.V),o.J){en(r.h,o);var a=o,u=r.J;u&&a.setTimeout(u),a.B&&(Ee(a),be(a)),r.g=o}else Pn(r);0<n.i.length&&Mn(n)}else"stop"!=c[0]&&"close"!=c[0]||Gn(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Gn(n,7):xn(n):"noop"!=c[0]&&n.l&&n.l.wa(c),n.A=0)}Wt()}catch(t){}}function Te(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.oa&&"function"==typeof t.oa)return t.oa();if(!t.W||"function"!=typeof t.W){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(f(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.W&&"function"==typeof t.W)return t.W();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(r=le.prototype).setTimeout=function(t){this.O=t},r.ib=function(t){t=t.target;const e=this.L;e&&3==Sn(t)?e.l():this.La(t)},r.La=function(t){try{if(t==this.g)t:{const l=Sn(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>l)&&(3!=l||B||this.g&&(this.h.h||this.g.fa()||_n(this.g)))){this.I||4!=l||7==e||Wt(),Ee(this);var n=this.g.aa();this.Y=n;e:if(ye(this)){var r=_n(this.g);t="";var s=r.length,i=4==Sn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Se(this),ke(this);var o="";break e}this.h.i=new h.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.U,l,n),this.i){if(this.Z&&!this.J){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(a)){var c=a;break e}}c=null}if(!(n=c)){this.i=!1,this.o=3,Xt(12),Se(this),ke(this);break t}Gt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,_e(this,n)}this.P?(ve(this,l,o),B&&this.i&&3==l&&(qt(this.S,this.T,"tick",this.hb),this.T.start())):(Gt(this.j,this.m,o,null),_e(this,o)),4==l&&Se(this),this.i&&!this.I&&(4==l?jn(this.l,this):(this.i=!1,be(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Xt(12)):(this.o=0,Xt(13)),Se(this),ke(this)}}}catch(t){}},r.hb=function(){if(this.g){var t=Sn(this.g),e=this.g.fa();this.C<e.length&&(Ee(this),ve(this,t,e),this.i&&4!=t&&be(this))}},r.cancel=function(){this.I=!0,Se(this)},r.gb=function(){this.B=null;const t=Date.now();0<=t-this.V?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Wt(),Xt(17)),Se(this),this.o=2,ke(this)):Ie(this,this.V-t)};var Ae=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ce(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Ce){this.h=void 0!==e?e:t.h,xe(this,t.j),this.s=t.s,this.g=t.g,Ne(this,t.m),this.l=t.l,e=t.i;var n=new Ke;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Fe(this,n),this.o=t.o}else t&&(n=String(t).match(Ae))?(this.h=!!e,xe(this,n[1]||"",!0),this.s=Oe(n[2]||""),this.g=Oe(n[3]||"",!0),Ne(this,n[4]),this.l=Oe(n[5]||"",!0),Fe(this,n[6]||"",!0),this.o=Oe(n[7]||"")):(this.h=!!e,this.i=new Ke(null,this.h))}function De(t){return new Ce(t)}function xe(t,e,n){t.j=n?Oe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ne(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Fe(t,e,n){e instanceof Ke?(t.i=e,function(t,e){e&&!t.j&&(Ge(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&($e(this,e),He(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Le(e,qe)),t.i=new Ke(e,t.h))}function Me(t,e,n){t.i.set(e,n)}function Re(t){return Me(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Oe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Le(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Pe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Pe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ce.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Le(e,Ve,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Le(e,Ve,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Le(n,"/"==n.charAt(0)?Ue:Be,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Le(n,je)),t.join("")};var Ve=/[#\/\?@]/g,Be=/[#\?:]/g,Ue=/[#\?]/g,qe=/[#\?@]/g,je=/#/g;function Ke(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ge(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function $e(t,e){Ge(t),e=Qe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function ze(t,e){return Ge(t),e=Qe(t,e),t.g.has(e)}function He(t,e,n){$e(t,e),0<n.length&&(t.i=null,t.g.set(Qe(t,e),S(n)),t.h+=n.length)}function Qe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function We(t){this.l=t||Ye,t=h.PerformanceNavigationTiming?0<(t=h.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(h.g&&h.g.Ga&&h.g.Ga()&&h.g.Ga().$b),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(r=Ke.prototype).add=function(t,e){Ge(this),this.i=null,t=Qe(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},r.forEach=function(t,e){Ge(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},r.oa=function(){Ge(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},r.W=function(t){Ge(this);let e=[];if("string"==typeof t)ze(this,t)&&(e=e.concat(this.g.get(Qe(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},r.set=function(t,e){return Ge(this),this.i=null,ze(this,t=Qe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},r.get=function(t,e){return t&&0<(t=this.W(t)).length?String(t[0]):e},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var Ye=10;function Xe(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ze(t){return t.h?1:t.g?t.g.size:0}function Je(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function tn(t,e){t.g?t.g.add(e):t.h=e}function en(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function nn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return S(t.i)}function rn(){}function sn(){this.g=new rn}function on(t,e,n){const r=n||"";try{Te(t,(function(t,n){let s=t;p(t)&&(s=St(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function an(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function un(t){this.l=t.ac||null,this.j=t.jb||!1}function cn(t,e){It.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=ln,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}We.prototype.cancel=function(){if(this.i=nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},rn.prototype.stringify=function(t){return h.JSON.stringify(t,void 0)},rn.prototype.parse=function(t){return h.JSON.parse(t,void 0)},I(un,ne),un.prototype.g=function(){return new cn(this.l,this.j)},un.prototype.i=function(t){return function(){return t}}({}),I(cn,It);var ln=0;function hn(t){t.j.read().then(t.Ta.bind(t)).catch(t.ga.bind(t))}function dn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,fn(t)}function fn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=cn.prototype).open=function(t,e){if(this.readyState!=ln)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,fn(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||h).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,dn(this)),this.readyState=ln},r.Wa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,fn(this)),this.g&&(this.readyState=3,fn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==h.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hn(this)}else t.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?dn(this):fn(this),3==this.readyState&&hn(this)}},r.Va=function(t){this.g&&(this.response=this.responseText=t,dn(this))},r.Ua=function(t){this.g&&(this.response=t,dn(this))},r.ga=function(){this.g&&dn(this)},r.setRequestHeader=function(t,e){this.v.append(t,e)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(cn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var pn=h.JSON.parse;function gn(t){It.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=mn,this.K=this.L=!1}I(gn,It);var mn="",yn=/^https?$/i,vn=["POST","PUT"];function wn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,bn(t),En(t)}function bn(t){t.D||(t.D=!0,Et(t,"complete"),Et(t,"error"))}function In(t){if(t.h&&void 0!==l&&(!t.C[1]||4!=Sn(t)||2!=t.aa()))if(t.v&&4==Sn(t))Lt(t.Ha,0,t);else if(Et(t,"readystatechange"),4==Sn(t)){t.h=!1;try{const a=t.aa();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===a){var s=String(t.H).match(Ae)[1]||null;if(!s&&h.self&&h.self.location){var i=h.self.location.protocol;s=i.substr(0,i.length-1)}r=!yn.test(s?s.toLowerCase():"")}n=r}if(n)Et(t,"complete"),Et(t,"success");else{t.m=6;try{var o=2<Sn(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.aa()+"]",bn(t)}}finally{En(t)}}}function En(t,e){if(t.g){kn(t);const n=t.g,r=t.C[0]?d:null;t.g=null,t.C=null,e||Et(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function kn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(h.clearTimeout(t.A),t.A=null)}function Sn(t){return t.g?t.g.readyState:0}function _n(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case mn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Tn(t){let e="";return nt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function An(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Tn(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Me(t,e,n))}function Cn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Dn(t){this.Ca=0,this.i=[],this.j=new Kt,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Cn("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Cn("baseRetryDelayMs",5e3,t),this.bb=Cn("retryDelaySeedMs",1e4,t),this.$a=Cn("forwardChannelMaxRetries",2,t),this.ta=Cn("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Zb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new We(t&&t.concurrentRequestLimit),this.Fa=new sn,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=t&&t.Xb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function xn(t){if(Fn(t),3==t.G){var e=t.U++,n=De(t.F);Me(n,"SID",t.I),Me(n,"RID",e),Me(n,"TYPE","terminate"),On(t,n),(e=new le(t,t.j,e,void 0)).K=2,e.v=Re(De(n)),n=!1,h.navigator&&h.navigator.sendBeacon&&(n=h.navigator.sendBeacon(e.v.toString(),"")),!n&&h.Image&&((new Image).src=e.v,n=!0),n||(e.g=Hn(e.l,null),e.g.da(e.v)),e.F=Date.now(),be(e)}$n(t)}function Nn(t){t.g&&(Bn(t),t.g.cancel(),t.g=null)}function Fn(t){Nn(t),t.u&&(h.clearTimeout(t.u),t.u=null),qn(t),t.h.cancel(),t.m&&("number"==typeof t.m&&h.clearTimeout(t.m),t.m=null)}function Mn(t){Xe(t.h)||t.m||(t.m=!0,xt(t.Ja,t),t.C=0)}function Rn(t,e){var n;n=e?e.m:t.U++;const r=De(t.F);Me(r,"SID",t.I),Me(r,"RID",n),Me(r,"AID",t.T),On(t,r),t.o&&t.s&&An(r,t.o,t.s),n=new le(t,t.j,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=Ln(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),tn(t.h,n),ge(n,r,e)}function On(t,e){t.ia&&nt(t.ia,(function(t,n){Me(e,n,t)})),t.l&&Te({},(function(t,n){Me(e,n,t)}))}function Ln(t,e,n){n=Math.min(t.i.length,n);var r=t.l?w(t.l.Ra,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),i=!1;else try{on(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function Pn(t){t.g||t.u||(t.Z=1,xt(t.Ia,t),t.A=0)}function Vn(t){return!(t.g||t.u||3<=t.A||(t.Z++,t.u=Jt(w(t.Ia,t),Kn(t,t.A)),t.A++,0))}function Bn(t){null!=t.B&&(h.clearTimeout(t.B),t.B=null)}function Un(t){t.g=new le(t,t.j,"rpc",t.Z),null===t.o&&(t.g.H=t.s),t.g.N=0;var e=De(t.sa);Me(e,"RID","rpc"),Me(e,"SID",t.I),Me(e,"CI",t.L?"0":"1"),Me(e,"AID",t.T),Me(e,"TYPE","xmlhttp"),On(t,e),t.o&&t.s&&An(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=Re(De(e)),n.s=null,n.P=!0,me(n,t)}function qn(t){null!=t.v&&(h.clearTimeout(t.v),t.v=null)}function jn(t,e){var n=null;if(t.g==e){qn(t),Bn(t),t.g=null;var r=2}else{if(!Je(t.h,e))return;n=e.D,en(t.h,e),r=1}if(0!=t.G)if(t.pa=e.Y,e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;Et(r=Ht(),new Zt(r,n)),Mn(t)}else Pn(t);else if(3==(s=e.o)||0==s&&0<t.pa||!(1==r&&function(t,e){return!(Ze(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.C>=(t.Za?0:t.$a)||(t.m=Jt(w(t.Ja,t,e),Kn(t,t.C)),t.C++,0)))}(t,e)||2==r&&Vn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:Gn(t,5);break;case 4:Gn(t,10);break;case 3:Gn(t,6);break;default:Gn(t,2)}}function Kn(t,e){let n=t.Xa+Math.floor(Math.random()*t.bb);return t.l||(n*=2),n*e}function Gn(t,e){if(t.j.info("Error code "+e),2==e){var n=null;t.l&&(n=null);var r=w(t.kb,t);n||(n=new Ce("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||xe(n,"https"),Re(n)),function(t,e){const n=new Kt;if(h.Image){const r=new Image;r.onload=b(an,n,r,"TestLoadImage: loaded",!0,e),r.onerror=b(an,n,r,"TestLoadImage: error",!1,e),r.onabort=b(an,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=b(an,n,r,"TestLoadImage: timeout",!1,e),h.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Xt(2);t.G=0,t.l&&t.l.va(e),$n(t),Fn(t)}function $n(t){if(t.G=0,t.la=[],t.l){const e=nn(t.h);0==e.length&&0==t.i.length||(_(t.la,e),_(t.la,t.i),t.h.i.length=0,S(t.i),t.i.length=0),t.l.ua()}}function zn(t,e,n){var r=n instanceof Ce?De(n):new Ce(n,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Ne(r,r.m);else{var s=h.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Ce(null,void 0);r&&xe(i,r),e&&(i.g=e),s&&Ne(i,s),n&&(i.l=n),r=i}return n=t.D,e=t.za,n&&e&&Me(r,n,e),Me(r,"VER",t.ma),On(t,r),r}function Hn(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Da&&!t.ra?new gn(new un({jb:!0})):new gn(t.ra)).Ka(t.H),e}function Qn(){}function Wn(){if(P&&!(10<=Number(W)))throw Error("Environmental error: no available transport.")}function Yn(t,e){It.call(this),this.g=new Dn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Yb)&&!C(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!C(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Jn(this)}function Xn(t){ae.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Zn(){ue.call(this),this.status=1}function Jn(t){this.g=t}(r=gn.prototype).Ka=function(t){this.L=t},r.da=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ie.g(),this.C=this.u?re(this.u):re(ie),this.g.onreadystatechange=w(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void wn(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=h.FormData&&t instanceof h.FormData,!(0<=k(vn,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{kn(this),0<this.B&&((this.K=function(t){return P&&Q()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=w(this.qa,this)):this.A=Lt(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){wn(this,t)}},r.qa=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Et(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Et(this,"complete"),Et(this,"abort"),En(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),En(this,!0)),gn.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?In(this):this.fb())},r.fb=function(){In(this)},r.aa=function(){try{return 2<Sn(this)?this.g.status:-1}catch(t){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Sa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),pn(e)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Dn.prototype).ma=8,r.G=1,r.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new le(this,this.j,t,void 0);let i=this.s;if(this.S&&(i?(i=rt(i),it(i,this.S)):i=this.S),null!==this.o||this.N||(s.H=i,i=null),this.O)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Ln(this,s,e),Me(n=De(this.F),"RID",t),Me(n,"CVER",22),this.D&&Me(n,"X-HTTP-Session-Id",this.D),On(this,n),i&&(this.N?e="headers="+encodeURIComponent(String(Tn(i)))+"&"+e:this.o&&An(n,this.o,i)),tn(this.h,s),this.Ya&&Me(n,"TYPE","init"),this.O?(Me(n,"$req",e),Me(n,"SID","null"),s.Z=!0,ge(s,n,null)):ge(s,n,e),this.G=2}}else 3==this.G&&(t?Rn(this,t):0==this.i.length||Xe(this.h)||Rn(this))},r.Ia=function(){if(this.u=null,Un(this),this.$&&!(this.K||null==this.g||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=Jt(w(this.eb,this),t)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Xt(10),Nn(this),Un(this))},r.cb=function(){null!=this.v&&(this.v=null,Nn(this),Vn(this),Xt(19))},r.kb=function(t){t?(this.j.info("Successfully pinged google.com"),Xt(2)):(this.j.info("Failed to ping google.com"),Xt(1))},(r=Qn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},Wn.prototype.g=function(t,e){return new Yn(t,e)},I(Yn,It),Yn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;Xt(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=zn(t,null,t.V),Mn(t)},Yn.prototype.close=function(){xn(this.g)},Yn.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=St(t),t=n);e.i.push(new class{constructor(t,e){this.h=t,this.g=e}}(e.ab++,t)),3==e.G&&Mn(e)},Yn.prototype.M=function(){this.g.l=null,delete this.j,xn(this.g),delete this.g,Yn.X.M.call(this)},I(Xn,ae),I(Zn,ue),I(Jn,Qn),Jn.prototype.xa=function(){Et(this.g,"a")},Jn.prototype.wa=function(t){Et(this.g,new Xn(t))},Jn.prototype.va=function(t){Et(this.g,new Zn)},Jn.prototype.ua=function(){Et(this.g,"b")},Wn.prototype.createWebChannel=Wn.prototype.g,Yn.prototype.send=Yn.prototype.u,Yn.prototype.open=Yn.prototype.m,Yn.prototype.close=Yn.prototype.close,te.NO_ERROR=0,te.TIMEOUT=8,te.HTTP_ERROR=6,ee.COMPLETE="complete",se.EventType=oe,oe.OPEN="a",oe.CLOSE="b",oe.ERROR="c",oe.MESSAGE="d",It.prototype.listen=It.prototype.N,gn.prototype.listenOnce=gn.prototype.O,gn.prototype.getLastError=gn.prototype.Oa,gn.prototype.getLastErrorCode=gn.prototype.Ea,gn.prototype.getStatus=gn.prototype.aa,gn.prototype.getResponseJson=gn.prototype.Sa,gn.prototype.getResponseText=gn.prototype.fa,gn.prototype.send=gn.prototype.da,gn.prototype.setWithCredentials=gn.prototype.Ka;var tr=c.createWebChannelTransport=function(){return new Wn},er=c.getStatEventTarget=function(){return Ht()},nr=c.ErrorCode=te,rr=c.EventType=ee,sr=c.Event=$t,ir=c.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},or=c.FetchXmlHttpFactory=un,ar=c.WebChannel=se,ur=c.XhrIo=gn;const cr="@firebase/firestore";class lr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}lr.UNAUTHENTICATED=new lr(null),lr.GOOGLE_CREDENTIALS=new lr("google-credentials-uid"),lr.FIRST_PARTY=new lr("first-party-uid"),lr.MOCK_USER=new lr("mock-user");let hr="9.14.0";const dr=new o.Yd("@firebase/firestore");function fr(){return dr.logLevel}function pr(t){dr.setLogLevel(t)}function gr(t,...e){if(dr.logLevel<=o.in.DEBUG){const n=e.map(vr);dr.debug(`Firestore (${hr}): ${t}`,...n)}}function mr(t,...e){if(dr.logLevel<=o.in.ERROR){const n=e.map(vr);dr.error(`Firestore (${hr}): ${t}`,...n)}}function yr(t,...e){if(dr.logLevel<=o.in.WARN){const n=e.map(vr);dr.warn(`Firestore (${hr}): ${t}`,...n)}}function vr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function wr(t="Unexpected state"){const e=`FIRESTORE (${hr}) INTERNAL ASSERTION FAILED: `+t;throw mr(e),new Error(e)}function br(t,e){t||wr()}function Ir(t,e){t||wr()}function Er(t,e){return t}const kr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Sr extends a.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class _r{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Tr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ar{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(lr.UNAUTHENTICATED)))}shutdown(){}}class Cr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Dr{constructor(t){this.t=t,this.currentUser=lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new _r;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new _r,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{gr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(gr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new _r)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(gr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(br("string"==typeof e.accessToken),new Tr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return br(null===t||"string"==typeof t),new lr(t)}}class xr{constructor(t,e,n,r){this.h=t,this.l=e,this.m=n,this.g=r,this.type="FirstParty",this.user=lr.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(br(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Nr{constructor(t,e,n,r){this.h=t,this.l=e,this.m=n,this.g=r}getToken(){return Promise.resolve(new xr(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable((()=>e(lr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Fr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Mr{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const n=t=>{null!=t.error&&gr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.A;return this.A=t.token,gr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{gr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.T.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.T.getImmediate({optional:!0});t?r(t):gr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(br("string"==typeof t.token),this.A=t.token,new Fr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Rr{getToken(){return Promise.resolve(new Fr(""))}invalidateToken(){}start(t,e){}shutdown(){}}function Or(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Lr{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Or(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function Pr(t,e){return t<e?-1:t>e?1:0}function Vr(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function Br(t){return t+"\0"}class Ur{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Sr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Sr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Sr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Sr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ur.fromMillis(Date.now())}static fromDate(t){return Ur.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Ur(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Pr(this.nanoseconds,t.nanoseconds):Pr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class qr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new qr(t)}static min(){return new qr(new Ur(0,0))}static max(){return new qr(new Ur(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class jr{constructor(t,e,n){void 0===e?e=0:e>t.length&&wr(),void 0===n?n=t.length-e:n>t.length-e&&wr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===jr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof jr?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Kr extends jr{construct(t,e,n){return new Kr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Sr(kr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Kr(e)}static emptyPath(){return new Kr([])}}const Gr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $r extends jr{construct(t,e,n){return new $r(t,e,n)}static isValidIdentifier(t){return Gr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$r.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new $r(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Sr(kr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Sr(kr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Sr(kr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Sr(kr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $r(e)}static emptyPath(){return new $r([])}}class zr{constructor(t){this.path=t}static fromPath(t){return new zr(Kr.fromString(t))}static fromName(t){return new zr(Kr.fromString(t).popFirst(5))}static empty(){return new zr(Kr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Kr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Kr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new zr(new Kr(t.slice()))}}class Hr{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}function Qr(t){return t.fields.find((t=>2===t.kind))}function Wr(t){return t.fields.filter((t=>2!==t.kind))}function Yr(t,e){let n=Pr(t.collectionGroup,e.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(t.fields.length,e.fields.length);++r)if(n=Zr(t.fields[r],e.fields[r]),0!==n)return n;return Pr(t.fields.length,e.fields.length)}Hr.UNKNOWN_ID=-1;class Xr{constructor(t,e){this.fieldPath=t,this.kind=e}}function Zr(t,e){const n=$r.comparator(t.fieldPath,e.fieldPath);return 0!==n?n:Pr(t.kind,e.kind)}class Jr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Jr(0,ns.min())}}function ts(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=qr.fromTimestamp(1e9===r?new Ur(n+1,0):new Ur(n,r));return new ns(s,zr.empty(),e)}function es(t){return new ns(t.readTime,t.key,-1)}class ns{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ns(qr.min(),zr.empty(),-1)}static max(){return new ns(qr.max(),zr.empty(),-1)}}function rs(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=zr.comparator(t.documentKey,e.documentKey),0!==n?n:Pr(t.largestBatchId,e.largestBatchId))}const ss="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class is{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function os(t){if(t.code!==kr.FAILED_PRECONDITION||t.message!==ss)throw t;gr("LocalStore","Unexpectedly lost primary lease")}class as{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&wr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new as(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof as?e:as.resolve(e)}catch(t){return as.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):as.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):as.reject(e)}static resolve(t){return new as(((e,n)=>{e(t)}))}static reject(t){return new as(((e,n)=>{n(t)}))}static waitFor(t){return new as(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=as.resolve(!1);for(const n of t)e=e.next((t=>t?as.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new as(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const u=a;e(t[u]).next((t=>{i[u]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new as(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class us{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.P=new _r,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new hs(t,e.error)):this.P.resolve()},this.transaction.onerror=e=>{const n=ms(e.target.error);this.P.reject(new hs(t,n))}}static open(t,e,n,r){try{return new us(e,t.transaction(r,n))}catch(t){throw new hs(e,t)}}get v(){return this.P.promise}abort(t){t&&this.P.reject(t),this.aborted||(gr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new fs(e)}}class cs{constructor(t,e,n){this.name=t,this.version=e,this.S=n,12.2===cs.D((0,a.z$)())&&mr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return gr("SimpleDb","Removing database:",t),ps(window.indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!(0,a.hl)())return!1;if(cs.N())return!0;const t=(0,a.z$)(),e=cs.D(t),n=0<e&&e<10,r=cs.k(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static N(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.O)}static M(t,e){return t.store(e)}static D(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(t){return this.db||(gr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new hs(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Sr(kr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Sr(kr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new hs(t,r))},r.onupgradeneeded=t=>{gr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.S.$(e,r.transaction,t.oldVersion,this.version).next((()=>{gr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.F(t);const e=us.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.V(),t))).catch((t=>(e.abort(t),as.reject(t)))).toPromise();return i.catch((()=>{})),await e.v,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(gr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ls{constructor(t){this.U=t,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(t){this.U=t}done(){this.q=!0}j(t){this.K=t}delete(){return ps(this.U.delete())}}class hs extends Sr{constructor(t,e){super(kr.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ds(t){return"IndexedDbTransactionError"===t.name}class fs{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(gr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(gr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ps(n)}add(t){return gr("SimpleDb","ADD",this.store.name,t,t),ps(this.store.add(t))}get(t){return ps(this.store.get(t)).next((e=>(void 0===e&&(e=null),gr("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return gr("SimpleDb","DELETE",this.store.name,t),ps(this.store.delete(t))}count(){return gr("SimpleDb","COUNT",this.store.name),ps(this.store.count())}W(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.H(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new as(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}J(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new as(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}Y(t,e){gr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.X=!1;const r=this.cursor(n);return this.H(r,((t,e,n)=>n.delete()))}Z(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.H(r,e)}tt(t){const e=this.cursor({});return new as(((n,r)=>{e.onerror=t=>{const e=ms(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}H(t,e){const n=[];return new as(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new ls(s),o=e(s.primaryKey,s.value,i);if(o instanceof as){const t=o.catch((t=>(i.done(),as.reject(t))));n.push(t)}i.isDone?r():null===i.G?s.continue():s.continue(i.G)}})).next((()=>as.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ps(t){return new as(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=ms(t.target.error);n(e)}}))}let gs=!1;function ms(t){const e=cs.D((0,a.z$)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Sr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gs||(gs=!0,setTimeout((()=>{throw t}),0)),t}}return t}class ys{constructor(t,e){this.asyncQueue=t,this.et=e,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(t){gr("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{gr("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(t){ds(t)?gr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await os(t)}await this.nt(6e4)}))}}class vs{constructor(t,e){this.localStore=t,this.persistence=e}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.it(e,t)))}it(t,e){const n=new Set;let r=e,s=!0;return as.doWhile((()=>!0===s&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return gr("IndexBackiller",`Processing collection: ${e}`),this.rt(t,e,r).next((t=>{r-=t,n.add(e)}));s=!1})))).next((()=>e-r))}rt(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((r=>this.localStore.localDocuments.getNextDocuments(t,e,r,n).next((n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(t,s).next((()=>this.ot(r,n))).next((n=>(gr("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>s.size))}))))}ot(t,e){let n=t;return e.changes.forEach(((t,e)=>{const r=es(e);rs(r,n)>0&&(n=r)})),new ns(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class ws{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ut(t),this.ct=t=>e.writeSequenceNumber(t))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}function bs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Is(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Es(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}ws.at=-1;class ks{constructor(t,e){this.comparator=t,this.root=e||_s.EMPTY}insert(t,e){return new ks(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,_s.BLACK,null,null))}remove(t){return new ks(this.comparator,this.root.remove(t,this.comparator).copy(null,null,_s.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ss(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ss(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ss(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ss(this.root,t,this.comparator,!0)}}class Ss{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class _s{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:_s.RED,this.left=null!=r?r:_s.EMPTY,this.right=null!=s?s:_s.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new _s(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return _s.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return _s.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,_s.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,_s.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw wr();if(this.right.isRed())throw wr();const t=this.left.check();if(t!==this.right.check())throw wr();return t+(this.isRed()?0:1)}}_s.EMPTY=null,_s.RED=!0,_s.BLACK=!1,_s.EMPTY=new class{constructor(){this.size=0}get key(){throw wr()}get value(){throw wr()}get color(){throw wr()}get left(){throw wr()}get right(){throw wr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new _s(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ts{constructor(t){this.comparator=t,this.data=new ks(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new As(this.data.getIterator())}getIteratorFrom(t){return new As(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ts))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ts(this.comparator);return e.data=t,e}}class As{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Cs(t){return t.hasNext()?t.getNext():void 0}class Ds{constructor(t){this.fields=t,t.sort($r.comparator)}static empty(){return new Ds([])}unionWith(t){let e=new Ts($r.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ds(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Vr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function xs(){return"undefined"!=typeof atob}class Ns{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Ns(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ns(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Pr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ns.EMPTY_BYTE_STRING=new Ns("");const Fs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ms(t){if(br(!!t),"string"==typeof t){let e=0;const n=Fs.exec(t);if(br(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Rs(t.seconds),nanos:Rs(t.nanos)}}function Rs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Os(t){return"string"==typeof t?Ns.fromBase64String(t):Ns.fromUint8Array(t)}function Ls(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ps(t){const e=t.mapValue.fields.__previous_value__;return Ls(e)?Ps(e):e}function Vs(t){const e=Ms(t.mapValue.fields.__local_write_time__.timestampValue);return new Ur(e.seconds,e.nanos)}class Bs{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Us{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Us("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Us&&t.projectId===this.projectId&&t.database===this.database}}function qs(t){return null==t}function js(t){return 0===t&&1/t==-1/0}function Ks(t){return"number"==typeof t&&Number.isInteger(t)&&!js(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const Gs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},$s={nullValue:"NULL_VALUE"};function zs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ls(t)?4:oi(t)?9007199254740991:10:wr()}function Hs(t,e){if(t===e)return!0;const n=zs(t);if(n!==zs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vs(t).isEqual(Vs(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Ms(t.timestampValue),r=Ms(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Os(t.bytesValue).isEqual(Os(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Rs(t.geoPointValue.latitude)===Rs(e.geoPointValue.latitude)&&Rs(t.geoPointValue.longitude)===Rs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Rs(t.integerValue)===Rs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Rs(t.doubleValue),r=Rs(e.doubleValue);return n===r?js(n)===js(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Vr(t.arrayValue.values||[],e.arrayValue.values||[],Hs);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(bs(n)!==bs(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Hs(n[t],r[t])))return!1;return!0}(t,e);default:return wr()}}function Qs(t,e){return void 0!==(t.values||[]).find((t=>Hs(t,e)))}function Ws(t,e){if(t===e)return 0;const n=zs(t),r=zs(e);if(n!==r)return Pr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Pr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Rs(t.integerValue||t.doubleValue),r=Rs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ys(t.timestampValue,e.timestampValue);case 4:return Ys(Vs(t),Vs(e));case 5:return Pr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Os(t),r=Os(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Pr(n[t],r[t]);if(0!==e)return e}return Pr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Pr(Rs(t.latitude),Rs(e.latitude));return 0!==n?n:Pr(Rs(t.longitude),Rs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Ws(n[t],r[t]);if(e)return e}return Pr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Gs.mapValue&&e===Gs.mapValue)return 0;if(t===Gs.mapValue)return 1;if(e===Gs.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Pr(r[t],i[t]);if(0!==e)return e;const o=Ws(n[r[t]],s[i[t]]);if(0!==o)return o}return Pr(r.length,i.length)}(t.mapValue,e.mapValue);default:throw wr()}}function Ys(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Pr(t,e);const n=Ms(t),r=Ms(e),s=Pr(n.seconds,r.seconds);return 0!==s?s:Pr(n.nanos,r.nanos)}function Xs(t){return Zs(t)}function Zs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Ms(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Os(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,zr.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Zs(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${Zs(t.fields[s])}`;return n+"}"}(t.mapValue):wr();var e,n}function Js(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ti(t){return!!t&&"integerValue"in t}function ei(t){return!!t&&"arrayValue"in t}function ni(t){return!!t&&"nullValue"in t}function ri(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function si(t){return!!t&&"mapValue"in t}function ii(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Is(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=ii(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=ii(t.arrayValue.values[n]);return e}return Object.assign({},t)}function oi(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function ai(t){return"nullValue"in t?$s:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Js(Us.empty(),zr.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:wr()}function ui(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Js(Us.empty(),zr.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?Gs:wr()}function ci(t,e){const n=Ws(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function li(t,e){const n=Ws(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class hi{constructor(t){this.value=t}static empty(){return new hi({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!si(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ii(e)}setAll(t){let e=$r.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=ii(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());si(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Hs(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];si(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Is(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new hi(ii(this.value))}}function di(t){const e=[];return Is(t.fields,((t,n)=>{const r=new $r([t]);if(si(n)){const t=di(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Ds(e)}class fi{constructor(t,e,n,r,s,i){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.data=s,this.documentState=i}static newInvalidDocument(t){return new fi(t,0,qr.min(),qr.min(),hi.empty(),0)}static newFoundDocument(t,e,n){return new fi(t,1,e,qr.min(),n,0)}static newNoDocument(t,e){return new fi(t,2,e,qr.min(),hi.empty(),0)}static newUnknownDocument(t,e){return new fi(t,3,e,qr.min(),hi.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=hi.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=hi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof fi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new fi(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pi{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ht=null}}function gi(t,e=null,n=[],r=[],s=null,i=null,o=null){return new pi(t,e,n,r,s,i,o)}function mi(t){const e=Er(t);if(null===e.ht){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+Xs(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),qs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Xs(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Xs(t))).join(",")),e.ht=t}return e.ht}function yi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Mi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!Hs(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Oi(t.startAt,e.startAt)&&Oi(t.endAt,e.endAt)}function vi(t){return zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function wi(t,e){return t.filters.filter((t=>t instanceof Ei&&t.field.isEqual(e)))}function bi(t,e,n){let r=$s,s=!0;for(const n of wi(t,e)){let t=$s,e=!0;switch(n.op){case"<":case"<=":t=ai(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=$s}ci({value:r,inclusive:s},{value:t,inclusive:e})<0&&(r=t,s=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];ci({value:r,inclusive:s},{value:t,inclusive:n.inclusive})<0&&(r=t,s=n.inclusive);break}return{value:r,inclusive:s}}function Ii(t,e,n){let r=Gs,s=!0;for(const n of wi(t,e)){let t=Gs,e=!0;switch(n.op){case">=":case">":t=ui(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=Gs}li({value:r,inclusive:s},{value:t,inclusive:e})>0&&(r=t,s=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];li({value:r,inclusive:s},{value:t,inclusive:n.inclusive})>0&&(r=t,s=n.inclusive);break}return{value:r,inclusive:s}}class Ei extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.lt(t,e,n):new ki(t,e,n):"array-contains"===e?new Ai(t,n):"in"===e?new Ci(t,n):"not-in"===e?new Di(t,n):"array-contains-any"===e?new xi(t,n):new Ei(t,e,n)}static lt(t,e,n){return"in"===e?new Si(t,n):new _i(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.ft(Ws(e,this.value)):null!==e&&zs(this.value)===zs(e)&&this.ft(Ws(e,this.value))}ft(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return wr()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class ki extends Ei{constructor(t,e,n){super(t,e,n),this.key=zr.fromName(n.referenceValue)}matches(t){const e=zr.comparator(t.key,this.key);return this.ft(e)}}class Si extends Ei{constructor(t,e){super(t,"in",e),this.keys=Ti(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class _i extends Ei{constructor(t,e){super(t,"not-in",e),this.keys=Ti(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ti(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>zr.fromName(t.referenceValue)))}class Ai extends Ei{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ei(e)&&Qs(e.arrayValue,this.value)}}class Ci extends Ei{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Qs(this.value.arrayValue,e)}}class Di extends Ei{constructor(t,e){super(t,"not-in",e)}matches(t){if(Qs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Qs(this.value.arrayValue,e)}}class xi extends Ei{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ei(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Qs(this.value.arrayValue,t)))}}class Ni{constructor(t,e){this.position=t,this.inclusive=e}}class Fi{constructor(t,e="asc"){this.field=t,this.dir=e}}function Mi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ri(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?zr.comparator(zr.fromName(o.referenceValue),n.key):Ws(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Oi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Hs(t.position[n],e.position[n]))return!1;return!0}class Li{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this._t=null,this.wt=null,this.startAt,this.endAt}}function Pi(t,e,n,r,s,i,o,a){return new Li(t,e,n,r,s,i,o,a)}function Vi(t){return new Li(t)}function Bi(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ui(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function qi(t){for(const e of t.filters)if(e.dt())return e.field;return null}function ji(t){return null!==t.collectionGroup}function Ki(t){const e=Er(t);if(null===e._t){e._t=[];const t=qi(e),n=Ui(e);if(null!==t&&null===n)t.isKeyField()||e._t.push(new Fi(t)),e._t.push(new Fi($r.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e._t.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new Fi($r.keyField(),t))}}}return e._t}function Gi(t){const e=Er(t);if(!e.wt)if("F"===e.limitType)e.wt=gi(e.path,e.collectionGroup,Ki(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ki(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Fi(n.field,e))}const n=e.endAt?new Ni(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ni(e.startAt.position,e.startAt.inclusive):null;e.wt=gi(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.wt}function $i(t,e,n){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zi(t,e){return yi(Gi(t),Gi(e))&&t.limitType===e.limitType}function Hi(t){return`${mi(Gi(t))}|lt:${t.limitType}`}function Qi(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Xs(e.value)}`;var e})).join(", ")}]`),qs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Xs(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Xs(t))).join(",")),`Target(${e})`}(Gi(t))}; limitType=${t.limitType})`}function Wi(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):zr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Ri(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Ki(t),e)||t.endAt&&!function(t,e,n){const r=Ri(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Ki(t),e))}(t,e)}function Yi(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Xi(t){return(e,n)=>{let r=!1;for(const s of Ki(t)){const t=Zi(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function Zi(t,e,n){const r=t.field.isKeyField()?zr.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?Ws(r,s):wr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return wr()}}function Ji(t,e){if(t.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:js(e)?"-0":e}}function to(t){return{integerValue:""+t}}function eo(t,e){return Ks(e)?to(e):Ji(t,e)}class no{constructor(){this._=void 0}}function ro(t,e,n){return t instanceof oo?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ao?uo(t,e):t instanceof co?lo(t,e):function(t,e){const n=io(t,e),r=fo(n)+fo(t.yt);return ti(n)&&ti(t.yt)?to(r):Ji(t.It,r)}(t,e)}function so(t,e,n){return t instanceof ao?uo(t,e):t instanceof co?lo(t,e):n}function io(t,e){return t instanceof ho?ti(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class oo extends no{}class ao extends no{constructor(t){super(),this.elements=t}}function uo(t,e){const n=po(e);for(const e of t.elements)n.some((t=>Hs(t,e)))||n.push(e);return{arrayValue:{values:n}}}class co extends no{constructor(t){super(),this.elements=t}}function lo(t,e){let n=po(e);for(const e of t.elements)n=n.filter((t=>!Hs(t,e)));return{arrayValue:{values:n}}}class ho extends no{constructor(t,e){super(),this.It=t,this.yt=e}}function fo(t){return Rs(t.integerValue||t.doubleValue)}function po(t){return ei(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class go{constructor(t,e){this.field=t,this.transform=e}}class mo{constructor(t,e){this.version=t,this.transformResults=e}}class yo{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new yo}static exists(t){return new yo(void 0,t)}static updateTime(t){return new yo(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function vo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class wo{}function bo(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new xo(t.key,yo.none()):new _o(t.key,t.data,yo.none());{const n=t.data,r=hi.empty();let s=new Ts($r.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new To(t.key,r,new Ds(s.toArray()),yo.none())}}function Io(t,e,n){t instanceof _o?function(t,e,n){const r=t.value.clone(),s=Co(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof To?function(t,e,n){if(!vo(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Co(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Ao(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Eo(t,e,n,r){return t instanceof _o?function(t,e,n,r){if(!vo(t.precondition,e))return n;const s=t.value.clone(),i=Do(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof To?function(t,e,n,r){if(!vo(t.precondition,e))return n;const s=Do(t.fieldTransforms,r,e),i=e.data;return i.setAll(Ao(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return vo(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function ko(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=io(r.transform,t||null);null!=s&&(null===n&&(n=hi.empty()),n.set(r.field,s))}return n||null}function So(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Vr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ao&&e instanceof ao||t instanceof co&&e instanceof co?Vr(t.elements,e.elements,Hs):t instanceof ho&&e instanceof ho?Hs(t.yt,e.yt):t instanceof oo&&e instanceof oo}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class _o extends wo{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class To extends wo{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ao(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Co(t,e,n){const r=new Map;br(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,so(o,a,n[s]))}return r}function Do(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,ro(t,i,e))}return r}class xo extends wo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class No extends wo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Fo{constructor(t){this.count=t}}var Mo,Ro;function Oo(t){switch(t){default:return wr();case kr.CANCELLED:case kr.UNKNOWN:case kr.DEADLINE_EXCEEDED:case kr.RESOURCE_EXHAUSTED:case kr.INTERNAL:case kr.UNAVAILABLE:case kr.UNAUTHENTICATED:return!1;case kr.INVALID_ARGUMENT:case kr.NOT_FOUND:case kr.ALREADY_EXISTS:case kr.PERMISSION_DENIED:case kr.FAILED_PRECONDITION:case kr.ABORTED:case kr.OUT_OF_RANGE:case kr.UNIMPLEMENTED:case kr.DATA_LOSS:return!0}}function Lo(t){if(void 0===t)return mr("GRPC error has no .code"),kr.UNKNOWN;switch(t){case Mo.OK:return kr.OK;case Mo.CANCELLED:return kr.CANCELLED;case Mo.UNKNOWN:return kr.UNKNOWN;case Mo.DEADLINE_EXCEEDED:return kr.DEADLINE_EXCEEDED;case Mo.RESOURCE_EXHAUSTED:return kr.RESOURCE_EXHAUSTED;case Mo.INTERNAL:return kr.INTERNAL;case Mo.UNAVAILABLE:return kr.UNAVAILABLE;case Mo.UNAUTHENTICATED:return kr.UNAUTHENTICATED;case Mo.INVALID_ARGUMENT:return kr.INVALID_ARGUMENT;case Mo.NOT_FOUND:return kr.NOT_FOUND;case Mo.ALREADY_EXISTS:return kr.ALREADY_EXISTS;case Mo.PERMISSION_DENIED:return kr.PERMISSION_DENIED;case Mo.FAILED_PRECONDITION:return kr.FAILED_PRECONDITION;case Mo.ABORTED:return kr.ABORTED;case Mo.OUT_OF_RANGE:return kr.OUT_OF_RANGE;case Mo.UNIMPLEMENTED:return kr.UNIMPLEMENTED;case Mo.DATA_LOSS:return kr.DATA_LOSS;default:return wr()}}(Ro=Mo||(Mo={}))[Ro.OK=0]="OK",Ro[Ro.CANCELLED=1]="CANCELLED",Ro[Ro.UNKNOWN=2]="UNKNOWN",Ro[Ro.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ro[Ro.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ro[Ro.NOT_FOUND=5]="NOT_FOUND",Ro[Ro.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ro[Ro.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ro[Ro.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ro[Ro.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ro[Ro.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ro[Ro.ABORTED=10]="ABORTED",Ro[Ro.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ro[Ro.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ro[Ro.INTERNAL=13]="INTERNAL",Ro[Ro.UNAVAILABLE=14]="UNAVAILABLE",Ro[Ro.DATA_LOSS=15]="DATA_LOSS";class Po{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Is(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return Es(this.inner)}size(){return this.innerSize}}const Vo=new ks(zr.comparator);function Bo(){return Vo}const Uo=new ks(zr.comparator);function qo(...t){let e=Uo;for(const n of t)e=e.insert(n.key,n);return e}function jo(t){let e=Uo;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Ko(){return $o()}function Go(){return $o()}function $o(){return new Po((t=>t.toString()),((t,e)=>t.isEqual(e)))}const zo=new ks(zr.comparator),Ho=new Ts(zr.comparator);function Qo(...t){let e=Ho;for(const n of t)e=e.add(n);return e}const Wo=new Ts(Pr);function Yo(){return Wo}class Xo{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Zo.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Xo(qr.min(),r,Yo(),Bo(),Qo())}}class Zo{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Zo(n,e,Qo(),Qo(),Qo())}}class Jo{constructor(t,e,n,r){this.Tt=t,this.removedTargetIds=e,this.key=n,this.Et=r}}class ta{constructor(t,e){this.targetId=t,this.At=e}}class ea{constructor(t,e,n=Ns.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class na{constructor(){this.Rt=0,this.bt=ia(),this.Pt=Ns.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(t){t.approximateByteSize()>0&&(this.Vt=!0,this.Pt=t)}xt(){let t=Qo(),e=Qo(),n=Qo();return this.bt.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:wr()}})),new Zo(this.Pt,this.vt,t,e,n)}Nt(){this.Vt=!1,this.bt=ia()}kt(t,e){this.Vt=!0,this.bt=this.bt.insert(t,e)}Ot(t){this.Vt=!0,this.bt=this.bt.remove(t)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class ra{constructor(t){this.Bt=t,this.Lt=new Map,this.Ut=Bo(),this.qt=sa(),this.Kt=new Ts(Pr)}Gt(t){for(const e of t.Tt)t.Et&&t.Et.isFoundDocument()?this.Qt(e,t.Et):this.jt(e,t.key,t.Et);for(const e of t.removedTargetIds)this.jt(e,t.key,t.Et)}Wt(t){this.forEachTarget(t,(e=>{const n=this.zt(e);switch(t.state){case 0:this.Ht(e)&&n.Ct(t.resumeToken);break;case 1:n.Ft(),n.St||n.Nt(),n.Ct(t.resumeToken);break;case 2:n.Ft(),n.St||this.removeTarget(e);break;case 3:this.Ht(e)&&(n.$t(),n.Ct(t.resumeToken));break;case 4:this.Ht(e)&&(this.Jt(e),n.Ct(t.resumeToken));break;default:wr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Lt.forEach(((t,n)=>{this.Ht(n)&&e(n)}))}Yt(t){const e=t.targetId,n=t.At.count,r=this.Xt(e);if(r){const t=r.target;if(vi(t))if(0===n){const n=new zr(t.path);this.jt(e,n,fi.newNoDocument(n,qr.min()))}else br(1===n);else this.Zt(e)!==n&&(this.Jt(e),this.Kt=this.Kt.add(e))}}te(t){const e=new Map;this.Lt.forEach(((n,r)=>{const s=this.Xt(r);if(s){if(n.current&&vi(s.target)){const e=new zr(s.target.path);null!==this.Ut.get(e)||this.ee(r,e)||this.jt(r,e,fi.newNoDocument(e,t))}n.Dt&&(e.set(r,n.xt()),n.Nt())}}));let n=Qo();this.qt.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Xt(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.Ut.forEach(((e,n)=>n.setReadTime(t)));const r=new Xo(t,e,this.Kt,this.Ut,n);return this.Ut=Bo(),this.qt=sa(),this.Kt=new Ts(Pr),r}Qt(t,e){if(!this.Ht(t))return;const n=this.ee(t,e.key)?2:0;this.zt(t).kt(e.key,n),this.Ut=this.Ut.insert(e.key,e),this.qt=this.qt.insert(e.key,this.ne(e.key).add(t))}jt(t,e,n){if(!this.Ht(t))return;const r=this.zt(t);this.ee(t,e)?r.kt(e,1):r.Ot(e),this.qt=this.qt.insert(e,this.ne(e).delete(t)),n&&(this.Ut=this.Ut.insert(e,n))}removeTarget(t){this.Lt.delete(t)}Zt(t){const e=this.zt(t).xt();return this.Bt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Mt(t){this.zt(t).Mt()}zt(t){let e=this.Lt.get(t);return e||(e=new na,this.Lt.set(t,e)),e}ne(t){let e=this.qt.get(t);return e||(e=new Ts(Pr),this.qt=this.qt.insert(t,e)),e}Ht(t){const e=null!==this.Xt(t);return e||gr("WatchChangeAggregator","Detected inactive target",t),e}Xt(t){const e=this.Lt.get(t);return e&&e.St?null:this.Bt.se(t)}Jt(t){this.Lt.set(t,new na),this.Bt.getRemoteKeysForTarget(t).forEach((e=>{this.jt(t,e,null)}))}ee(t,e){return this.Bt.getRemoteKeysForTarget(t).has(e)}}function sa(){return new ks(zr.comparator)}function ia(){return new ks(zr.comparator)}const oa={asc:"ASCENDING",desc:"DESCENDING"},aa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ua{constructor(t,e){this.databaseId=t,this.gt=e}}function ca(t,e){return t.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function la(t,e){return t.gt?e.toBase64():e.toUint8Array()}function ha(t,e){return ca(t,e.toTimestamp())}function da(t){return br(!!t),qr.fromTimestamp(function(t){const e=Ms(t);return new Ur(e.seconds,e.nanos)}(t))}function fa(t,e){return function(t){return new Kr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function pa(t){const e=Kr.fromString(t);return br(La(e)),e}function ga(t,e){return fa(t.databaseId,e.path)}function ma(t,e){const n=pa(e);if(n.get(1)!==t.databaseId.projectId)throw new Sr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Sr(kr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new zr(ba(n))}function ya(t,e){return fa(t.databaseId,e)}function va(t){const e=pa(t);return 4===e.length?Kr.emptyPath():ba(e)}function wa(t){return new Kr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ba(t){return br(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ia(t,e,n){return{name:ga(t,e),fields:n.value.mapValue.fields}}function Ea(t,e,n){const r=ma(t,e.name),s=da(e.updateTime),i=new hi({mapValue:{fields:e.fields}}),o=fi.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ka(t,e){let n;if(e instanceof _o)n={update:Ia(t,e.key,e.value)};else if(e instanceof xo)n={delete:ga(t,e.key)};else if(e instanceof To)n={update:Ia(t,e.key,e.data),updateMask:Oa(e.fieldMask)};else{if(!(e instanceof No))return wr();n={verify:ga(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof oo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ao)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof co)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ho)return{fieldPath:e.field.canonicalString(),increment:n.yt};throw wr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ha(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:wr()}(t,e.precondition)),n}function Sa(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?yo.updateTime(da(t.updateTime)):void 0!==t.exists?yo.exists(t.exists):yo.none()}(e.currentDocument):yo.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)br("REQUEST_TIME"===e.setToServerValue),n=new oo;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new ao(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new co(t)}else"increment"in e?n=new ho(t,e.increment):wr();const r=$r.fromServerFormat(e.fieldPath);return new go(r,n)}(t,e))):[];if(e.update){e.update.name;const s=ma(t,e.update.name),i=new hi({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Ds(e.map((t=>$r.fromServerFormat(t))))}(e.updateMask);return new To(s,i,t,n,r)}return new _o(s,i,n,r)}if(e.delete){const r=ma(t,e.delete);return new xo(r,n)}if(e.verify){const r=ma(t,e.verify);return new No(r,n)}return wr()}function _a(t,e){return{documents:[ya(t,e.path)]}}function Ta(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ya(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ya(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(ri(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NAN"}};if(ni(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ri(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NOT_NAN"}};if(ni(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Na(t.field),op:xa(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Na(t.field),direction:Da(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.gt||qs(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Aa(t){let e=va(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){br(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=Ca(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Fi(Fa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,qs(e)?null:e}(n.limit));let u=null;n.startAt&&(u=function(t){const e=!!t.before,n=t.values||[];return new Ni(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new Ni(n,e)}(n.endAt)),Pi(e,s,o,i,a,"F",u,c)}function Ca(t){return t?void 0!==t.unaryFilter?[Ra(t)]:void 0!==t.fieldFilter?[Ma(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Ca(t))).reduce(((t,e)=>t.concat(e))):wr():[]}function Da(t){return oa[t]}function xa(t){return aa[t]}function Na(t){return{fieldPath:t.canonicalString()}}function Fa(t){return $r.fromServerFormat(t.fieldPath)}function Ma(t){return Ei.create(Fa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return wr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ra(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Fa(t.unaryFilter.field);return Ei.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Fa(t.unaryFilter.field);return Ei.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Fa(t.unaryFilter.field);return Ei.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Fa(t.unaryFilter.field);return Ei.create(s,"!=",{nullValue:"NULL_VALUE"});default:return wr()}}function Oa(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function La(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Pa(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ba(e)),e=Va(t.get(n),e);return Ba(e)}function Va(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Ba(t){return t+""}function Ua(t){const e=t.length;if(br(e>=2),2===e)return br(""===t.charAt(0)&&""===t.charAt(1)),Kr.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&wr(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=t.substring(i,e),s+="\0";break;case"":s+=t.substring(i,e+1);break;default:wr()}i=e+2}return new Kr(r)}const qa=["userId","batchId"];function ja(t,e){return[t,Pa(e)]}function Ka(t,e,n){return[t,Pa(e),n]}const Ga={},$a=["prefixPath","collectionGroup","readTime","documentId"],za=["prefixPath","collectionGroup","documentId"],Ha=["collectionGroup","readTime","prefixPath","documentId"],Qa=["canonicalId","targetId"],Wa=["targetId","path"],Ya=["path","targetId"],Xa=["collectionId","parent"],Za=["indexId","uid"],Ja=["uid","sequenceNumber"],tu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],eu=["indexId","uid","orderedDocumentKey"],nu=["userId","collectionPath","documentId"],ru=["userId","collectionPath","largestBatchId"],su=["userId","collectionGroup","largestBatchId"],iu=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ou=[...iu,"documentOverlays"],au=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],uu=au,cu=[...uu,"indexConfiguration","indexState","indexEntries"];class lu extends is{constructor(t,e){super(),this.ie=t,this.currentSequenceNumber=e}}function hu(t,e){const n=Er(t);return cs.M(n.ie,e)}class du{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Io(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Eo(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Eo(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Go();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=bo(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(qr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Qo())}isEqual(t){return this.batchId===t.batchId&&Vr(this.mutations,t.mutations,((t,e)=>So(t,e)))&&Vr(this.baseMutations,t.baseMutations,((t,e)=>So(t,e)))}}class fu{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){br(t.mutations.length===n.length);let r=zo;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new fu(t,e,n,r)}}class pu{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class gu{constructor(t,e,n,r,s=qr.min(),i=qr.min(),o=Ns.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new gu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new gu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new gu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class mu{constructor(t){this.re=t}}function yu(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:vu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(t,e){return{name:ga(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ca(t,e.version.toTimestamp())}}(t.re,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:wu(e.version)};else{if(!e.isUnknownDocument())return wr();r.unknownDocument={path:n.path.toArray(),version:wu(e.version)}}return r}function vu(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function wu(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function bu(t){const e=new Ur(t.seconds,t.nanoseconds);return qr.fromTimestamp(e)}function Iu(t,e){const n=(e.baseMutations||[]).map((e=>Sa(t.re,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Sa(t.re,e))),s=Ur.fromMillis(e.localWriteTimeMs);return new du(e.batchId,s,n,r)}function Eu(t){const e=bu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?bu(t.lastLimboFreeSnapshotVersion):qr.min();let r;var s;return void 0!==t.query.documents?(br(1===(s=t.query).documents.length),r=Gi(Vi(va(s.documents[0])))):r=function(t){return Gi(Aa(t))}(t.query),new gu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Ns.fromBase64String(t.resumeToken))}function ku(t,e){const n=wu(e.snapshotVersion),r=wu(e.lastLimboFreeSnapshotVersion);let s;s=vi(e.target)?_a(t.re,e.target):Ta(t.re,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:mi(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Su(t){const e=Aa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?$i(e,e.limit,"L"):e}function _u(t,e){return new pu(e.largestBatchId,Sa(t.re,e.overlayMutation))}function Tu(t,e){const n=e.path.lastSegment();return[t,Pa(e.path.popLast()),n]}function Au(t,e,n,r){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:wu(r.readTime),documentKey:Pa(r.documentKey.path),largestBatchId:r.largestBatchId}}class Cu{getBundleMetadata(t,e){return Du(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:bu(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return Du(t).put({bundleId:(n=e).id,createTime:wu(da(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return xu(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Su(e.bundledQuery),readTime:bu(e.readTime)};var e}))}saveNamedQuery(t,e){return xu(t).put(function(t){return{name:t.name,readTime:wu(da(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Du(t){return hu(t,"bundles")}function xu(t){return hu(t,"namedQueries")}class Nu{constructor(t,e){this.It=t,this.userId=e}static oe(t,e){const n=e.uid||"";return new Nu(t,n)}getOverlay(t,e){return Fu(t).get(Tu(this.userId,e)).next((t=>t?_u(this.It,t):null))}getOverlays(t,e){const n=Ko();return as.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const r=[];return n.forEach(((n,s)=>{const i=new pu(e,s);r.push(this.ue(t,i))})),as.waitFor(r)}removeOverlaysForBatchId(t,e,n){const r=new Set;e.forEach((t=>r.add(Pa(t.getCollectionPath()))));const s=[];return r.forEach((e=>{const r=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);s.push(Fu(t).Y("collectionPathOverlayIndex",r))})),as.waitFor(s)}getOverlaysForCollection(t,e,n){const r=Ko(),s=Pa(e),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Fu(t).W("collectionPathOverlayIndex",i).next((t=>{for(const e of t){const t=_u(this.It,e);r.set(t.getKey(),t)}return r}))}getOverlaysForCollectionGroup(t,e,n,r){const s=Ko();let i;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Fu(t).Z({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=_u(this.It,e);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>s))}ue(t,e){return Fu(t).put(function(t,e,n){const[r,s,i]=Tu(e,n.mutation.key);return{userId:e,collectionPath:s,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ka(t.re,n.mutation)}}(this.It,this.userId,e))}}function Fu(t){return hu(t,"documentOverlays")}class Mu{constructor(){}ce(t,e){this.ae(t,e),e.he()}ae(t,e){if("nullValue"in t)this.le(e,5);else if("booleanValue"in t)this.le(e,10),e.fe(t.booleanValue?1:0);else if("integerValue"in t)this.le(e,15),e.fe(Rs(t.integerValue));else if("doubleValue"in t){const n=Rs(t.doubleValue);isNaN(n)?this.le(e,13):(this.le(e,15),js(n)?e.fe(0):e.fe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.le(e,20),"string"==typeof n?e.de(n):(e.de(`${n.seconds||""}`),e.fe(n.nanos||0))}else if("stringValue"in t)this._e(t.stringValue,e),this.we(e);else if("bytesValue"in t)this.le(e,30),e.me(Os(t.bytesValue)),this.we(e);else if("referenceValue"in t)this.ge(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.le(e,45),e.fe(n.latitude||0),e.fe(n.longitude||0)}else"mapValue"in t?oi(t)?this.le(e,Number.MAX_SAFE_INTEGER):(this.ye(t.mapValue,e),this.we(e)):"arrayValue"in t?(this.pe(t.arrayValue,e),this.we(e)):wr()}_e(t,e){this.le(e,25),this.Ie(t,e)}Ie(t,e){e.de(t)}ye(t,e){const n=t.fields||{};this.le(e,55);for(const t of Object.keys(n))this._e(t,e),this.ae(n[t],e)}pe(t,e){const n=t.values||[];this.le(e,50);for(const t of n)this.ae(t,e)}ge(t,e){this.le(e,37),zr.fromName(t).path.forEach((t=>{this.le(e,60),this.Ie(t,e)}))}le(t,e){t.fe(e)}we(t){t.fe(2)}}function Ru(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function Ou(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const r=Ru(255&t[n]);if(e+=r,8!==r)break}return e}(t);return Math.ceil(e/8)}Mu.Te=new Mu;class Lu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ae(n.value),n=e.next();this.Re()}be(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Pe(n.value),n=e.next();this.ve()}Ve(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ae(t);else if(t<2048)this.Ae(960|t>>>6),this.Ae(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ae(480|t>>>12),this.Ae(128|63&t>>>6),this.Ae(128|63&t);else{const t=e.codePointAt(0);this.Ae(240|t>>>18),this.Ae(128|63&t>>>12),this.Ae(128|63&t>>>6),this.Ae(128|63&t)}}this.Re()}Se(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Pe(t);else if(t<2048)this.Pe(960|t>>>6),this.Pe(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Pe(480|t>>>12),this.Pe(128|63&t>>>6),this.Pe(128|63&t);else{const t=e.codePointAt(0);this.Pe(240|t>>>18),this.Pe(128|63&t>>>12),this.Pe(128|63&t>>>6),this.Pe(128|63&t)}}this.ve()}De(t){const e=this.Ce(t),n=Ou(e);this.xe(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}Ne(t){const e=this.Ce(t),n=Ou(e);this.xe(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(t){this.xe(t.length),this.buffer.set(t,this.position),this.position+=t.length}$e(){return this.buffer.slice(0,this.position)}Ce(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}Ae(t){const e=255&t;0===e?(this.Oe(0),this.Oe(255)):255===e?(this.Oe(255),this.Oe(0)):this.Oe(e)}Pe(t){const e=255&t;0===e?(this.Fe(0),this.Fe(255)):255===e?(this.Fe(255),this.Fe(0)):this.Fe(t)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(t){this.xe(1),this.buffer[this.position++]=t}Fe(t){this.xe(1),this.buffer[this.position++]=~t}xe(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Pu{constructor(t){this.Be=t}me(t){this.Be.Ee(t)}de(t){this.Be.Ve(t)}fe(t){this.Be.De(t)}he(){this.Be.ke()}}class Vu{constructor(t){this.Be=t}me(t){this.Be.be(t)}de(t){this.Be.Se(t)}fe(t){this.Be.Ne(t)}he(){this.Be.Me()}}class Bu{constructor(){this.Be=new Lu,this.Le=new Pu(this.Be),this.Ue=new Vu(this.Be)}seed(t){this.Be.seed(t)}qe(t){return 0===t?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}class Uu{constructor(t,e,n,r){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=r}Ke(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new Uu(this.indexId,this.documentKey,this.arrayValue,n)}}function qu(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=ju(t.arrayValue,e.arrayValue),0!==n?n:(n=ju(t.directionalValue,e.directionalValue),0!==n?n:zr.comparator(t.documentKey,e.documentKey)))}function ju(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(0!==r)return r}return t.length-e.length}class Ku{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ge=t.orderBy,this.Qe=[];for(const e of t.filters){const t=e;t.dt()?this.je=t:this.Qe.push(t)}}We(t){const e=Qr(t);if(void 0!==e&&!this.ze(e))return!1;const n=Wr(t);let r=0,s=0;for(;r<n.length&&this.ze(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.je){const t=n[r];if(!this.He(this.je,t)||!this.Je(this.Ge[s++],t))return!1;++r}for(;r<n.length;++r){const t=n[r];if(s>=this.Ge.length||!this.Je(this.Ge[s++],t))return!1}return!0}ze(t){for(const e of this.Qe)if(this.He(e,t))return!0;return!1}He(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}Je(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}class Gu{constructor(){this.Ye=new $u}addToCollectionParentIndex(t,e){return this.Ye.add(e),as.resolve()}getCollectionParents(t,e){return as.resolve(this.Ye.getEntries(e))}addFieldIndex(t,e){return as.resolve()}deleteFieldIndex(t,e){return as.resolve()}getDocumentsMatchingTarget(t,e){return as.resolve(null)}getIndexType(t,e){return as.resolve(0)}getFieldIndexes(t,e){return as.resolve([])}getNextCollectionGroupToUpdate(t){return as.resolve(null)}getMinOffset(t,e){return as.resolve(ns.min())}getMinOffsetFromCollectionGroup(t,e){return as.resolve(ns.min())}updateCollectionGroup(t,e,n){return as.resolve()}updateIndexEntries(t,e){return as.resolve()}}class $u{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ts(Kr.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Ts(Kr.comparator)).toArray()}}const zu=new Uint8Array(0);class Hu{constructor(t,e){this.user=t,this.databaseId=e,this.Xe=new $u,this.Ze=new Po((t=>mi(t)),((t,e)=>yi(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Xe.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.Xe.add(e)}));const s={collectionId:n,parent:Pa(r)};return Qu(t).put(s)}return as.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[Br(e),""],!1,!0);return Qu(t).W(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(Ua(r.parent))}return n}))}addFieldIndex(t,e){const n=Yu(t),r=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete r.indexId;const s=n.add(r);if(e.indexState){const n=Xu(t);return s.next((t=>{n.put(Au(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return s.next()}deleteFieldIndex(t,e){const n=Yu(t),r=Xu(t),s=Wu(t);return n.delete(e.indexId).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=Wu(t);let r=!0;const s=new Map;return as.forEach(this.tn(e),(e=>this.en(t,e).next((t=>{r&&(r=!!t),s.set(e,t)})))).next((()=>{if(r){let t=Qo();const r=[];return as.forEach(s,((s,i)=>{var o;gr("IndexedDbIndexManager",`Using index ${o=s,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${mi(e)}`);const a=function(t,e){const n=Qr(e);if(void 0===n)return null;for(const e of wi(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(i,s),u=function(t,e){const n=new Map;for(const r of Wr(e))for(const e of wi(t,r.fieldPath))switch(e.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(i,s),c=function(t,e){const n=[];let r=!0;for(const s of Wr(e)){const e=0===s.kind?bi(t,s.fieldPath,t.startAt):Ii(t,s.fieldPath,t.startAt);n.push(e.value),r&&(r=e.inclusive)}return new Ni(n,r)}(i,s),l=function(t,e){const n=[];let r=!0;for(const s of Wr(e)){const e=0===s.kind?Ii(t,s.fieldPath,t.endAt):bi(t,s.fieldPath,t.endAt);n.push(e.value),r&&(r=e.inclusive)}return new Ni(n,r)}(i,s),h=this.nn(s,i,c),d=this.nn(s,i,l),f=this.sn(s,i,u),p=this.rn(s.indexId,a,h,c.inclusive,d,l.inclusive,f);return as.forEach(p,(s=>n.J(s,e.limit).next((e=>{e.forEach((e=>{const n=zr.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),r.push(n))}))}))))})).next((()=>r))}return as.resolve(null)}))}tn(t){let e=this.Ze.get(t);return e||(e=[t],this.Ze.set(t,e),e)}rn(t,e,n,r,s,i,o){const a=(null!=e?e.length:1)*Math.max(n.length,s.length),u=a/(null!=e?e.length:1),c=[];for(let l=0;l<a;++l){const a=e?this.on(e[l/u]):zu,h=this.un(t,a,n[l%u],r),d=this.cn(t,a,s[l%u],i),f=o.map((e=>this.un(t,a,e,!0)));c.push(...this.createRange(h,d,f))}return c}un(t,e,n,r){const s=new Uu(t,zr.empty(),e,n);return r?s:s.Ke()}cn(t,e,n,r){const s=new Uu(t,zr.empty(),e,n);return r?s.Ke():s}en(t,e){const n=new Ku(e),r=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,r).next((t=>{let e=null;for(const r of t)n.We(r)&&(!e||r.fields.length>e.fields.length)&&(e=r);return e}))}getIndexType(t,e){let n=2;return as.forEach(this.tn(e),(e=>this.en(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new Ts($r.comparator),n=!1;for(const r of t.filters){const t=r;t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field))}for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>n))}an(t,e){const n=new Bu;for(const r of Wr(t)){const t=e.data.field(r.fieldPath);if(null==t)return null;const s=n.qe(r.kind);Mu.Te.ce(t,s)}return n.$e()}on(t){const e=new Bu;return Mu.Te.ce(t,e.qe(0)),e.$e()}hn(t,e){const n=new Bu;return Mu.Te.ce(Js(this.databaseId,e),n.qe(function(t){const e=Wr(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.$e()}sn(t,e,n){if(null===n)return[];let r=[];r.push(new Bu);let s=0;for(const i of Wr(t)){const t=n[s++];for(const n of r)if(this.ln(e,i.fieldPath)&&ei(t))r=this.fn(r,i,t);else{const e=n.qe(i.kind);Mu.Te.ce(t,e)}}return this.dn(r)}nn(t,e,n){return this.sn(t,e,n.position)}dn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].$e();return e}fn(t,e,n){const r=[...t],s=[];for(const t of n.arrayValue.values||[])for(const n of r){const r=new Bu;r.seed(n.$e()),Mu.Te.ce(t,r.qe(e.kind)),s.push(r)}return s}ln(t,e){return!!t.filters.find((t=>t instanceof Ei&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Yu(t),r=Xu(t);return(e?n.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.W()).next((t=>{const e=[];return as.forEach(t,(t=>r.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new Jr(e.sequenceNumber,new ns(bu(e.readTime),new zr(Ua(e.documentKey)),e.largestBatchId)):Jr.empty(),r=t.fields.map((([t,e])=>new Xr($r.fromServerFormat(t),e)));return new Hr(t.indexId,t.collectionGroup,r,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:Pr(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const r=Yu(t),s=Xu(t);return this._n(t).next((t=>r.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>as.forEach(e,(e=>s.put(Au(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return as.forEach(e,((e,r)=>{const s=n.get(e.collectionGroup);return(s?as.resolve(s):this.getFieldIndexes(t,e.collectionGroup)).next((s=>(n.set(e.collectionGroup,s),as.forEach(s,(n=>this.wn(t,e,n).next((e=>{const s=this.mn(r,n);return e.isEqual(s)?as.resolve():this.gn(t,r,n,e,s)})))))))}))}yn(t,e,n,r){return Wu(t).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.hn(n,e.key),documentKey:e.key.path.toArray()})}pn(t,e,n,r){return Wu(t).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.hn(n,e.key),e.key.path.toArray()])}wn(t,e,n){const r=Wu(t);let s=new Ts(qu);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.hn(n,e)])},((t,r)=>{s=s.add(new Uu(n.indexId,e,r.arrayValue,r.directionalValue))})).next((()=>s))}mn(t,e){let n=new Ts(qu);const r=this.an(e,t);if(null==r)return n;const s=Qr(e);if(null!=s){const i=t.data.field(s.fieldPath);if(ei(i))for(const s of i.arrayValue.values||[])n=n.add(new Uu(e.indexId,t.key,this.on(s),r))}else n=n.add(new Uu(e.indexId,t.key,zu,r));return n}gn(t,e,n,r,s){gr("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const i=[];return function(t,e,n,r,s){const i=t.getIterator(),o=e.getIterator();let a=Cs(i),u=Cs(o);for(;a||u;){let t=!1,e=!1;if(a&&u){const r=n(a,u);r<0?e=!0:r>0&&(t=!0)}else null!=a?e=!0:t=!0;t?(r(u),u=Cs(o)):e?(s(a),a=Cs(i)):(a=Cs(i),u=Cs(o))}}(r,s,qu,(r=>{i.push(this.yn(t,e,n,r))}),(r=>{i.push(this.pn(t,e,n,r))})),as.waitFor(i)}_n(t){let e=1;return Xu(t).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,r)=>{r.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>qu(t,e))).filter(((t,e,n)=>!e||0!==qu(t,n[e-1])));const r=[];r.push(t);for(const s of n){const n=qu(s,t),i=qu(s,e);if(0===n)r[0]=t.Ke();else if(n>0&&i<0)r.push(s),r.push(s.Ke());else if(i>0)break}r.push(e);const s=[];for(let t=0;t<r.length;t+=2)s.push(IDBKeyRange.bound([r[t].indexId,this.uid,r[t].arrayValue,r[t].directionalValue,zu,[]],[r[t+1].indexId,this.uid,r[t+1].arrayValue,r[t+1].directionalValue,zu,[]]));return s}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Zu)}getMinOffset(t,e){return as.mapArray(this.tn(e),(e=>this.en(t,e).next((t=>t||wr())))).next(Zu)}}function Qu(t){return hu(t,"collectionParents")}function Wu(t){return hu(t,"indexEntries")}function Yu(t){return hu(t,"indexConfiguration")}function Xu(t){return hu(t,"indexState")}function Zu(t){br(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;rs(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new ns(e.readTime,e.documentKey,n)}const Ju={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class tc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new tc(t,tc.DEFAULT_COLLECTION_PERCENTILE,tc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ec(t,e,n){const r=t.store("mutations"),s=t.store("documentMutations"),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=r.Z({range:o},((t,e,n)=>(a++,n.delete())));i.push(u.next((()=>{br(1===a)})));const c=[];for(const t of n.mutations){const r=Ka(e,t.key.path,n.batchId);i.push(s.delete(r)),c.push(t.key)}return as.waitFor(i).next((()=>c))}function nc(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw wr();e=t.noDocument}return JSON.stringify(e).length}tc.DEFAULT_COLLECTION_PERCENTILE=10,tc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tc.DEFAULT=new tc(41943040,tc.DEFAULT_COLLECTION_PERCENTILE,tc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tc.DISABLED=new tc(-1,0,0);class rc{constructor(t,e,n,r){this.userId=t,this.It=e,this.indexManager=n,this.referenceDelegate=r,this.In={}}static oe(t,e,n,r){br(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new rc(s,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ic(t).Z({index:"userMutationsIndex",range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const s=oc(t),i=ic(t);return i.add({}).next((o=>{br("number"==typeof o);const a=new du(o,e,n,r),u=function(t,e,n){const r=n.baseMutations.map((e=>ka(t.re,e))),s=n.mutations.map((e=>ka(t.re,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:s}}(this.It,this.userId,a),c=[];let l=new Ts(((t,e)=>Pr(t.canonicalString(),e.canonicalString())));for(const t of r){const e=Ka(this.userId,t.key.path,o);l=l.add(t.key.path.popLast()),c.push(i.put(u)),c.push(s.put(e,Ga))}return l.forEach((e=>{c.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.In[o]=a.keys()})),as.waitFor(c).next((()=>a))}))}lookupMutationBatch(t,e){return ic(t).get(e).next((t=>t?(br(t.userId===this.userId),Iu(this.It,t)):null))}Tn(t,e){return this.In[e]?as.resolve(this.In[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.In[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return ic(t).Z({index:"userMutationsIndex",range:r},((t,e,r)=>{e.userId===this.userId&&(br(e.batchId>=n),s=Iu(this.It,e)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return ic(t).Z({index:"userMutationsIndex",range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ic(t).W("userMutationsIndex",e).next((t=>t.map((t=>Iu(this.It,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=ja(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return oc(t).Z({range:r},((n,r,i)=>{const[o,a,u]=n,c=Ua(a);if(o===this.userId&&e.path.isEqual(c))return ic(t).get(u).next((t=>{if(!t)throw wr();br(t.userId===this.userId),s.push(Iu(this.It,t))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ts(Pr);const r=[];return e.forEach((e=>{const s=ja(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=oc(t).Z({range:i},((t,r,s)=>{const[i,o,a]=t,u=Ua(o);i===this.userId&&e.path.isEqual(u)?n=n.add(a):s.done()}));r.push(o)})),as.waitFor(r).next((()=>this.En(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,s=ja(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new Ts(Pr);return oc(t).Z({range:i},((t,e,s)=>{const[i,a,u]=t,c=Ua(a);i===this.userId&&n.isPrefixOf(c)?c.length===r&&(o=o.add(u)):s.done()})).next((()=>this.En(t,o)))}En(t,e){const n=[],r=[];return e.forEach((e=>{r.push(ic(t).get(e).next((t=>{if(null===t)throw wr();br(t.userId===this.userId),n.push(Iu(this.It,t))})))})),as.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return ec(t.ie,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.An(e.batchId)})),as.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}An(t){delete this.In[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return as.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return oc(t).Z({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=Ua(t[1]);r.push(e)}else n.done()})).next((()=>{br(0===r.length)}))}))}containsKey(t,e){return sc(t,this.userId,e)}Rn(t){return ac(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function sc(t,e,n){const r=ja(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return oc(t).Z({range:i,X:!0},((t,n,r)=>{const[i,a,u]=t;i===e&&a===s&&(o=!0),r.done()})).next((()=>o))}function ic(t){return hu(t,"mutations")}function oc(t){return hu(t,"documentMutations")}function ac(t){return hu(t,"mutationQueues")}class uc{constructor(t){this.bn=t}next(){return this.bn+=2,this.bn}static Pn(){return new uc(0)}static vn(){return new uc(-1)}}class cc{constructor(t,e){this.referenceDelegate=t,this.It=e}allocateTargetId(t){return this.Vn(t).next((e=>{const n=new uc(e.highestTargetId);return e.highestTargetId=n.next(),this.Sn(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Vn(t).next((t=>qr.fromTimestamp(new Ur(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Vn(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Vn(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Sn(t,r))))}addTargetData(t,e){return this.Dn(t,e).next((()=>this.Vn(t).next((n=>(n.targetCount+=1,this.Cn(e,n),this.Sn(t,n))))))}updateTargetData(t,e){return this.Dn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>lc(t).delete(e.targetId))).next((()=>this.Vn(t))).next((e=>(br(e.targetCount>0),e.targetCount-=1,this.Sn(t,e))))}removeTargets(t,e,n){let r=0;const s=[];return lc(t).Z(((i,o)=>{const a=Eu(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(t,a)))})).next((()=>as.waitFor(s))).next((()=>r))}forEachTarget(t,e){return lc(t).Z(((t,n)=>{const r=Eu(n);e(r)}))}Vn(t){return hc(t).get("targetGlobalKey").next((t=>(br(null!==t),t)))}Sn(t,e){return hc(t).put("targetGlobalKey",e)}Dn(t,e){return lc(t).put(ku(this.It,e))}Cn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Vn(t).next((t=>t.targetCount))}getTargetData(t,e){const n=mi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return lc(t).Z({range:r,index:"queryTargetsIndex"},((t,n,r)=>{const i=Eu(n);yi(e,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(t,e,n){const r=[],s=dc(t);return e.forEach((e=>{const i=Pa(e.path);r.push(s.put({targetId:n,path:i})),r.push(this.referenceDelegate.addReference(t,n,e))})),as.waitFor(r)}removeMatchingKeys(t,e,n){const r=dc(t);return as.forEach(e,(e=>{const s=Pa(e.path);return as.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=dc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=dc(t);let s=Qo();return r.Z({range:n,X:!0},((t,e,n)=>{const r=Ua(t[1]),i=new zr(r);s=s.add(i)})).next((()=>s))}containsKey(t,e){const n=Pa(e.path),r=IDBKeyRange.bound([n],[Br(n)],!1,!0);let s=0;return dc(t).Z({index:"documentTargetsIndex",X:!0,range:r},(([t,e],n,r)=>{0!==t&&(s++,r.done())})).next((()=>s>0))}se(t,e){return lc(t).get(e).next((t=>t?Eu(t):null))}}function lc(t){return hu(t,"targets")}function hc(t){return hu(t,"targetGlobal")}function dc(t){return hu(t,"targetDocuments")}function fc([t,e],[n,r]){const s=Pr(t,n);return 0===s?Pr(e,r):s}class pc{constructor(t){this.xn=t,this.buffer=new Ts(fc),this.Nn=0}kn(){return++this.Nn}On(t){const e=[t,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();fc(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class gc{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(t){gr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ds(t)?gr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await os(t)}await this.Fn(3e5)}))}}class mc{constructor(t,e){this.$n=t,this.params=e}calculateTargetCount(t,e){return this.$n.Bn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return as.resolve(ws.at);const n=new pc(e);return this.$n.forEachTarget(t,(t=>n.On(t.sequenceNumber))).next((()=>this.$n.Ln(t,(t=>n.On(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.$n.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.$n.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(gr("LruGarbageCollector","Garbage collection skipped; disabled"),as.resolve(Ju)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(gr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ju):this.Un(t,e)))}getCacheSize(t){return this.$n.getCacheSize(t)}Un(t,e){let n,r,s,i,a,u,c;const l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(gr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,a=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,u=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),fr()<=o.in.DEBUG&&gr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-l}ms\n\tDetermined least recently used ${r} in `+(a-i)+"ms\n"+`\tRemoved ${s} targets in `+(u-a)+"ms\n"+`\tRemoved ${t} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-l}ms`),as.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}class yc{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new mc(t,e)}(this,e)}Bn(t){const e=this.qn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}qn(t){let e=0;return this.Ln(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Ln(t,e){return this.Kn(t,((t,n)=>e(n)))}addReference(t,e,n){return vc(t,n)}removeReference(t,e,n){return vc(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return vc(t,e)}Gn(t,e){return function(t,e){let n=!1;return ac(t).tt((r=>sc(t,r,e).next((t=>(t&&(n=!0),as.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Kn(t,((i,o)=>{if(o<=e){const e=this.Gn(t,i).next((e=>{if(!e)return s++,n.getEntry(t,i).next((()=>(n.removeEntry(i,qr.min()),dc(t).delete([0,Pa(i.path)]))))}));r.push(e)}})).next((()=>as.waitFor(r))).next((()=>n.apply(t))).next((()=>s))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return vc(t,e)}Kn(t,e){const n=dc(t);let r,s=ws.at;return n.Z({index:"documentTargetsIndex"},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==ws.at&&e(new zr(Ua(r)),s),s=o,r=i):s=ws.at})).next((()=>{s!==ws.at&&e(new zr(Ua(r)),s)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function vc(t,e){return dc(t).put(function(t,e){return{targetId:0,path:Pa(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class wc{constructor(){this.changes=new Po((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,fi.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?as.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class bc{constructor(t){this.It=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Sc(t).put(n)}removeEntry(t,e,n){return Sc(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],vu(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Qn(t,n))))}getEntry(t,e){let n=fi.newInvalidDocument(e);return Sc(t).Z({index:"documentKeyIndex",range:IDBKeyRange.only(_c(e))},((t,r)=>{n=this.jn(e,r)})).next((()=>n))}Wn(t,e){let n={size:0,document:fi.newInvalidDocument(e)};return Sc(t).Z({index:"documentKeyIndex",range:IDBKeyRange.only(_c(e))},((t,r)=>{n={document:this.jn(e,r),size:nc(r)}})).next((()=>n))}getEntries(t,e){let n=Bo();return this.zn(t,e,((t,e)=>{const r=this.jn(t,e);n=n.insert(t,r)})).next((()=>n))}Hn(t,e){let n=Bo(),r=new ks(zr.comparator);return this.zn(t,e,((t,e)=>{const s=this.jn(t,e);n=n.insert(t,s),r=r.insert(t,nc(e))})).next((()=>({documents:n,Jn:r})))}zn(t,e,n){if(e.isEmpty())return as.resolve();let r=new Ts(Ac);e.forEach((t=>r=r.add(t)));const s=IDBKeyRange.bound(_c(r.first()),_c(r.last())),i=r.getIterator();let o=i.getNext();return Sc(t).Z({index:"documentKeyIndex",range:s},((t,e,r)=>{const s=zr.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&Ac(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.j(_c(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getAllFromCollection(t,e,n){const r=[e.popLast().toArray(),e.lastSegment(),vu(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],s=[e.popLast().toArray(),e.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Sc(t).W(IDBKeyRange.bound(r,s,!0)).next((t=>{let e=Bo();for(const n of t){const t=this.jn(zr.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e=e.insert(t.key,t)}return e}))}getAllFromCollectionGroup(t,e,n,r){let s=Bo();const i=Tc(e,n),o=Tc(e,ns.max());return Sc(t).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(i,o,!0)},((t,e,n)=>{const i=this.jn(zr.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);s=s.insert(i.key,i),s.size===r&&n.done()})).next((()=>s))}newChangeBuffer(t){return new Ec(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return kc(t).get("remoteDocumentGlobalKey").next((t=>(br(!!t),t)))}Qn(t,e){return kc(t).put("remoteDocumentGlobalKey",e)}jn(t,e){if(e){const t=function(t,e){let n;if(e.document)n=Ea(t.re,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=zr.fromSegments(e.noDocument.path),r=bu(e.noDocument.readTime);n=fi.newNoDocument(t,r),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return wr();{const t=zr.fromSegments(e.unknownDocument.path),r=bu(e.unknownDocument.version);n=fi.newUnknownDocument(t,r)}}return e.readTime&&n.setReadTime(function(t){const e=new Ur(t[0],t[1]);return qr.fromTimestamp(e)}(e.readTime)),n}(this.It,e);if(!t.isNoDocument()||!t.version.isEqual(qr.min()))return t}return fi.newInvalidDocument(t)}}function Ic(t){return new bc(t)}class Ec extends wc{constructor(t,e){super(),this.Yn=t,this.trackRemovals=e,this.Xn=new Po((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new Ts(((t,e)=>Pr(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.Xn.get(s);if(e.push(this.Yn.removeEntry(t,s,o.readTime)),i.isValidDocument()){const a=yu(this.Yn.It,i);r=r.add(s.path.popLast());const u=nc(a);n+=u-o.size,e.push(this.Yn.addEntry(t,s,a))}else if(n-=o.size,this.trackRemovals){const n=yu(this.Yn.It,i.convertToNoDocument(qr.min()));e.push(this.Yn.addEntry(t,s,n))}})),r.forEach((n=>{e.push(this.Yn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.Yn.updateMetadata(t,n)),as.waitFor(e)}getFromCache(t,e){return this.Yn.Wn(t,e).next((t=>(this.Xn.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.Yn.Hn(t,e).next((({documents:t,Jn:e})=>(e.forEach(((e,n)=>{this.Xn.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function kc(t){return hu(t,"remoteDocumentGlobal")}function Sc(t){return hu(t,"remoteDocumentsV14")}function _c(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Tc(t,e){const n=e.documentKey.path.toArray();return[t,vu(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Ac(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let t=0;t<n.length-2&&t<r.length-2;++t)if(s=Pr(n[t],r[t]),s)return s;return s=Pr(n.length,r.length),s||(s=Pr(n[n.length-2],r[r.length-2]),s||Pr(n[n.length-1],r[r.length-1]))}class Cc{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Dc{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&Eo(n.mutation,t,Ds.empty(),Ur.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Qo()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Qo()){const r=Ko();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=qo();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Ko();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Qo())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=Bo();const i=$o(),o=$o();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof To)?s=s.insert(e.key,e):void 0!==o&&(i.set(e.key,o.mutation.getFieldMask()),Eo(o.mutation,e,o.mutation.getFieldMask(),Ur.now()))})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Cc(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=$o();let r=new ks(((t,e)=>t-e)),s=Qo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Ds.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||Qo()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,u=r.value,c=Go();u.forEach((t=>{if(!s.has(t)){const r=bo(e.get(t),n.get(t));null!==r&&c.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,c))}return as.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):ji(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):as.resolve(Ko());let o=-1,a=s;return i.next((e=>as.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?as.resolve():this.getBaseDocument(t,e,n).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,Qo()))).next((t=>({batchId:o,changes:jo(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new zr(e)).next((t=>{let e=qo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const r=e.collectionGroup;let s=qo();return this.indexManager.getCollectionParents(t,r).next((i=>as.forEach(i,(i=>{const o=function(t,e){return new Li(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let r;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===r.get(n)&&(r=r.insert(n,fi.newInvalidDocument(n)))}));let n=qo();return r.forEach(((r,s)=>{const i=t.get(r);void 0!==i&&Eo(i.mutation,s,Ds.empty(),Ur.now()),Wi(e,s)&&(n=n.insert(r,s))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):as.resolve(fi.newInvalidDocument(e))}}class xc{constructor(t){this.It=t,this.Zn=new Map,this.ts=new Map}getBundleMetadata(t,e){return as.resolve(this.Zn.get(e))}saveBundleMetadata(t,e){var n;return this.Zn.set(e.id,{id:(n=e).id,version:n.version,createTime:da(n.createTime)}),as.resolve()}getNamedQuery(t,e){return as.resolve(this.ts.get(e))}saveNamedQuery(t,e){return this.ts.set(e.name,function(t){return{name:t.name,query:Su(t.bundledQuery),readTime:da(t.readTime)}}(e)),as.resolve()}}class Nc{constructor(){this.overlays=new ks(zr.comparator),this.es=new Map}getOverlay(t,e){return as.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Ko();return as.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ue(t,e,r)})),as.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.es.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.es.delete(n)),as.resolve()}getOverlaysForCollection(t,e,n){const r=Ko(),s=e.length+1,i=new zr(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return as.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new ks(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Ko(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Ko(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return as.resolve(o)}ue(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new pu(e,n));let s=this.es.get(e);void 0===s&&(s=Qo(),this.es.set(e,s)),this.es.set(e,s.add(n.key))}}class Fc{constructor(){this.ns=new Ts(Mc.ss),this.rs=new Ts(Mc.os)}isEmpty(){return this.ns.isEmpty()}addReference(t,e){const n=new Mc(t,e);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.cs(new Mc(t,e))}hs(t,e){t.forEach((t=>this.removeReference(t,e)))}ls(t){const e=new zr(new Kr([])),n=new Mc(e,t),r=new Mc(e,t+1),s=[];return this.rs.forEachInRange([n,r],(t=>{this.cs(t),s.push(t.key)})),s}fs(){this.ns.forEach((t=>this.cs(t)))}cs(t){this.ns=this.ns.delete(t),this.rs=this.rs.delete(t)}ds(t){const e=new zr(new Kr([])),n=new Mc(e,t),r=new Mc(e,t+1);let s=Qo();return this.rs.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Mc(t,0),n=this.ns.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Mc{constructor(t,e){this.key=t,this._s=e}static ss(t,e){return zr.comparator(t.key,e.key)||Pr(t._s,e._s)}static os(t,e){return Pr(t._s,e._s)||zr.comparator(t.key,e.key)}}class Rc{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ws=1,this.gs=new Ts(Mc.ss)}checkEmpty(t){return as.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new du(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.gs=this.gs.add(new Mc(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return as.resolve(i)}lookupMutationBatch(t,e){return as.resolve(this.ys(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ps(n),s=r<0?0:r;return as.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return as.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(t){return as.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Mc(e,0),r=new Mc(e,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([n,r],(t=>{const e=this.ys(t._s);s.push(e)})),as.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ts(Pr);return e.forEach((t=>{const e=new Mc(t,0),r=new Mc(t,Number.POSITIVE_INFINITY);this.gs.forEachInRange([e,r],(t=>{n=n.add(t._s)}))})),as.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;zr.isDocumentKey(s)||(s=s.child(""));const i=new Mc(new zr(s),0);let o=new Ts(Pr);return this.gs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t._s)),!0)}),i),as.resolve(this.Is(o))}Is(t){const e=[];return t.forEach((t=>{const n=this.ys(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){br(0===this.Ts(e.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return as.forEach(e.mutations,(r=>{const s=new Mc(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.gs=n}))}An(t){}containsKey(t,e){const n=new Mc(e,0),r=this.gs.firstAfterOrEqual(n);return as.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,as.resolve()}Ts(t,e){return this.ps(t)}ps(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}ys(t){const e=this.ps(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Oc{constructor(t){this.Es=t,this.docs=new ks(zr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.Es(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return as.resolve(n?n.document.mutableCopy():fi.newInvalidDocument(e))}getEntries(t,e){let n=Bo();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():fi.newInvalidDocument(t))})),as.resolve(n)}getAllFromCollection(t,e,n){let r=Bo();const s=new zr(e.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s}}=i.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||rs(es(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return as.resolve(r)}getAllFromCollectionGroup(t,e,n,r){wr()}As(t,e){return as.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Lc(this)}getSize(t){return as.resolve(this.size)}}class Lc extends wc{constructor(t){super(),this.Yn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.Yn.addEntry(t,r)):this.Yn.removeEntry(n)})),as.waitFor(e)}getFromCache(t,e){return this.Yn.getEntry(t,e)}getAllFromCache(t,e){return this.Yn.getEntries(t,e)}}class Pc{constructor(t){this.persistence=t,this.Rs=new Po((t=>mi(t)),yi),this.lastRemoteSnapshotVersion=qr.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Fc,this.targetCount=0,this.vs=uc.Pn()}forEachTarget(t,e){return this.Rs.forEach(((t,n)=>e(n))),as.resolve()}getLastRemoteSnapshotVersion(t){return as.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return as.resolve(this.bs)}allocateTargetId(t){return this.highestTargetId=this.vs.next(),as.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.bs&&(this.bs=e),as.resolve()}Dn(t){this.Rs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.vs=new uc(e),this.highestTargetId=e),t.sequenceNumber>this.bs&&(this.bs=t.sequenceNumber)}addTargetData(t,e){return this.Dn(e),this.targetCount+=1,as.resolve()}updateTargetData(t,e){return this.Dn(e),as.resolve()}removeTargetData(t,e){return this.Rs.delete(e.target),this.Ps.ls(e.targetId),this.targetCount-=1,as.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Rs.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Rs.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),as.waitFor(s).next((()=>r))}getTargetCount(t){return as.resolve(this.targetCount)}getTargetData(t,e){const n=this.Rs.get(e)||null;return as.resolve(n)}addMatchingKeys(t,e,n){return this.Ps.us(e,n),as.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),as.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Ps.ls(e),as.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Ps.ds(e);return as.resolve(n)}containsKey(t,e){return as.resolve(this.Ps.containsKey(e))}}class Vc{constructor(t,e){this.Vs={},this.overlays={},this.Ss=new ws(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=t(this),this.Cs=new Pc(this),this.indexManager=new Gu,this.remoteDocumentCache=function(t){return new Oc(t)}((t=>this.referenceDelegate.xs(t))),this.It=new mu(e),this.Ns=new xc(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Nc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Vs[t.toKey()];return n||(n=new Rc(e,this.referenceDelegate),this.Vs[t.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(t,e,n){gr("MemoryPersistence","Starting transaction:",t);const r=new Bc(this.Ss.next());return this.referenceDelegate.ks(),n(r).next((t=>this.referenceDelegate.Os(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ms(t,e){return as.or(Object.values(this.Vs).map((n=>()=>n.containsKey(t,e))))}}class Bc extends is{constructor(t){super(),this.currentSequenceNumber=t}}class Uc{constructor(t){this.persistence=t,this.Fs=new Fc,this.$s=null}static Bs(t){return new Uc(t)}get Ls(){if(this.$s)return this.$s;throw wr()}addReference(t,e,n){return this.Fs.addReference(n,e),this.Ls.delete(n.toString()),as.resolve()}removeReference(t,e,n){return this.Fs.removeReference(n,e),this.Ls.add(n.toString()),as.resolve()}markPotentiallyOrphaned(t,e){return this.Ls.add(e.toString()),as.resolve()}removeTarget(t,e){this.Fs.ls(e.targetId).forEach((t=>this.Ls.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ls.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}ks(){this.$s=new Set}Os(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return as.forEach(this.Ls,(n=>{const r=zr.fromPath(n);return this.Us(t,r).next((t=>{t||e.removeEntry(r,qr.min())}))})).next((()=>(this.$s=null,e.apply(t))))}updateLimboDocument(t,e){return this.Us(t,e).next((t=>{t?this.Ls.delete(e.toString()):this.Ls.add(e.toString())}))}xs(t){return 0}Us(t,e){return as.or([()=>as.resolve(this.Fs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ms(t,e)])}}class qc{constructor(t){this.It=t}$(t,e,n,r){const s=new us("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qa,{unique:!0}),t.createObjectStore("documentMutations")}(t),jc(t),function(t){t.createObjectStore("remoteDocuments")}(t));let i=as.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),jc(t)),i=i.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:qr.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store("mutations").W().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qa,{unique:!0});const r=e.store("mutations"),s=n.map((t=>r.put(t)));return as.waitFor(s)}))}(t,s)))),i=i.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&r>=5&&(i=i.next((()=>this.qs(s)))),n<6&&r>=6&&(i=i.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Ks(s))))),n<7&&r>=7&&(i=i.next((()=>this.Gs(s)))),n<8&&r>=8&&(i=i.next((()=>this.Qs(t,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&r>=10&&(i=i.next((()=>this.js(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&r>=12&&(i=i.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:nu});e.createIndex("collectionPathOverlayIndex",ru,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",su,{unique:!1})}(t)}))),n<13&&r>=13&&(i=i.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:$a});e.createIndex("documentKeyIndex",za),e.createIndex("collectionGroupIndex",Ha)}(t))).next((()=>this.Ws(t,s))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(i=i.next((()=>this.zs(t,s)))),n<15&&r>=15&&(i=i.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:Za}).createIndex("sequenceNumberIndex",Ja,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:tu}).createIndex("documentKeyIndex",eu,{unique:!1})}(t)))),i}Ks(t){let e=0;return t.store("remoteDocuments").Z(((t,n)=>{e+=nc(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}qs(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.W().next((e=>as.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>as.forEach(n,(n=>{br(n.userId===e.userId);const r=Iu(this.It,n);return ec(t,e.userId,r).next((()=>{}))}))))}))))}Gs(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const r=[];return n.Z(((n,s)=>{const i=new Kr(n),o=function(t){return[0,Pa(t)]}(i);r.push(e.get(o).next((n=>n?as.resolve():(n=>e.put({targetId:0,path:Pa(n),sequenceNumber:t.highestListenSequenceNumber}))(i))))})).next((()=>as.waitFor(r)))}))}Qs(t,e){t.createObjectStore("collectionParents",{keyPath:Xa});const n=e.store("collectionParents"),r=new $u,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:Pa(r)})}};return e.store("remoteDocuments").Z({X:!0},((t,e)=>{const n=new Kr(t);return s(n.popLast())})).next((()=>e.store("documentMutations").Z({X:!0},(([t,e,n],r)=>{const i=Ua(e);return s(i.popLast())}))))}js(t){const e=t.store("targets");return e.Z(((t,n)=>{const r=Eu(n),s=ku(this.It,r);return e.put(s)}))}Ws(t,e){const n=e.store("remoteDocuments"),r=[];return n.Z(((t,n)=>{const s=e.store("remoteDocumentsV14"),i=(o=n,o.document?new zr(Kr.fromString(o.document.name).popFirst(5)):o.noDocument?zr.fromSegments(o.noDocument.path):o.unknownDocument?zr.fromSegments(o.unknownDocument.path):wr()).path.toArray();var o;const a={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(s.put(a))})).next((()=>as.waitFor(r)))}zs(t,e){const n=e.store("mutations"),r=Ic(this.It),s=new Vc(Uc.Bs,this.It.re);return n.W().next((t=>{const n=new Map;return t.forEach((t=>{var e;let r=null!==(e=n.get(t.userId))&&void 0!==e?e:Qo();Iu(this.It,t).keys().forEach((t=>r=r.add(t))),n.set(t.userId,r)})),as.forEach(n,((t,n)=>{const i=new lr(n),o=Nu.oe(this.It,i),a=s.getIndexManager(i),u=rc.oe(i,this.It,a,s.referenceDelegate);return new Dc(r,u,o,a).recalculateAndSaveOverlaysForDocumentKeys(new lu(e,ws.at),t).next()}))}))}}function jc(t){t.createObjectStore("targetDocuments",{keyPath:Wa}).createIndex("documentTargetsIndex",Ya,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Qa,{unique:!0}),t.createObjectStore("targetGlobal")}const Kc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Gc{constructor(t,e,n,r,s,i,o,a,u,c,l=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Hs=s,this.window=i,this.document=o,this.Js=u,this.Ys=c,this.Xs=l,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=t=>Promise.resolve(),!Gc.C())throw new Sr(kr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new yc(this,r),this.ii=e+"main",this.It=new mu(a),this.ri=new cs(this.ii,this.Xs,new qc(this.It)),this.Cs=new cc(this.referenceDelegate,this.It),this.remoteDocumentCache=Ic(this.It),this.Ns=new Cu,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===c&&mr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Sr(kr.FAILED_PRECONDITION,Kc);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Cs.getHighestSequenceNumber(t)))})).then((t=>{this.Ss=new ws(t,this.Js)})).then((()=>{this.Ds=!0})).catch((t=>(this.ri&&this.ri.close(),Promise.reject(t))))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Hs.enqueueAndForget((async()=>{this.started&&await this.ui()})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>zc(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.fi(t).next((t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable((()=>this.si(!1))))}))})).next((()=>this.di(t))).next((e=>this.isPrimary&&!e?this._i(t).next((()=>!1)):!!e&&this.wi(t).next((()=>!0)))))).catch((t=>{if(ds(t))return gr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return gr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Hs.enqueueRetryable((()=>this.si(t))),this.isPrimary=t}))}fi(t){return $c(t).get("owner").next((t=>as.resolve(this.mi(t))))}gi(t){return zc(t).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=hu(t,"clientMetadata");return e.W().next((t=>{const n=this.Ii(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return as.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.oi)for(const e of t)this.oi.removeItem(this.Ti(e.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ui().then((()=>this.yi())).then((()=>this.hi()))))}mi(t){return!!t&&t.ownerId===this.clientId}di(t){return this.Ys?as.resolve(!0):$c(t).get("owner").next((e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(!e.allowTabSynchronization)throw new Sr(kr.FAILED_PRECONDITION,Kc);return!1}}return!(!this.networkEnabled||!this.inForeground)||zc(t).W().next((t=>void 0===this.Ii(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&gr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new lu(t,ws.at);return this._i(e).next((()=>this.gi(e)))})),this.ri.close(),this.Pi()}Ii(t,e){return t.filter((t=>this.pi(t.updateTimeMs,e)&&!this.Ei(t.clientId)))}vi(){return this.runTransaction("getActiveClients","readonly",(t=>zc(t).W().next((t=>this.Ii(t,18e5).map((t=>t.clientId))))))}get started(){return this.Ds}getMutationQueue(t,e){return rc.oe(t,this.It,e,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Hu(t,this.It.re.databaseId)}getDocumentOverlayCache(t){return Nu.oe(this.It,t)}getBundleCache(){return this.Ns}runTransaction(t,e,n){gr("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite",s=15===(i=this.Xs)?cu:14===i?uu:13===i?au:12===i?ou:11===i?iu:void wr();var i;let o;return this.ri.runTransaction(t,r,s,(r=>(o=new lu(r,this.Ss?this.Ss.next():ws.at),"readwrite-primary"===e?this.fi(o).next((t=>!!t||this.di(o))).next((e=>{if(!e)throw mr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable((()=>this.si(!1))),new Sr(kr.FAILED_PRECONDITION,ss);return n(o)})).next((t=>this.wi(o).next((()=>t)))):this.Vi(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}Vi(t){return $c(t).get("owner").next((t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Sr(kr.FAILED_PRECONDITION,Kc)}))}wi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return $c(t).put("owner",e)}static C(){return cs.C()}_i(t){const e=$c(t);return e.get("owner").next((t=>this.mi(t)?(gr("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):as.resolve()))}pi(t,e){const n=Date.now();return!(t<n-e||t>n&&(mr(`Detected an update time that is in the future: ${t} > ${n}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ui())))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,a.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(t){var e;try{const n=null!==(null===(e=this.oi)||void 0===e?void 0:e.getItem(this.Ti(t)));return gr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return mr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(t){mr("Failed to set zombie client id.",t)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(t){}}Ti(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function $c(t){return hu(t,"owner")}function zc(t){return hu(t,"clientMetadata")}function Hc(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Qc{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Si=n,this.Di=r}static Ci(t,e){let n=Qo(),r=Qo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Qc(t,e.fromCache,n,r)}}class Wc{constructor(){this.xi=!1}initialize(t,e){this.Ni=t,this.indexManager=e,this.xi=!0}getDocumentsMatchingQuery(t,e,n,r){return this.ki(t,e).next((s=>s||this.Oi(t,e,r,n))).next((n=>n||this.Mi(t,e)))}ki(t,e){if(Bi(e))return as.resolve(null);let n=Gi(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=$i(e,null,"F"),n=Gi(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=Qo(...r);return this.Ni.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Fi(e,r);return this.$i(e,i,s,n.readTime)?this.ki(t,$i(e,null,"F")):this.Bi(t,i,e,n)}))))})))))}Oi(t,e,n,r){return Bi(e)||r.isEqual(qr.min())?this.Mi(t,e):this.Ni.getDocuments(t,n).next((s=>{const i=this.Fi(e,s);return this.$i(e,i,n,r)?this.Mi(t,e):(fr()<=o.in.DEBUG&&gr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Qi(e)),this.Bi(t,i,e,ts(r,-1)))}))}Fi(t,e){let n=new Ts(Xi(t));return e.forEach(((e,r)=>{Wi(t,r)&&(n=n.add(r))})),n}$i(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(t,e){return fr()<=o.in.DEBUG&&gr("QueryEngine","Using full collection scan to execute query:",Qi(e)),this.Ni.getDocumentsMatchingQuery(t,e,ns.min())}Bi(t,e,n,r){return this.Ni.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Yc{constructor(t,e,n,r){this.persistence=t,this.Li=e,this.It=r,this.Ui=new ks(Pr),this.qi=new Po((t=>mi(t)),yi),this.Ki=new Map,this.Gi=t.getRemoteDocumentCache(),this.Cs=t.getTargetCache(),this.Ns=t.getBundleCache(),this.Qi(n)}Qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Dc(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ui)))}}function Xc(t,e,n,r){return new Yc(t,e,n,r)}async function Zc(t,e){const n=Er(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n.Qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=Qo();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ji:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Jc(t){const e=Er(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Cs.getLastRemoteSnapshotVersion(t)))}function tl(t,e,n){let r=Qo(),s=Qo();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Bo();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(qr.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):gr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Wi:r,zi:s}}))}function el(t,e){const n=Er(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function nl(t,e){const n=Er(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Cs.getTargetData(t,e).next((s=>s?(r=s,as.resolve(r)):n.Cs.allocateTargetId(t).next((s=>(r=new gu(e,s,0,t.currentSequenceNumber),n.Cs.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Ui.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(t.targetId,t),n.qi.set(e,t.targetId)),t}))}async function rl(t,e,n){const r=Er(t),s=r.Ui.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!ds(t))throw t;gr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ui=r.Ui.remove(e),r.qi.delete(s.target)}function sl(t,e,n){const r=Er(t);let s=qr.min(),i=Qo();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=Er(t),s=r.qi.get(n);return void 0!==s?as.resolve(r.Ui.get(s)):r.Cs.getTargetData(e,n)}(r,t,Gi(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.Li.getDocumentsMatchingQuery(t,e,n?s:qr.min(),n?i:Qo()))).next((t=>(al(r,Yi(e),t),{documents:t,Hi:i})))))}function il(t,e){const n=Er(t),r=Er(n.Cs),s=n.Ui.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(t=>r.se(t,e).next((t=>t?t.target:null))))}function ol(t,e){const n=Er(t),r=n.Ki.get(e)||qr.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.Gi.getAllFromCollectionGroup(t,e,ts(r,-1),Number.MAX_SAFE_INTEGER))).then((t=>(al(n,e,t),t)))}function al(t,e,n){let r=t.Ki.get(e)||qr.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Ki.set(e,r)}async function ul(t,e,n=Qo()){const r=await nl(t,Gi(Su(e.bundledQuery))),s=Er(t);return s.persistence.runTransaction("Save named query","readwrite",(t=>{const i=da(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Ns.saveNamedQuery(t,e);const o=r.withResumeToken(Ns.EMPTY_BYTE_STRING,i);return s.Ui=s.Ui.insert(o.targetId,o),s.Cs.updateTargetData(t,o).next((()=>s.Cs.removeMatchingKeysForTargetId(t,r.targetId))).next((()=>s.Cs.addMatchingKeys(t,n,r.targetId))).next((()=>s.Ns.saveNamedQuery(t,e)))}))}function cl(t,e){return`firestore_clients_${t}_${e}`}function ll(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function hl(t,e){return`firestore_targets_${t}_${e}`}class dl{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Zi(t,e,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new Sr(r.error.code,r.error.message))),i?new dl(t,e,r.state,s):(mr("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}tr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class fl{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Zi(t,e){const n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new Sr(n.error.code,n.error.message))),s?new fl(t,n.state,r):(mr("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}tr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class pl{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Zi(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Yo();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Ks(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new pl(t,s):(mr("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class gl{constructor(t,e){this.clientId=t,this.onlineState=e}static Zi(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new gl(e.clientId,e.onlineState):(mr("SharedClientState",`Failed to parse online state: ${t}`),null)}}class ml{constructor(){this.activeTargetIds=Yo()}er(t){this.activeTargetIds=this.activeTargetIds.add(t)}nr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}tr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class yl{constructor(t,e,n,r,s){this.window=t,this.Hs=e,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ks(Pr),this.started=!1,this.cr=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=cl(this.persistenceKey,this.sr),this.hr=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new ml),this.lr=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.wr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.mr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.vi();for(const e of t){if(e===this.sr)continue;const t=this.getItem(cl(this.persistenceKey,e));if(t){const n=pl.Zi(e,t);n&&(this.ur=this.ur.insert(n.clientId,n))}}this.gr();const e=this.storage.getItem(this.wr);if(e){const t=this.yr(e);t&&this.pr(t)}for(const t of this.cr)this.rr(t);this.cr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.hr,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(t){let e=!1;return this.ur.forEach(((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Tr(t,"pending")}updateMutationState(t,e,n){this.Tr(t,e,n),this.Er(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(hl(this.persistenceKey,t));if(n){const r=fl.Zi(t,n);r&&(e=r.state)}}return this.Ar.er(t),this.gr(),e}removeLocalQueryTarget(t){this.Ar.nr(t),this.gr()}isLocalQueryTarget(t){return this.Ar.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(hl(this.persistenceKey,t))}updateQueryState(t,e,n){this.Rr(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Er(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.br(t)}notifyBundleLoaded(t){this.Pr(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return gr("SharedClientState","READ",t,e),e}setItem(t,e){gr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){gr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}rr(t){const e=t;if(e.storageArea===this.storage){if(gr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ar)return void mr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.lr.test(e.key)){if(null==e.newValue){const t=this.vr(e.key);return this.Vr(t,null)}{const t=this.Sr(e.key,e.newValue);if(t)return this.Vr(t.clientId,t)}}else if(this.dr.test(e.key)){if(null!==e.newValue){const t=this.Dr(e.key,e.newValue);if(t)return this.Cr(t)}}else if(this._r.test(e.key)){if(null!==e.newValue){const t=this.Nr(e.key,e.newValue);if(t)return this.kr(t)}}else if(e.key===this.wr){if(null!==e.newValue){const t=this.yr(e.newValue);if(t)return this.pr(t)}}else if(e.key===this.hr){const t=function(t){let e=ws.at;if(null!=t)try{const n=JSON.parse(t);br("number"==typeof n),e=n}catch(t){mr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==ws.at&&this.sequenceNumberHandler(t)}else if(e.key===this.mr){const t=this.Or(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Mr(t))))}}else this.cr.push(e)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(t,e,n){const r=new dl(this.currentUser,t,e,n),s=ll(this.persistenceKey,this.currentUser,t);this.setItem(s,r.tr())}Er(t){const e=ll(this.persistenceKey,this.currentUser,t);this.removeItem(e)}br(t){const e={clientId:this.sr,onlineState:t};this.storage.setItem(this.wr,JSON.stringify(e))}Rr(t,e,n){const r=hl(this.persistenceKey,t),s=new fl(t,e,n);this.setItem(r,s.tr())}Pr(t){const e=JSON.stringify(Array.from(t));this.setItem(this.mr,e)}vr(t){const e=this.lr.exec(t);return e?e[1]:null}Sr(t,e){const n=this.vr(t);return pl.Zi(n,e)}Dr(t,e){const n=this.dr.exec(t),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return dl.Zi(new lr(s),r,e)}Nr(t,e){const n=this._r.exec(t),r=Number(n[1]);return fl.Zi(r,e)}yr(t){return gl.Zi(t)}Or(t){return JSON.parse(t)}async Cr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Fr(t.batchId,t.state,t.error);gr("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}kr(t){return this.syncEngine.$r(t.targetId,t.state,t.error)}Vr(t,e){const n=e?this.ur.insert(t,e):this.ur.remove(t),r=this.Ir(this.ur),s=this.Ir(n),i=[],o=[];return s.forEach((t=>{r.has(t)||i.push(t)})),r.forEach((t=>{s.has(t)||o.push(t)})),this.syncEngine.Br(i,o).then((()=>{this.ur=n}))}pr(t){this.ur.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ir(t){let e=Yo();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class vl{constructor(){this.Lr=new ml,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Lr.er(t),this.Ur[t]||"not-current"}updateQueryState(t,e,n){this.Ur[t]=e}removeLocalQueryTarget(t){this.Lr.nr(t)}isLocalQueryTarget(t){return this.Lr.activeTargetIds.has(t)}clearQueryState(t){delete this.Ur[t]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(t){return this.Lr.activeTargetIds.has(t)}start(){return this.Lr=new ml,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class wl{qr(t){}shutdown(){}}class bl{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(t){this.Wr.push(t)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){gr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Wr)t(0)}jr(){gr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Wr)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Il={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class El{constructor(t){this.Hr=t.Hr,this.Jr=t.Jr}Yr(t){this.Xr=t}Zr(t){this.eo=t}onMessage(t){this.no=t}close(){this.Jr()}send(t){this.Hr(t)}so(){this.Xr()}io(t){this.eo(t)}ro(t){this.no(t)}}class kl extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.oo=e+"://"+t.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,n,r,s){const i=this.ho(t,e);gr("RestConnection","Sending: ",i,n);const o={};return this.lo(o,r,s),this.fo(t,i,o,n).then((t=>(gr("RestConnection","Received: ",t),t)),(e=>{throw yr("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}_o(t,e,n,r,s,i){return this.ao(t,e,n,r,s)}lo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+hr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}ho(t,e){const n=Il[t];return`${this.oo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}fo(t,e,n,r){return new Promise(((s,i)=>{const o=new ur;o.setWithCredentials(!0),o.listenOnce(rr.COMPLETE,(()=>{var e;try{switch(o.getLastErrorCode()){case nr.NO_ERROR:const n=o.getResponseJson();gr("Connection","XHR received:",JSON.stringify(n)),s(n);break;case nr.TIMEOUT:gr("Connection",'RPC "'+t+'" timed out'),i(new Sr(kr.DEADLINE_EXCEEDED,"Request time out"));break;case nr.HTTP_ERROR:const r=o.getStatus();if(gr("Connection",'RPC "'+t+'" failed with status:',r,"response text:",o.getResponseText()),r>0){let t=o.getResponseJson();Array.isArray(t)&&(t=t[0]);const n=null===(e=t)||void 0===e?void 0:e.error;if(n&&n.status&&n.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(kr).indexOf(e)>=0?e:kr.UNKNOWN}(n.status);i(new Sr(t,n.message))}else i(new Sr(kr.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Sr(kr.UNAVAILABLE,"Connection failed."));break;default:wr()}}finally{gr("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}wo(t,e,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=tr(),i=er(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new or({})),this.lo(o.initMessageHeaders,e,n),o.encodeInitMessageHeaders=!0;const a=r.join("");gr("Connection","Creating WebChannel: "+a,o);const u=s.createWebChannel(a,o);let c=!1,l=!1;const h=new El({Hr:t=>{l?gr("Connection","Not sending because WebChannel is closed:",t):(c||(gr("Connection","Opening WebChannel transport."),u.open(),c=!0),gr("Connection","WebChannel sending:",t),u.send(t))},Jr:()=>u.close()}),d=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return d(u,ar.EventType.OPEN,(()=>{l||gr("Connection","WebChannel transport opened.")})),d(u,ar.EventType.CLOSE,(()=>{l||(l=!0,gr("Connection","WebChannel transport closed"),h.io())})),d(u,ar.EventType.ERROR,(t=>{l||(l=!0,yr("Connection","WebChannel transport errored:",t),h.io(new Sr(kr.UNAVAILABLE,"The operation could not be completed")))})),d(u,ar.EventType.MESSAGE,(t=>{var e;if(!l){const n=t.data[0];br(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){gr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=Mo[t];if(void 0!==e)return Lo(e)}(t),n=s.message;void 0===e&&(e=kr.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),l=!0,h.io(new Sr(e,n)),u.close()}else gr("Connection","WebChannel received:",n),h.ro(n)}})),d(i,sr.STAT_EVENT,(t=>{t.stat===ir.PROXY?gr("Connection","Detected buffering proxy"):t.stat===ir.NOPROXY&&gr("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.so()}),0),h}}function Sl(){return"undefined"!=typeof window?window:null}function _l(){return"undefined"!=typeof document?document:null}function Tl(t){return new ua(t,!0)}class Al{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Hs=t,this.timerId=e,this.mo=n,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(t){this.cancel();const e=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,e-n);r>0&&gr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),t()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Cl{constructor(t,e,n,r,s,i,o,a){this.Hs=t,this.vo=n,this.Vo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Al(t,e)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(()=>this.$o())))}Bo(t){this.Lo(),this.stream.send(t)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(t,e){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==t?this.xo.reset():e&&e.code===kr.RESOURCE_EXHAUSTED?(mr(e.toString()),mr("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):e&&e.code===kr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Zr(e)}qo(){}auth(){this.state=1;const t=this.Ko(this.So),e=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.So===e&&this.Go(t,n)}),(e=>{t((()=>{const t=new Sr(kr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Qo(t)}))}))}Go(t,e){const n=this.Ko(this.So);this.stream=this.jo(t,e),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((t=>{n((()=>this.Qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Oo(){this.state=5,this.xo.Ro((async()=>{this.state=0,this.start()}))}Qo(t){return gr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Ko(t){return e=>{this.Hs.enqueueAndForget((()=>this.So===t?e():(gr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Dl extends Cl{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.It=s}jo(t,e){return this.connection.wo("Listen",t,e)}onMessage(t){this.xo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:wr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.gt?(br(void 0===e||"string"==typeof e),Ns.fromBase64String(e||"")):(br(void 0===e||e instanceof Uint8Array),Ns.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?kr.UNKNOWN:Lo(t.code);return new Sr(e,t.message||"")}(o);n=new ea(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ma(t,r.document.name),i=da(r.document.updateTime),o=new hi({mapValue:{fields:r.document.fields}}),a=fi.newFoundDocument(s,i,o),u=r.targetIds||[],c=r.removedTargetIds||[];n=new Jo(u,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ma(t,r.document),i=r.readTime?da(r.readTime):qr.min(),o=fi.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Jo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ma(t,r.document),i=r.removedTargetIds||[];n=new Jo([],i,s,null)}else{if(!("filter"in e))return wr();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,s=new Fo(r),i=t.targetId;n=new ta(i,s)}}return n}(this.It,t),n=function(t){if(!("targetChange"in t))return qr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?qr.min():e.readTime?da(e.readTime):qr.min()}(t);return this.listener.Wo(e,n)}zo(t){const e={};e.database=wa(this.It),e.addTarget=function(t,e){let n;const r=e.target;return n=vi(r)?{documents:_a(t,r)}:{query:Ta(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=la(t,e.resumeToken):e.snapshotVersion.compareTo(qr.min())>0&&(n.readTime=ca(t,e.snapshotVersion.toTimestamp())),n}(this.It,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return wr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.It,t);n&&(e.labels=n),this.Bo(e)}Ho(t){const e={};e.database=wa(this.It),e.removeTarget=t,this.Bo(e)}}class xl extends Cl{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.It=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(t,e){return this.connection.wo("Write",t,e)}onMessage(t){if(br(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Jo){this.xo.reset();const e=function(t,e){return t&&t.length>0?(br(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?da(t.updateTime):da(e);return n.isEqual(qr.min())&&(n=da(e)),new mo(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=da(t.commitTime);return this.listener.Zo(n,e)}return br(!t.writeResults||0===t.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const t={};t.database=wa(this.It),this.Bo(t)}Xo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>ka(this.It,t)))};this.Bo(e)}}class Nl extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.It=r,this.nu=!1}su(){if(this.nu)throw new Sr(kr.FAILED_PRECONDITION,"The client has already been terminated.")}ao(t,e,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.ao(t,e,n,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===kr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Sr(kr.UNKNOWN,t.toString())}))}_o(t,e,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection._o(t,e,n,s,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===kr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Sr(kr.UNKNOWN,t.toString())}))}terminate(){this.nu=!0}}class Fl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(t){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.cu("Offline")))}set(t){this.lu(),this.iu=0,"Online"===t&&(this.ou=!1),this.cu(t)}cu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}au(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(mr(e),this.ou=!1):gr("OnlineStateTracker",e)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class Ml{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.qr((t=>{n.enqueueAndForget((async()=>{jl(this)&&(gr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Er(t);e._u.add(4),await Ol(e),e.gu.set("Unknown"),e._u.delete(4),await Rl(e)}(this))}))})),this.gu=new Fl(n,r)}}async function Rl(t){if(jl(t))for(const e of t.wu)await e(!0)}async function Ol(t){for(const e of t.wu)await e(!1)}function Ll(t,e){const n=Er(t);n.du.has(e.targetId)||(n.du.set(e.targetId,e),ql(n)?Ul(n):oh(n).ko()&&Vl(n,e))}function Pl(t,e){const n=Er(t),r=oh(n);n.du.delete(e),r.ko()&&Bl(n,e),0===n.du.size&&(r.ko()?r.Fo():jl(n)&&n.gu.set("Unknown"))}function Vl(t,e){t.yu.Mt(e.targetId),oh(t).zo(e)}function Bl(t,e){t.yu.Mt(e),oh(t).Ho(e)}function Ul(t){t.yu=new ra({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t.du.get(e)||null}),oh(t).start(),t.gu.uu()}function ql(t){return jl(t)&&!oh(t).No()&&t.du.size>0}function jl(t){return 0===Er(t)._u.size}function Kl(t){t.yu=void 0}async function Gl(t){t.du.forEach(((e,n)=>{Vl(t,e)}))}async function $l(t,e){Kl(t),ql(t)?(t.gu.hu(e),Ul(t)):t.gu.set("Unknown")}async function zl(t,e,n){if(t.gu.set("Online"),e instanceof ea&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.du.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.du.delete(r),t.yu.removeTarget(r))}(t,e)}catch(n){gr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Hl(t,n)}else if(e instanceof Jo?t.yu.Gt(e):e instanceof ta?t.yu.Yt(e):t.yu.Wt(e),!n.isEqual(qr.min()))try{const e=await Jc(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.yu.te(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.du.get(r);s&&t.du.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.du.get(e);if(!n)return;t.du.set(e,n.withResumeToken(Ns.EMPTY_BYTE_STRING,n.snapshotVersion)),Bl(t,e);const r=new gu(n.target,e,1,n.sequenceNumber);Vl(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){gr("RemoteStore","Failed to raise snapshot:",e),await Hl(t,e)}}async function Hl(t,e,n){if(!ds(e))throw e;t._u.add(1),await Ol(t),t.gu.set("Offline"),n||(n=()=>Jc(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{gr("RemoteStore","Retrying IndexedDB access"),await n(),t._u.delete(1),await Rl(t)}))}function Ql(t,e){return e().catch((n=>Hl(t,n,e)))}async function Wl(t){const e=Er(t),n=ah(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Yl(e);)try{const t=await el(e.localStore,r);if(null===t){0===e.fu.length&&n.Fo();break}r=t.batchId,Xl(e,t)}catch(t){await Hl(e,t)}Zl(e)&&Jl(e)}function Yl(t){return jl(t)&&t.fu.length<10}function Xl(t,e){t.fu.push(e);const n=ah(t);n.ko()&&n.Yo&&n.Xo(e.mutations)}function Zl(t){return jl(t)&&!ah(t).No()&&t.fu.length>0}function Jl(t){ah(t).start()}async function th(t){ah(t).eu()}async function eh(t){const e=ah(t);for(const n of t.fu)e.Xo(n.mutations)}async function nh(t,e,n){const r=t.fu.shift(),s=fu.from(r,e,n);await Ql(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Wl(t)}async function rh(t,e){e&&ah(t).Yo&&await async function(t,e){if(Oo(n=e.code)&&n!==kr.ABORTED){const n=t.fu.shift();ah(t).Mo(),await Ql(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Wl(t)}var n}(t,e),Zl(t)&&Jl(t)}async function sh(t,e){const n=Er(t);n.asyncQueue.verifyOperationInProgress(),gr("RemoteStore","RemoteStore received new credentials");const r=jl(n);n._u.add(3),await Ol(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n._u.delete(3),await Rl(n)}async function ih(t,e){const n=Er(t);e?(n._u.delete(2),await Rl(n)):e||(n._u.add(2),await Ol(n),n.gu.set("Unknown"))}function oh(t){return t.pu||(t.pu=function(t,e,n){const r=Er(t);return r.su(),new Dl(e,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:Gl.bind(null,t),Zr:$l.bind(null,t),Wo:zl.bind(null,t)}),t.wu.push((async e=>{e?(t.pu.Mo(),ql(t)?Ul(t):t.gu.set("Unknown")):(await t.pu.stop(),Kl(t))}))),t.pu}function ah(t){return t.Iu||(t.Iu=function(t,e,n){const r=Er(t);return r.su(),new xl(e,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:th.bind(null,t),Zr:rh.bind(null,t),tu:eh.bind(null,t),Zo:nh.bind(null,t)}),t.wu.push((async e=>{e?(t.Iu.Mo(),await Wl(t)):(await t.Iu.stop(),t.fu.length>0&&(gr("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))}))),t.Iu}class uh{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new _r,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new uh(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Sr(kr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ch(t,e){if(mr("AsyncQueue",`${e}: ${t}`),ds(t))return new Sr(kr.UNAVAILABLE,`${e}: ${t}`);throw t}class lh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||zr.comparator(e.key,n.key):(t,e)=>zr.comparator(t.key,e.key),this.keyedMap=qo(),this.sortedSet=new ks(this.comparator)}static emptySet(t){return new lh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof lh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new lh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class hh{constructor(){this.Tu=new ks(zr.comparator)}track(t){const e=t.doc.key,n=this.Tu.get(e);n?0!==t.type&&3===n.type?this.Tu=this.Tu.insert(e,t):3===t.type&&1!==n.type?this.Tu=this.Tu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Tu=this.Tu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Tu=this.Tu.remove(e):1===t.type&&2===n.type?this.Tu=this.Tu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):wr():this.Tu=this.Tu.insert(e,t)}Eu(){const t=[];return this.Tu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class dh{constructor(t,e,n,r,s,i,o,a,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=u}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new dh(t,e,lh.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&zi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class fh{constructor(){this.Au=void 0,this.listeners=[]}}class ph{constructor(){this.queries=new Po((t=>Hi(t)),zi),this.onlineState="Unknown",this.Ru=new Set}}async function gh(t,e){const n=Er(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new fh),s)try{i.Au=await n.onListen(r)}catch(t){const n=ch(t,`Initialization of query '${Qi(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.bu(n.onlineState),i.Au&&e.Pu(i.Au)&&wh(n)}async function mh(t,e){const n=Er(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function yh(t,e){const n=Er(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Pu(t)&&(r=!0);s.Au=t}}r&&wh(n)}function vh(t,e,n){const r=Er(t),s=r.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);r.queries.delete(e)}function wh(t){t.Ru.forEach((t=>{t.next()}))}class bh{constructor(t,e,n){this.query=t,this.vu=e,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new dh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Vu?this.Du(t)&&(this.vu.next(t),e=!0):this.Cu(t,this.onlineState)&&(this.xu(t),e=!0),this.Su=t,e}onError(t){this.vu.error(t)}bu(t){this.onlineState=t;let e=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,t)&&(this.xu(this.Su),e=!0),e}Cu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Nu||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Du(t){if(t.docChanges.length>0)return!0;const e=this.Su&&this.Su.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}xu(t){t=dh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Vu=!0,this.vu.next(t)}}class Ih{constructor(t,e){this.ku=t,this.byteLength=e}Ou(){return"metadata"in this.ku}}class Eh{constructor(t){this.It=t}Ji(t){return ma(this.It,t)}Yi(t){return t.metadata.exists?Ea(this.It,t.document,!1):fi.newNoDocument(this.Ji(t.metadata.name),this.Xi(t.metadata.readTime))}Xi(t){return da(t)}}class kh{constructor(t,e,n){this.Mu=t,this.localStore=e,this.It=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Sh(t)}Fu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ku.namedQuery)this.queries.push(t.ku.namedQuery);else if(t.ku.documentMetadata){this.documents.push({metadata:t.ku.documentMetadata}),t.ku.documentMetadata.exists||++e;const n=Kr.fromString(t.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.ku.document&&(this.documents[this.documents.length-1].document=t.ku.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}$u(t){const e=new Map,n=new Eh(this.It);for(const r of t)if(r.metadata.queries){const t=n.Ji(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||Qo()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=Er(t);let i=Qo(),o=Bo();for(const t of n){const n=e.Ji(t.metadata.name);t.document&&(i=i.add(n));const r=e.Yi(t);r.setReadTime(e.Xi(t.metadata.readTime)),o=o.insert(n,r)}const a=s.Gi.newChangeBuffer({trackRemovals:!0}),u=await nl(s,function(t){return Gi(Vi(Kr.fromString(`__bundle__/docs/${t}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(t=>tl(t,a,o).next((e=>(a.apply(t),e))).next((e=>s.Cs.removeMatchingKeysForTargetId(t,u.targetId).next((()=>s.Cs.addMatchingKeys(t,i,u.targetId))).next((()=>s.localDocuments.getLocalViewOfDocuments(t,e.Wi,e.zi))).next((()=>e.Wi))))))}(this.localStore,new Eh(this.It),this.documents,this.Mu.id),e=this.$u(this.documents);for(const t of this.queries)await ul(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:t}}}function Sh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class _h{constructor(t){this.key=t}}class Th{constructor(t){this.key=t}}class Ah{constructor(t,e){this.query=t,this.Uu=e,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=Qo(),this.mutatedKeys=Qo(),this.Gu=Xi(t),this.Qu=new lh(this.Gu)}get ju(){return this.Uu}Wu(t,e){const n=e?e.zu:new hh,r=e?e.Qu:this.Qu;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,u="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const c=r.get(t),l=Wi(this.query,e)?e:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;c&&l?c.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Hu(c,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Gu(l,a)>0||u&&this.Gu(l,u)<0)&&(o=!0)):!c&&l?(n.track({type:0,doc:l}),f=!0):c&&!l&&(n.track({type:1,doc:c}),f=!0,(a||u)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Qu:i,zu:n,$i:o,mutatedKeys:s}}Hu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.Qu;this.Qu=t.Qu,this.mutatedKeys=t.mutatedKeys;const s=t.zu.Eu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return wr()}};return n(t)-n(e)}(t.type,e.type)||this.Gu(t.doc,e.doc))),this.Ju(n);const i=e?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.qu;return this.qu=o,0!==s.length||a?{snapshot:new dh(this.query,t.Qu,r,s,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:i}:{Xu:i}}bu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new hh,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(t){return!this.Uu.has(t)&&!!this.Qu.has(t)&&!this.Qu.get(t).hasLocalMutations}Ju(t){t&&(t.addedDocuments.forEach((t=>this.Uu=this.Uu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Uu=this.Uu.delete(t))),this.current=t.current)}Yu(){if(!this.current)return[];const t=this.Ku;this.Ku=Qo(),this.Qu.forEach((t=>{this.Zu(t.key)&&(this.Ku=this.Ku.add(t.key))}));const e=[];return t.forEach((t=>{this.Ku.has(t)||e.push(new Th(t))})),this.Ku.forEach((n=>{t.has(n)||e.push(new _h(n))})),e}tc(t){this.Uu=t.Hi,this.Ku=Qo();const e=this.Wu(t.documents);return this.applyChanges(e,!0)}ec(){return dh.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class Ch{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Dh{constructor(t){this.key=t,this.nc=!1}}class xh{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.sc={},this.ic=new Po((t=>Hi(t)),zi),this.rc=new Map,this.oc=new Set,this.uc=new ks(zr.comparator),this.cc=new Map,this.ac=new Fc,this.hc={},this.lc=new Map,this.fc=uc.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function Nh(t,e){const n=rd(t);let r,s;const i=n.ic.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const t=await nl(n.localStore,Gi(e));n.isPrimaryClient&&Ll(n.remoteStore,t);const i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await Fh(n,e,r,"current"===i,t.resumeToken)}return s}async function Fh(t,e,n,r,s){t._c=(e,n,r)=>async function(t,e,n,r){let s=e.view.Wu(n);s.$i&&(s=await sl(t.localStore,e.query,!1).then((({documents:t})=>e.view.Wu(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return Kh(t,e.targetId,o.Xu),o.snapshot}(t,e,n,r);const i=await sl(t.localStore,e,!0),o=new Ah(e,i.Hi),a=o.Wu(i.documents),u=Zo.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),c=o.applyChanges(a,t.isPrimaryClient,u);Kh(t,n,c.Xu);const l=new Ch(e,n,o);return t.ic.set(e,l),t.rc.has(n)?t.rc.get(n).push(e):t.rc.set(n,[e]),c.snapshot}async function Mh(t,e){const n=Er(t),r=n.ic.get(e),s=n.rc.get(r.targetId);if(s.length>1)return n.rc.set(r.targetId,s.filter((t=>!zi(t,e)))),void n.ic.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await rl(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Pl(n.remoteStore,r.targetId),qh(n,r.targetId)})).catch(os)):(qh(n,r.targetId),await rl(n.localStore,r.targetId,!0))}async function Rh(t,e){const n=Er(t);try{const t=await function(t,e){const n=Er(t),r=e.snapshotVersion;let s=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Gi.newChangeBuffer({trackRemovals:!0});s=n.Ui;const o=[];e.targetChanges.forEach(((i,a)=>{const u=s.get(a);if(!u)return;o.push(n.Cs.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Cs.addMatchingKeys(t,i.addedDocuments,a))));let c=u.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?c=c.withResumeToken(Ns.EMPTY_BYTE_STRING,qr.min()).withLastLimboFreeSnapshotVersion(qr.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),s=s.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,i)&&o.push(n.Cs.updateTargetData(t,c))}));let a=Bo(),u=Qo();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(tl(t,i,e.documentUpdates).next((t=>{a=t.Wi,u=t.zi}))),!r.isEqual(qr.min())){const e=n.Cs.getLastRemoteSnapshotVersion(t).next((e=>n.Cs.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return as.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,u))).next((()=>a))})).then((t=>(n.Ui=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.cc.get(e);r&&(br(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.nc=!0:t.modifiedDocuments.size>0?br(r.nc):t.removedDocuments.size>0&&(br(r.nc),r.nc=!1))})),await zh(n,t,e)}catch(t){await os(t)}}function Oh(t,e,n){const r=Er(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ic.forEach(((n,r)=>{const s=r.view.bu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Er(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.bu(e)&&(r=!0)})),r&&wh(n)}(r.eventManager,e),t.length&&r.sc.Wo(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Lh(t,e,n){const r=Er(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.cc.get(e),i=s&&s.key;if(i){let t=new ks(zr.comparator);t=t.insert(i,fi.newNoDocument(i,qr.min()));const n=Qo().add(i),s=new Xo(qr.min(),new Map,new Ts(Pr),t,n);await Rh(r,s),r.uc=r.uc.remove(i),r.cc.delete(e),$h(r)}else await rl(r.localStore,e,!1).then((()=>qh(r,e,n))).catch(os)}async function Ph(t,e){const n=Er(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Er(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Gi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=as.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);br(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Qo();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Uh(n,r,null),Bh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zh(n,t)}catch(t){await os(t)}}async function Vh(t,e,n){const r=Er(t);try{const t=await function(t,e){const n=Er(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(br(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Uh(r,e,n),Bh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await zh(r,t)}catch(n){await os(n)}}function Bh(t,e){(t.lc.get(e)||[]).forEach((t=>{t.resolve()})),t.lc.delete(e)}function Uh(t,e,n){const r=Er(t);let s=r.hc[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.hc[r.currentUser.toKey()]=s}}function qh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach((e=>{t.ac.containsKey(e)||jh(t,e)}))}function jh(t,e){t.oc.delete(e.path.canonicalString());const n=t.uc.get(e);null!==n&&(Pl(t.remoteStore,n),t.uc=t.uc.remove(e),t.cc.delete(n),$h(t))}function Kh(t,e,n){for(const r of n)r instanceof _h?(t.ac.addReference(r.key,e),Gh(t,r)):r instanceof Th?(gr("SyncEngine","Document no longer in limbo: "+r.key),t.ac.removeReference(r.key,e),t.ac.containsKey(r.key)||jh(t,r.key)):wr()}function Gh(t,e){const n=e.key,r=n.path.canonicalString();t.uc.get(n)||t.oc.has(r)||(gr("SyncEngine","New document in limbo: "+n),t.oc.add(r),$h(t))}function $h(t){for(;t.oc.size>0&&t.uc.size<t.maxConcurrentLimboResolutions;){const e=t.oc.values().next().value;t.oc.delete(e);const n=new zr(Kr.fromString(e)),r=t.fc.next();t.cc.set(r,new Dh(n)),t.uc=t.uc.insert(n,r),Ll(t.remoteStore,new gu(Gi(Vi(n.path)),r,2,ws.at))}}async function zh(t,e,n){const r=Er(t),s=[],i=[],o=[];r.ic.isEmpty()||(r.ic.forEach(((t,a)=>{o.push(r._c(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Qc.Ci(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.sc.Wo(s),await async function(t,e){const n=Er(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>as.forEach(e,(e=>as.forEach(e.Si,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>as.forEach(e.Di,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!ds(t))throw t;gr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ui.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.Ui=n.Ui.insert(e,s)}}}(r.localStore,i))}async function Hh(t,e){const n=Er(t);if(!n.currentUser.isEqual(e)){gr("SyncEngine","User change. New user:",e.toKey());const t=await Zc(n.localStore,e);n.currentUser=e,function(t,e){t.lc.forEach((t=>{t.forEach((t=>{t.reject(new Sr(kr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.lc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await zh(n,t.ji)}}function Qh(t,e){const n=Er(t),r=n.cc.get(e);if(r&&r.nc)return Qo().add(r.key);{let t=Qo();const r=n.rc.get(e);if(!r)return t;for(const e of r){const r=n.ic.get(e);t=t.unionWith(r.view.ju)}return t}}async function Wh(t,e){const n=Er(t),r=await sl(n.localStore,e.query,!0),s=e.view.tc(r);return n.isPrimaryClient&&Kh(n,e.targetId,s.Xu),s}async function Yh(t,e){const n=Er(t);return ol(n.localStore,e).then((t=>zh(n,t)))}async function Xh(t,e,n,r){const s=Er(t),i=await function(t,e){const n=Er(t),r=Er(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>r.Tn(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):as.resolve(null)))))}(s.localStore,e);null!==i?("pending"===n?await Wl(s.remoteStore):"acknowledged"===n||"rejected"===n?(Uh(s,e,r||null),Bh(s,e),function(t,e){Er(Er(t).mutationQueue).An(e)}(s.localStore,e)):wr(),await zh(s,i)):gr("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Zh(t,e,n){const r=Er(t),s=[],i=[];for(const t of e){let e;const n=r.rc.get(t);if(n&&0!==n.length){e=await nl(r.localStore,Gi(n[0]));for(const t of n){const e=r.ic.get(t),n=await Wh(r,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await il(r.localStore,t);e=await nl(r.localStore,n),await Fh(r,Jh(n),t,!1,e.resumeToken)}s.push(e)}return r.sc.Wo(i),s}function Jh(t){return Pi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function td(t){const e=Er(t);return Er(Er(e.localStore).persistence).vi()}async function ed(t,e,n,r){const s=Er(t);if(s.dc)return void gr("SyncEngine","Ignoring unexpected query state notification.");const i=s.rc.get(e);if(i&&i.length>0)switch(n){case"current":case"not-current":{const t=await ol(s.localStore,Yi(i[0])),r=Xo.createSynthesizedRemoteEventForCurrentChange(e,"current"===n,Ns.EMPTY_BYTE_STRING);await zh(s,t,r);break}case"rejected":await rl(s.localStore,e,!0),qh(s,e,r);break;default:wr()}}async function nd(t,e,n){const r=rd(t);if(r.dc){for(const t of e){if(r.rc.has(t)){gr("SyncEngine","Adding an already active target "+t);continue}const e=await il(r.localStore,t),n=await nl(r.localStore,e);await Fh(r,Jh(e),n.targetId,!1,n.resumeToken),Ll(r.remoteStore,n)}for(const t of n)r.rc.has(t)&&await rl(r.localStore,t,!1).then((()=>{Pl(r.remoteStore,t),qh(r,t)})).catch(os)}}function rd(t){const e=Er(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Rh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Lh.bind(null,e),e.sc.Wo=yh.bind(null,e.eventManager),e.sc.wc=vh.bind(null,e.eventManager),e}function sd(t){const e=Er(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ph.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vh.bind(null,e),e}class id{constructor(){this.synchronizeTabs=!1}async initialize(t){this.It=Tl(t.databaseInfo.databaseId),this.sharedClientState=this.gc(t),this.persistence=this.yc(t),await this.persistence.start(),this.localStore=this.Ic(t),this.gcScheduler=this.Tc(t,this.localStore),this.indexBackfillerScheduler=this.Ec(t,this.localStore)}Tc(t,e){return null}Ec(t,e){return null}Ic(t){return Xc(this.persistence,new Wc,t.initialUser,this.It)}yc(t){return new Vc(Uc.Bs,this.It)}gc(t){return new vl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class od extends id{constructor(t,e,n){super(),this.Ac=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Ac.initialize(this,t),await sd(this.Ac.syncEngine),await Wl(this.Ac.remoteStore),await this.persistence.li((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Ic(t){return Xc(this.persistence,new Wc,t.initialUser,this.It)}Tc(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new gc(n,t.asyncQueue,e)}Ec(t,e){const n=new vs(e,this.persistence);return new ys(t.asyncQueue,n)}yc(t){const e=Hc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?tc.withCacheSize(this.cacheSizeBytes):tc.DEFAULT;return new Gc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Sl(),_l(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(t){return new vl}}class ad extends od{constructor(t,e){super(t,e,!1),this.Ac=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Ac.syncEngine;this.sharedClientState instanceof yl&&(this.sharedClientState.syncEngine={Fr:Xh.bind(null,e),$r:ed.bind(null,e),Br:nd.bind(null,e),vi:td.bind(null,e),Mr:Yh.bind(null,e)},await this.sharedClientState.start()),await this.persistence.li((async t=>{await async function(t,e){const n=Er(t);if(rd(n),sd(n),!0===e&&!0!==n.dc){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Zh(n,t.toArray());n.dc=!0,await ih(n.remoteStore,!0);for(const t of e)Ll(n.remoteStore,t)}else if(!1===e&&!1!==n.dc){const t=[];let e=Promise.resolve();n.rc.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?t.push(s):e=e.then((()=>(qh(n,s),rl(n.localStore,s,!0)))),Pl(n.remoteStore,s)})),await e,await Zh(n,t),function(t){const e=Er(t);e.cc.forEach(((t,n)=>{Pl(e.remoteStore,n)})),e.ac.fs(),e.cc=new Map,e.uc=new ks(zr.comparator)}(n),n.dc=!1,await ih(n.remoteStore,!1)}}(this.Ac.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}gc(t){const e=Sl();if(!yl.C(e))throw new Sr(kr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Hc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new yl(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class ud{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Oh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hh.bind(null,this.syncEngine),await ih(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ph}createDatastore(t){const e=Tl(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new kl(r));var r;return function(t,e,n,r){return new Nl(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>Oh(this.syncEngine,t,0),i=bl.C()?new bl:new wl,new Ml(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new xh(t,e,n,r,s,i);return o&&(a.dc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Er(t);gr("RemoteStore","RemoteStore shutting down."),e._u.add(5),await Ol(e),e.mu.shutdown(),e.gu.set("Unknown")}(this.remoteStore)}}function cd(t,e,n){if(!n)throw new Sr(kr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ld(t,e,n,r){if(!0===e&&!0===r)throw new Sr(kr.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function hd(t){if(!zr.isDocumentKey(t))throw new Sr(kr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function dd(t){if(zr.isDocumentKey(t))throw new Sr(kr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function fd(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":wr()}function pd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Sr(kr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=fd(t);throw new Sr(kr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function gd(t,e){if(e<=0)throw new Sr(kr.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}const md=new Map;class yd{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Sr(kr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Sr(kr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ld("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class vd{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Sr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Sr(kr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ar;switch(t.type){case"gapi":const e=t.client;return new Nr(e,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Sr(kr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=md.get(t);e&&(gr("ComponentProvider","Removing Datastore"),md.delete(t),e.terminate())}(this),Promise.resolve()}}function wd(t,e,n,r={}){var s;const i=(t=pd(t,vd))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&yr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=lr.MOCK_USER;else{e=(0,a.Sg)(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Sr(kr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new lr(i)}t._authCredentials=new Cr(new Tr(e,n))}}class bd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ed(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new bd(this.firestore,t,this._key)}}class Id{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Id(this.firestore,t,this._query)}}class Ed extends Id{constructor(t,e,n){super(t,e,Vi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new bd(this.firestore,null,new zr(t))}withConverter(t){return new Ed(this.firestore,t,this._path)}}function kd(t,e,...n){if(t=(0,a.m9)(t),cd("collection","path",e),t instanceof vd){const r=Kr.fromString(e,...n);return dd(r),new Ed(t,null,r)}{if(!(t instanceof bd||t instanceof Ed))throw new Sr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Kr.fromString(e,...n));return dd(r),new Ed(t.firestore,null,r)}}function Sd(t,e){if(t=pd(t,vd),cd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Sr(kr.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Id(t,null,function(t){return new Li(Kr.emptyPath(),t)}(e))}function _d(t,e,...n){if(t=(0,a.m9)(t),1===arguments.length&&(e=Lr.R()),cd("doc","path",e),t instanceof vd){const r=Kr.fromString(e,...n);return hd(r),new bd(t,null,new zr(r))}{if(!(t instanceof bd||t instanceof Ed))throw new Sr(kr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Kr.fromString(e,...n));return hd(r),new bd(t.firestore,t instanceof Ed?t.converter:null,new zr(r))}}function Td(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),(t instanceof bd||t instanceof Ed)&&(e instanceof bd||e instanceof Ed)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Ad(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),t instanceof Id&&e instanceof Id&&t.firestore===e.firestore&&zi(t._query,e._query)&&t.converter===e.converter}function Cd(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Dd{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Rc(this.observer.next,t)}error(t){this.observer.error?this.Rc(this.observer.error,t):mr("Uncaught Error in snapshot listener:",t.toString())}bc(){this.muted=!0}Rc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class xd{constructor(t,e){this.Pc=t,this.It=e,this.metadata=new _r,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then((t=>{t&&t.Ou()?this.metadata.resolve(t.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.ku)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const t=await this.Sc();if(null===t)return null;const e=this.vc.decode(t),n=Number(e);isNaN(n)&&this.Dc(`length string (${e}) is not valid number`);const r=await this.Cc(n);return new Ih(JSON.parse(r),t.length+n)}xc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;const t=this.xc();t<0&&this.Dc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Cc(t){for(;this.buffer.length<t;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const e=this.vc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Dc(t){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${t}`)}async Nc(){const t=await this.Pc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Nd{constructor(){this.type="AggregateField"}}class Fd{constructor(t,e){this._data=e,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._data}}class Md{constructor(t,e,n){this.query=t,this.datastore=e,this.userDataWriter=n}run(){return async function(t,e){const n=Er(t),r=function(t,e){const n=Ta(t,e);return{structuredAggregationQuery:{aggregations:[{count:{},alias:"count_alias"}],structuredQuery:n.structuredQuery},parent:n.parent}}(n.It,Gi(e)),s=r.parent;return n.connection.co||delete r.parent,(await n._o("RunAggregationQuery",s,r,1)).filter((t=>!!t.result)).map((t=>t.result.aggregateFields))}(this.datastore,this.query._query).then((t=>{br(void 0!==t[0]);const e=Object.entries(t[0]).filter((([t,e])=>"count_alias"===t)).map((([t,e])=>this.userDataWriter.convertValue(e)))[0];return br("number"==typeof e),Promise.resolve(new Fd(this.query,{count:e}))}))}}class Rd{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Sr(kr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Er(t),r=wa(n.It)+"/documents",s={documents:e.map((t=>ga(n.It,t)))},i=await n._o("BatchGetDocuments",r,s,e.length),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){br(!!e.found),e.found.name,e.found.updateTime;const n=ma(t,e.found.name),r=da(e.found.updateTime),s=new hi({mapValue:{fields:e.found.fields}});return fi.newFoundDocument(n,r,s)}(t,e):"missing"in e?function(t,e){br(!!e.missing),br(!!e.readTime);const n=ma(t,e.missing),r=da(e.readTime);return fi.newNoDocument(n,r)}(t,e):wr()}(n.It,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());br(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new xo(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=zr.fromPath(e);this.mutations.push(new No(n,this.precondition(n)))})),await async function(t,e){const n=Er(t),r=wa(n.It)+"/documents",s={writes:e.map((t=>ka(n.It,t)))};await n.ao("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw wr();e=qr.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Sr(kr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(qr.min())?yo.exists(!1):yo.updateTime(e):yo.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(qr.min()))throw new Sr(kr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return yo.updateTime(e)}return yo.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class Od{constructor(t,e,n,r,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=r,this.deferred=s,this.kc=n.maxAttempts,this.xo=new Al(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro((async()=>{const t=new Rd(this.datastore),e=this.Mc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Fc(t)}))))})).catch((t=>{this.Fc(t)}))}))}Mc(t){try{const e=this.updateFunction(t);return!qs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(t){this.kc>0&&this.$c(t)?(this.kc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Oc(),Promise.resolve())))):this.deferred.reject(t)}$c(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!Oo(e)}return!1}}class Ld{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=lr.UNAUTHENTICATED,this.clientId=Lr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{gr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(gr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Sr(kr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new _r;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ch(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Pd(t,e){t.asyncQueue.verifyOperationInProgress(),gr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Zc(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function Vd(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Bd(t);gr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>sh(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>sh(e.remoteStore,n))),t.onlineComponents=e}async function Bd(t){return t.offlineComponents||(gr("FirestoreClient","Using default OfflineComponentProvider"),await Pd(t,new id)),t.offlineComponents}async function Ud(t){return t.onlineComponents||(gr("FirestoreClient","Using default OnlineComponentProvider"),await Vd(t,new ud)),t.onlineComponents}function qd(t){return Bd(t).then((t=>t.persistence))}function jd(t){return Bd(t).then((t=>t.localStore))}function Kd(t){return Ud(t).then((t=>t.remoteStore))}function Gd(t){return Ud(t).then((t=>t.syncEngine))}function $d(t){return Ud(t).then((t=>t.datastore))}async function zd(t){const e=await Ud(t),n=e.eventManager;return n.onListen=Nh.bind(null,e.syncEngine),n.onUnlisten=Mh.bind(null,e.syncEngine),n}function Hd(t,e,n={}){const r=new _r;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new Dd({next:i=>{e.enqueueAndForget((()=>mh(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new Sr(kr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new Sr(kr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new bh(Vi(n.path),i,{includeMetadataChanges:!0,Nu:!0});return gh(t,o)}(await zd(t),t.asyncQueue,e,n,r))),r.promise}function Qd(t,e,n={}){const r=new _r;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new Dd({next:n=>{e.enqueueAndForget((()=>mh(t,o))),n.fromCache&&"server"===r.source?s.reject(new Sr(kr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new bh(n,i,{includeMetadataChanges:!0,Nu:!0});return gh(t,o)}(await zd(t),t.asyncQueue,e,n,r))),r.promise}class Wd{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Al(this,"async_queue_retry"),this.Wc=()=>{const t=_l();t&&gr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const t=_l();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.zc(),this.Hc(t)}enterRestrictedMode(t){if(!this.Uc){this.Uc=!0,this.Qc=t||!1;const e=_l();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Wc)}}enqueue(t){if(this.zc(),this.Uc)return new Promise((()=>{}));const e=new _r;return this.Hc((()=>this.Uc&&this.Qc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Lc.push(t),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(t){if(!ds(t))throw t;gr("AsyncQueue","Operation failed with retryable error: "+t)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(t){const e=this.Bc.then((()=>(this.Gc=!0,t().catch((t=>{this.Kc=t,this.Gc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw mr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Gc=!1,t))))));return this.Bc=e,e}enqueueAfterDelay(t,e,n){this.zc(),this.jc.indexOf(t)>-1&&(e=0);const r=uh.createAndSchedule(this,t,e,n,(t=>this.Yc(t)));return this.qc.push(r),r}zc(){this.Kc&&wr()}verifyOperationInProgress(){}async Xc(){let t;do{t=this.Bc,await t}while(t!==this.Bc)}Zc(t){for(const e of this.qc)if(e.timerId===t)return!0;return!1}ta(t){return this.Xc().then((()=>{this.qc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.qc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Xc()}))}ea(t){this.jc.push(t)}Yc(t){const e=this.qc.indexOf(t);this.qc.splice(e,1)}}function Yd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Xd{constructor(){this._progressObserver={},this._taskCompletionResolver=new _r,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Zd=-1;class Jd extends vd{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Wd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||rf(this),this._firestoreClient.terminate()}}function tf(t,e,n){n||(n="(default)");const r=(0,s.qX)(t,"firestore");if(r.isInitialized(n)){const t=r.getImmediate({identifier:n}),s=r.getOptions(n);if((0,a.vZ)(s,e))return t;throw new Sr(kr.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Sr(kr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:n})}function ef(t,e){const n="object"==typeof t?t:(0,s.Mq)(),r="string"==typeof t?t:e||"(default)",i=(0,s.qX)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const t=(0,a.P0)("firestore");t&&wd(i,...t)}return i}function nf(t){return t._firestoreClient||rf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function rf(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new Bs(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Ld(t._authCredentials,t._appCheckCredentials,t._queue,r)}function sf(t,e){gf(t=pd(t,Jd));const n=nf(t),r=t._freezeSettings(),s=new ud;return af(n,s,new od(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function of(t){gf(t=pd(t,Jd));const e=nf(t),n=t._freezeSettings(),r=new ud;return af(e,r,new ad(r,n.cacheSizeBytes))}function af(t,e,n){const r=new _r;return t.asyncQueue.enqueue((async()=>{try{await Pd(t,n),await Vd(t,e),r.resolve()}catch(t){const e=t;if(!function(t){return"FirebaseError"===t.name?t.code===kr.FAILED_PRECONDITION||t.code===kr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(e))throw e;yr("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function uf(t){if(t._initialized&&!t._terminated)throw new Sr(kr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new _r;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!cs.C())return Promise.resolve();const e=t+"main";await cs.delete(e)}(Hc(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function cf(t){return function(t){const e=new _r;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Er(t);jl(n.remoteStore)||gr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=Er(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const r=n.lc.get(t)||[];r.push(e),n.lc.set(t,r)}catch(t){const n=ch(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Gd(t),e))),e.promise}(nf(t=pd(t,Jd)))}function lf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await qd(t),n=await Kd(t);return e.setNetworkEnabled(!0),function(t){const e=Er(t);return e._u.delete(0),Rl(e)}(n)}))}(nf(t=pd(t,Jd)))}function hf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await qd(t),n=await Kd(t);return e.setNetworkEnabled(!1),async function(t){const e=Er(t);e._u.add(0),await Ol(e),e.gu.set("Offline")}(n)}))}(nf(t=pd(t,Jd)))}function df(t){return(0,s.wN)(t.app,"firestore",t._databaseId.database),t._delete()}function ff(t,e){const n=nf(t=pd(t,Jd)),r=new Xd;return function(t,e,n,r){const s=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new xd(t,e)}(function(t,e){if(t instanceof Uint8Array)return Cd(t,e);if(t instanceof ArrayBuffer)return Cd(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Tl(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const r=Er(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=Er(t),r=da(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Ns.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(r)>=0))}(t.localStore,r))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(Sh(r));const s=new kh(r,t.localStore,e.It);let i=await e.mc();for(;i;){const t=await s.Fu(i);t&&n._updateProgress(t),i=await e.mc()}const o=await s.complete();return await zh(t,o.Lu,void 0),await function(t,e){const n=Er(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Ns.saveBundleMetadata(t,e)))}(t.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Bu)}catch(t){return yr("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(r,e,n).then((t=>{r.sharedClientState.notifyBundleLoaded(t)}))}(await Gd(t),s,r)}))}(n,t._databaseId,e,r),r}function pf(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=Er(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Ns.getNamedQuery(t,e)))}(await jd(t),e)))}(nf(t=pd(t,Jd)),e).then((e=>e?new Id(t,null,e.query):null))}function gf(t){if(t._initialized||t._terminated)throw new Sr(kr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class mf{constructor(t){this._byteString=t}static fromBase64String(t){try{return new mf(Ns.fromBase64String(t))}catch(t){throw new Sr(kr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new mf(Ns.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class yf{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Sr(kr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $r(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function vf(){return new yf("__name__")}class wf{constructor(t){this._methodName=t}}class bf{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Sr(kr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Sr(kr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Pr(this._lat,t._lat)||Pr(this._long,t._long)}}const If=/^__.*__$/;class Ef{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new To(t,this.data,this.fieldMask,e,this.fieldTransforms):new _o(t,this.data,e,this.fieldTransforms)}}class kf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new To(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Sf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw wr()}}class _f{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.It=n,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(t){return new _f(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ia({path:n,oa:!1});return r.ua(t),r}ca(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ia({path:n,oa:!1});return r.na(),r}aa(t){return this.ia({path:void 0,oa:!0})}ha(t){return $f(t,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}na(){if(this.path)for(let t=0;t<this.path.length;t++)this.ua(this.path.get(t))}ua(t){if(0===t.length)throw this.ha("Document fields must not be empty");if(Sf(this.sa)&&If.test(t))throw this.ha('Document fields cannot begin and end with "__"')}}class Tf{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.It=n||Tl(t)}da(t,e,n,r=!1){return new _f({sa:t,methodName:e,fa:n,path:$r.emptyPath(),oa:!1,la:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function Af(t){const e=t._freezeSettings(),n=Tl(t._databaseId);return new Tf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Cf(t,e,n,r,s,i={}){const o=t.da(i.merge||i.mergeFields?2:0,e,n,s);qf("Data must be an object, but it was:",o,r);const a=Bf(r,o);let u,c;if(i.merge)u=new Ds(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=jf(e,r,n);if(!o.contains(s))throw new Sr(kr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);zf(t,s)||t.push(s)}u=new Ds(t),c=o.fieldTransforms.filter((t=>u.covers(t.field)))}else u=null,c=o.fieldTransforms;return new Ef(new hi(a),u,c)}class Df extends wf{_toFieldTransform(t){if(2!==t.sa)throw 1===t.sa?t.ha(`${this._methodName}() can only appear at the top level of your update data`):t.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Df}}function xf(t,e,n){return new _f({sa:3,fa:e.settings.fa,methodName:t._methodName,oa:n},e.databaseId,e.It,e.ignoreUndefinedProperties)}class Nf extends wf{_toFieldTransform(t){return new go(t.path,new oo)}isEqual(t){return t instanceof Nf}}class Ff extends wf{constructor(t,e){super(t),this._a=e}_toFieldTransform(t){const e=xf(this,t,!0),n=this._a.map((t=>Vf(t,e))),r=new ao(n);return new go(t.path,r)}isEqual(t){return this===t}}class Mf extends wf{constructor(t,e){super(t),this._a=e}_toFieldTransform(t){const e=xf(this,t,!0),n=this._a.map((t=>Vf(t,e))),r=new co(n);return new go(t.path,r)}isEqual(t){return this===t}}class Rf extends wf{constructor(t,e){super(t),this.wa=e}_toFieldTransform(t){const e=new ho(t.It,eo(t.It,this.wa));return new go(t.path,e)}isEqual(t){return this===t}}function Of(t,e,n,r){const s=t.da(1,e,n);qf("Data must be an object, but it was:",s,r);const i=[],o=hi.empty();Is(r,((t,r)=>{const u=Gf(e,t,n);r=(0,a.m9)(r);const c=s.ca(u);if(r instanceof Df)i.push(u);else{const t=Vf(r,c);null!=t&&(i.push(u),o.set(u,t))}}));const u=new Ds(i);return new kf(o,u,s.fieldTransforms)}function Lf(t,e,n,r,s,i){const o=t.da(1,e,n),u=[jf(e,r,n)],c=[s];if(i.length%2!=0)throw new Sr(kr.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)u.push(jf(e,i[t])),c.push(i[t+1]);const l=[],h=hi.empty();for(let t=u.length-1;t>=0;--t)if(!zf(l,u[t])){const e=u[t];let n=c[t];n=(0,a.m9)(n);const r=o.ca(e);if(n instanceof Df)l.push(e);else{const t=Vf(n,r);null!=t&&(l.push(e),h.set(e,t))}}const d=new Ds(l);return new kf(h,d,o.fieldTransforms)}function Pf(t,e,n,r=!1){return Vf(n,t.da(r?4:3,e))}function Vf(t,e){if(Uf(t=(0,a.m9)(t)))return qf("Unsupported field value:",e,t),Bf(t,e);if(t instanceof wf)return function(t,e){if(!Sf(e.sa))throw e.ha(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.ha(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Vf(s,e.aa(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,a.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return eo(e.It,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ur.fromDate(t);return{timestampValue:ca(e.It,n)}}if(t instanceof Ur){const n=new Ur(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ca(e.It,n)}}if(t instanceof bf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof mf)return{bytesValue:la(e.It,t._byteString)};if(t instanceof bd){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:fa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.ha(`Unsupported field value: ${fd(t)}`)}(t,e)}function Bf(t,e){const n={};return Es(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Is(t,((t,r)=>{const s=Vf(r,e.ra(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function Uf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ur||t instanceof bf||t instanceof mf||t instanceof bd||t instanceof wf)}function qf(t,e,n){if(!Uf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=fd(n);throw"an object"===r?e.ha(t+" a custom object"):e.ha(t+" "+r)}}function jf(t,e,n){if((e=(0,a.m9)(e))instanceof yf)return e._internalPath;if("string"==typeof e)return Gf(t,e);throw $f("Field path arguments must be of type string or ",t,!1,void 0,n)}const Kf=new RegExp("[~\\*/\\[\\]]");function Gf(t,e,n){if(e.search(Kf)>=0)throw $f(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new yf(...e.split("."))._internalPath}catch(r){throw $f(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function $f(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new Sr(kr.INVALID_ARGUMENT,a+t+u)}function zf(t,e){return t.some((t=>t.isEqual(e)))}class Hf{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new bd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Qf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Wf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Qf extends Hf{data(){return super.data()}}function Wf(t,e){return"string"==typeof e?Gf(t,e):e instanceof yf?e._internalPath:e._delegate._internalPath}function Yf(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Sr(kr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xf{}function Zf(t,...e){for(const n of e)t=n._apply(t);return t}class Jf extends Xf{constructor(t,e,n){super(),this.ma=t,this.ga=e,this.ya=n,this.type="where"}_apply(t){const e=Af(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Sr(kr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){pp(o,i);const e=[];for(const n of o)e.push(fp(r,t,n));a={arrayValue:{values:e}}}else a=fp(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||pp(o,i),a=Pf(n,"where",o,"in"===i||"not-in"===i);const u=Ei.create(s,i,a);return function(t,e){if(e.dt()){const n=qi(t);if(null!==n&&!n.isEqual(e.field))throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=Ui(t);null!==r&&gp(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Sr(kr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Sr(kr.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t._query,0,e,t.firestore._databaseId,this.ma,this.ga,this.ya);return new Id(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function tp(t,e,n){const r=e,s=Wf("where",t);return new Jf(s,r,n)}class ep extends Xf{constructor(t,e){super(),this.ma=t,this.pa=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Sr(kr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Sr(kr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Fi(e,n);return function(t,e){if(null===Ui(t)){const n=qi(t);null!==n&&gp(0,n,e.field)}}(t,r),r}(t._query,this.ma,this.pa);return new Id(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Li(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function np(t,e="asc"){const n=e,r=Wf("orderBy",t);return new ep(r,n)}class rp extends Xf{constructor(t,e,n){super(),this.type=t,this.Ia=e,this.Ta=n}_apply(t){return new Id(t.firestore,t.converter,$i(t._query,this.Ia,this.Ta))}}function sp(t){return gd("limit",t),new rp("limit",t,"F")}function ip(t){return gd("limitToLast",t),new rp("limitToLast",t,"L")}class op extends Xf{constructor(t,e,n){super(),this.type=t,this.Ea=e,this.Aa=n}_apply(t){const e=dp(t,this.type,this.Ea,this.Aa);return new Id(t.firestore,t.converter,function(t,e){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function ap(...t){return new op("startAt",t,!0)}function up(...t){return new op("startAfter",t,!1)}class cp extends Xf{constructor(t,e,n){super(),this.type=t,this.Ea=e,this.Aa=n}_apply(t){const e=dp(t,this.type,this.Ea,this.Aa);return new Id(t.firestore,t.converter,function(t,e){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function lp(...t){return new cp("endBefore",t,!1)}function hp(...t){return new cp("endAt",t,!0)}function dp(t,e,n,r){if(n[0]=(0,a.m9)(n[0]),n[0]instanceof Hf)return function(t,e,n,r,s){if(!r)throw new Sr(kr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Ki(t))if(n.field.isKeyField())i.push(Js(e,r.key));else{const t=r.data.field(n.field);if(Ls(t))throw new Sr(kr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new Ni(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=Af(t.firestore);return function(t,e,n,r,s,i){const o=t.explicitOrderBy;if(s.length>o.length)throw new Sr(kr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const u=s[i];if(o[i].field.isKeyField()){if("string"!=typeof u)throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!ji(t)&&-1!==u.indexOf("/"))throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Kr.fromString(u));if(!zr.isDocumentKey(n))throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new zr(n);a.push(Js(e,s))}else{const t=Pf(n,r,u);a.push(t)}}return new Ni(a,i)}(t._query,t.firestore._databaseId,s,e,n,r)}}function fp(t,e,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new Sr(kr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ji(e)&&-1!==n.indexOf("/"))throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Kr.fromString(n));if(!zr.isDocumentKey(r))throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Js(t,new zr(r))}if(n instanceof bd)return Js(t,n._key);throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fd(n)}.`)}function pp(t,e){if(!Array.isArray(t)||0===t.length)throw new Sr(kr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Sr(kr.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function gp(t,e,n){if(!n.isEqual(e))throw new Sr(kr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class mp{convertValue(t,e="none"){switch(zs(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Rs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Os(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw wr()}}convertObject(t,e){const n={};return Is(t.fields,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new bf(Rs(t.latitude),Rs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ps(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Vs(t));default:return null}}convertTimestamp(t){const e=Ms(t);return new Ur(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Kr.fromString(t);br(La(n));const r=new Us(n.get(1),n.get(3)),s=new zr(n.popFirst(5));return r.isEqual(e)||mr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function yp(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class vp extends mp{constructor(t){super(),this.firestore=t}convertBytes(t){return new mf(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new bd(this.firestore,null,e)}}class wp{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class bp extends Hf{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ip(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Wf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ip extends bp{data(t={}){return super.data(t)}}class Ep{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new wp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Ip(this._firestore,this._userDataWriter,n.key,n,new wp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Sr(kr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Ip(t._firestore,t._userDataWriter,n.doc.key,n.doc,new wp(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Ip(t._firestore,t._userDataWriter,e.doc.key,e.doc,new wp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:kp(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function kp(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return wr()}}function Sp(t,e){return t instanceof bp&&e instanceof bp?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ep&&e instanceof Ep&&t._firestore===e._firestore&&Ad(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function _p(t){t=pd(t,bd);const e=pd(t.firestore,Jd);return Hd(nf(e),t._key).then((n=>Bp(e,t,n)))}class Tp extends mp{constructor(t){super(),this.firestore=t}convertBytes(t){return new mf(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new bd(this.firestore,null,e)}}function Ap(t){t=pd(t,bd);const e=pd(t.firestore,Jd),n=nf(e),r=new Tp(e);return function(t,e){const n=new _r;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await function(t,e){const n=Er(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Sr(kr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=ch(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await jd(t),e,n))),n.promise}(n,t._key).then((n=>new bp(e,r,t._key,n,new wp(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Cp(t){t=pd(t,bd);const e=pd(t.firestore,Jd);return Hd(nf(e),t._key,{source:"server"}).then((n=>Bp(e,t,n)))}function Dp(t){t=pd(t,Id);const e=pd(t.firestore,Jd),n=nf(e),r=new Tp(e);return Yf(t._query),Qd(n,t._query).then((n=>new Ep(e,r,t,n)))}function xp(t){t=pd(t,Id);const e=pd(t.firestore,Jd),n=nf(e),r=new Tp(e);return function(t,e){const n=new _r;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await sl(t,e,!0),s=new Ah(e,r.Hi),i=s.Wu(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const r=ch(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await jd(t),e,n))),n.promise}(n,t._query).then((n=>new Ep(e,r,t,n)))}function Np(t){t=pd(t,Id);const e=pd(t.firestore,Jd),n=nf(e),r=new Tp(e);return Qd(n,t._query,{source:"server"}).then((n=>new Ep(e,r,t,n)))}function Fp(t,e,n){t=pd(t,bd);const r=pd(t.firestore,Jd),s=yp(t.converter,e,n);return Vp(r,[Cf(Af(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,yo.none())])}function Mp(t,e,n,...r){t=pd(t,bd);const s=pd(t.firestore,Jd),i=Af(s);let o;return o="string"==typeof(e=(0,a.m9)(e))||e instanceof yf?Lf(i,"updateDoc",t._key,e,n,r):Of(i,"updateDoc",t._key,e),Vp(s,[o.toMutation(t._key,yo.exists(!0))])}function Rp(t){return Vp(pd(t.firestore,Jd),[new xo(t._key,yo.none())])}function Op(t,e){const n=pd(t.firestore,Jd),r=_d(t),s=yp(t.converter,e);return Vp(n,[Cf(Af(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,yo.exists(!1))]).then((()=>r))}function Lp(t,...e){var n,r,s;t=(0,a.m9)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Yd(e[o])||(i=e[o],o++);const u={includeMetadataChanges:i.includeMetadataChanges};if(Yd(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let c,l,h;if(t instanceof bd)l=pd(t.firestore,Jd),h=Vi(t._key.path),c={next:n=>{e[o]&&e[o](Bp(l,t,n))},error:e[o+1],complete:e[o+2]};else{const n=pd(t,Id);l=pd(n.firestore,Jd),h=n._query;const r=new Tp(l);c={next:t=>{e[o]&&e[o](new Ep(l,r,n,t))},error:e[o+1],complete:e[o+2]},Yf(t._query)}return function(t,e,n,r){const s=new Dd(r),i=new bh(e,s,n);return t.asyncQueue.enqueueAndForget((async()=>gh(await zd(t),i))),()=>{s.bc(),t.asyncQueue.enqueueAndForget((async()=>mh(await zd(t),i)))}}(nf(l),h,u,c)}function Pp(t,e){return function(t,e){const n=new Dd(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){Er(t).Ru.add(e),e.next()}(await zd(t),n))),()=>{n.bc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){Er(t).Ru.delete(e)}(await zd(t),n)))}}(nf(t=pd(t,Jd)),Yd(e)?e:{next:e})}function Vp(t,e){return function(t,e){const n=new _r;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=sd(t);try{const t=await function(t,e){const n=Er(t),r=Ur.now(),s=e.reduce(((t,e)=>t.add(e.key)),Qo());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Bo(),u=Qo();return n.Gi.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(u=u.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=ko(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new To(t.key,e,di(e.value.mapValue),yo.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,u);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:jo(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.hc[t.currentUser.toKey()];r||(r=new ks(Pr)),r=r.insert(e,n),t.hc[t.currentUser.toKey()]=r}(r,t.batchId,n),await zh(r,t.changes),await Wl(r.remoteStore)}catch(t){const e=ch(t,"Failed to persist write");n.reject(e)}}(await Gd(t),e,n))),n.promise}(nf(t),e)}function Bp(t,e,n){const r=n.docs.get(e._key),s=new Tp(t);return new bp(t,s,e._key,r,new wp(n.hasPendingWrites,n.fromCache),e.converter)}function Up(t,e){return Ad(t.query,e.query)&&(0,a.vZ)(t.data(),e.data())}function qp(t){const e=pd(t.firestore,Jd);return function(t,e,n){const r=new _r;return t.asyncQueue.enqueueAndForget((async()=>{try{if(jl(await Kd(t))){const s=await $d(t),i=new Md(e,s,n).run();r.resolve(i)}else r.reject(new Sr(kr.UNAVAILABLE,"Failed to get count result because the client is offline."))}catch(t){r.reject(t)}})),r.promise}(nf(e),t,new Tp(e))}const jp={maxAttempts:5};class Kp{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Af(t)}set(t,e,n){this._verifyNotCommitted();const r=Gp(t,this._firestore),s=yp(r.converter,e,n),i=Cf(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,yo.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const s=Gp(t,this._firestore);let i;return i="string"==typeof(e=(0,a.m9)(e))||e instanceof yf?Lf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Of(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(i.toMutation(s._key,yo.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Gp(t,this._firestore);return this._mutations=this._mutations.concat(new xo(e._key,yo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Sr(kr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Gp(t,e){if((t=(0,a.m9)(t)).firestore!==e)throw new Sr(kr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class $p extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Af(t)}get(t){const e=Gp(t,this._firestore),n=new vp(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return wr();const r=t[0];if(r.isFoundDocument())return new Hf(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new Hf(this._firestore,n,e._key,null,e.converter);throw wr()}))}set(t,e,n){const r=Gp(t,this._firestore),s=yp(r.converter,e,n),i=Cf(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(t,e,n,...r){const s=Gp(t,this._firestore);let i;return i="string"==typeof(e=(0,a.m9)(e))||e instanceof yf?Lf(this._dataReader,"Transaction.update",s._key,e,n,r):Of(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,i),this}delete(t){const e=Gp(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Gp(t,this._firestore),n=new Tp(this._firestore);return super.get(t).then((t=>new bp(this._firestore,n,e._key,t._document,new wp(!1,!1),e.converter)))}}function zp(t,e,n){t=pd(t,Jd);const r=Object.assign(Object.assign({},jp),n);return function(t){if(t.maxAttempts<1)throw new Sr(kr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(t,e,n){const r=new _r;return t.asyncQueue.enqueueAndForget((async()=>{const s=await $d(t);new Od(t.asyncQueue,s,n,e,r).run()})),r.promise}(nf(t),(n=>e(new $p(t,n))),r)}function Hp(){return new Df("deleteField")}function Qp(){return new Nf("serverTimestamp")}function Wp(...t){return new Ff("arrayUnion",t)}function Yp(...t){return new Mf("arrayRemove",t)}function Xp(t){return new Rf("increment",t)}function Zp(t){return nf(t=pd(t,Jd)),new Kp(t,(e=>Vp(t,e)))}function Jp(t,e){var n;const r=nf(t=pd(t,Jd));if(!(null===(n=r.offlineComponents)||void 0===n?void 0:n.indexBackfillerScheduler))return yr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const s=function(t){const e="string"==typeof t?function(t){var e;try{return JSON.parse(t)}catch(t){throw new Sr(kr.INVALID_ARGUMENT,"Failed to parse JSON: "+(null===(e=t)||void 0===e?void 0:e.message))}}(t):t,n=[];if(Array.isArray(e.indexes))for(const t of e.indexes){const e=tg(t,"collectionGroup"),r=[];if(Array.isArray(t.fields))for(const e of t.fields){const t=Gf("setIndexConfiguration",tg(e,"fieldPath"));"CONTAINS"===e.arrayConfig?r.push(new Xr(t,2)):"ASCENDING"===e.order?r.push(new Xr(t,0)):"DESCENDING"===e.order&&r.push(new Xr(t,1))}n.push(new Hr(Hr.UNKNOWN_ID,e,r,Jr.empty()))}return n}(e);return jd(r).then((t=>async function(t,e){const n=Er(t),r=n.indexManager,s=[];return n.persistence.runTransaction("Configure indexes","readwrite",(t=>r.getFieldIndexes(t).next((n=>function(t,e,n,r,s){t=[...t],e=[...e],t.sort(n),e.sort(n);const i=t.length,o=e.length;let a=0,u=0;for(;a<o&&u<i;){const i=n(t[u],e[a]);i<0?s(t[u++]):i>0?r(e[a++]):(a++,u++)}for(;a<o;)r(e[a++]);for(;u<i;)s(t[u++])}(n,e,Yr,(e=>{s.push(r.addFieldIndex(t,e))}),(e=>{s.push(r.deleteFieldIndex(t,e))})))).next((()=>as.waitFor(s)))))}(t,s)))}function tg(t,e){if("string"!=typeof t[e])throw new Sr(kr.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}!function(t,e=!0){!function(t){hr=t}(s.Jn),(0,s.Xd)(new i.wA("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Jd(new Dr(t.getProvider("auth-internal")),new Mr(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Sr(kr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Us(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),(0,s.KN)(cr,"3.7.3",t),(0,s.KN)(cr,"3.7.3","esm2017")}()},131:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function l(t,e){if(null==t)return{};var n,r,s=function(t,e){if(null==t)return{};var n,r,s={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(s[n]=t[n]);return s}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function h(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=u(t);if(e){var s=u(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return h(this,n)}}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=f(t,e);if(r){var s=Object.getOwnPropertyDescriptor(r,e);return s.get?s.get.call(arguments.length<3?t:n):s.value}},p.apply(this,arguments)}function g(t,e,n,r){return g="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,n,r){var s,i=f(t,e);if(i){if((s=Object.getOwnPropertyDescriptor(i,e)).set)return s.set.call(r,n),!0;if(!s.writable)return!1}if(s=Object.getOwnPropertyDescriptor(r,e)){if(!s.writable)return!1;s.value=n,Object.defineProperty(r,e,s)}else!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(r,e,n);return!0},g(t,e,n,r)}function m(t,e,n,r,s){if(!g(t,e,n,r||t)&&s)throw new Error("failed to set property");return n}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,s,i=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}return i}}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){if(t){if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.r(e),n.d(e,{HTMLContenteditableMaskElement:()=>X,HTMLMaskElement:()=>Y,InputMask:()=>J,MaskElement:()=>W,Masked:()=>R,MaskedDate:()=>Q,MaskedDynamic:()=>it,MaskedEnum:()=>tt,MaskedFunction:()=>rt,MaskedNumber:()=>nt,MaskedPattern:()=>z,MaskedRange:()=>H,MaskedRegExp:()=>G,PIPE_TYPE:()=>ot,createMask:()=>L,createPipe:()=>at,default:()=>M,pipe:()=>ut});var b=function(){function t(e){s(this,t),Object.assign(this,{inserted:"",rawInserted:"",skip:!1,tailShift:0},e)}return o(t,[{key:"aggregate",value:function(t){return this.rawInserted+=t.rawInserted,this.skip=this.skip||t.skip,this.inserted+=t.inserted,this.tailShift+=t.tailShift,this}},{key:"offset",get:function(){return this.tailShift+this.inserted.length}}]),t}();function I(t){return"string"==typeof t||t instanceof String}var E="NONE",k="LEFT",S="FORCE_LEFT",_="RIGHT",T="FORCE_RIGHT";function A(t){switch(t){case k:return S;case _:return T;default:return t}}function C(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function D(t){return Array.isArray(t)?t:[t,new b]}function x(t,e){if(e===t)return!0;var n,s=Array.isArray(e),i=Array.isArray(t);if(s&&i){if(e.length!=t.length)return!1;for(n=0;n<e.length;n++)if(!x(e[n],t[n]))return!1;return!0}if(s!=i)return!1;if(e&&t&&"object"===r(e)&&"object"===r(t)){var o=e instanceof Date,a=t instanceof Date;if(o&&a)return e.getTime()==t.getTime();if(o!=a)return!1;var u=e instanceof RegExp,c=t instanceof RegExp;if(u&&c)return e.toString()==t.toString();if(u!=c)return!1;var l=Object.keys(e);for(n=0;n<l.length;n++)if(!Object.prototype.hasOwnProperty.call(t,l[n]))return!1;for(n=0;n<l.length;n++)if(!x(t[l[n]],e[l[n]]))return!1;return!0}return!(!e||!t||"function"!=typeof e||"function"!=typeof t)&&e.toString()===t.toString()}var N=function(){function t(e,n,r,i){for(s(this,t),this.value=e,this.cursorPos=n,this.oldValue=r,this.oldSelection=i;this.value.slice(0,this.startChangePos)!==this.oldValue.slice(0,this.startChangePos);)--this.oldSelection.start}return o(t,[{key:"startChangePos",get:function(){return Math.min(this.cursorPos,this.oldSelection.start)}},{key:"insertedCount",get:function(){return this.cursorPos-this.startChangePos}},{key:"inserted",get:function(){return this.value.substr(this.startChangePos,this.insertedCount)}},{key:"removedCount",get:function(){return Math.max(this.oldSelection.end-this.startChangePos||this.oldValue.length-this.value.length,0)}},{key:"removed",get:function(){return this.oldValue.substr(this.startChangePos,this.removedCount)}},{key:"head",get:function(){return this.value.substring(0,this.startChangePos)}},{key:"tail",get:function(){return this.value.substring(this.startChangePos+this.insertedCount)}},{key:"removeDirection",get:function(){return!this.removedCount||this.insertedCount?E:this.oldSelection.end!==this.cursorPos&&this.oldSelection.start!==this.cursorPos||this.oldSelection.end!==this.oldSelection.start?k:_}}]),t}(),F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;s(this,t),this.value=e,this.from=n,this.stop=r}return o(t,[{key:"toString",value:function(){return this.value}},{key:"extend",value:function(t){this.value+=String(t)}},{key:"appendTo",value:function(t){return t.append(this.toString(),{tail:!0}).aggregate(t._appendPlaceholder())}},{key:"state",get:function(){return{value:this.value,from:this.from,stop:this.stop}},set:function(t){Object.assign(this,t)}},{key:"unshift",value:function(t){if(!this.value.length||null!=t&&this.from>=t)return"";var e=this.value[0];return this.value=this.value.slice(1),e}},{key:"shift",value:function(){if(!this.value.length)return"";var t=this.value[this.value.length-1];return this.value=this.value.slice(0,-1),t}}]),t}();function M(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new M.InputMask(t,e)}var R=function(){function t(e){s(this,t),this._value="",this._update(Object.assign({},t.DEFAULTS,e)),this.isInitialized=!0}return o(t,[{key:"updateOptions",value:function(t){Object.keys(t).length&&this.withValueRefresh(this._update.bind(this,t))}},{key:"_update",value:function(t){Object.assign(this,t)}},{key:"state",get:function(){return{_value:this.value}},set:function(t){this._value=t._value}},{key:"reset",value:function(){this._value=""}},{key:"value",get:function(){return this._value},set:function(t){this.resolve(t)}},{key:"resolve",value:function(t){return this.reset(),this.append(t,{input:!0},""),this.doCommit(),this.value}},{key:"unmaskedValue",get:function(){return this.value},set:function(t){this.reset(),this.append(t,{},""),this.doCommit()}},{key:"typedValue",get:function(){return this.doParse(this.value)},set:function(t){this.value=this.doFormat(t)}},{key:"rawInputValue",get:function(){return this.extractInput(0,this.value.length,{raw:!0})},set:function(t){this.reset(),this.append(t,{raw:!0},""),this.doCommit()}},{key:"isComplete",get:function(){return!0}},{key:"isFilled",get:function(){return this.isComplete}},{key:"nearestInputPos",value:function(t,e){return t}},{key:"extractInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length;return this.value.slice(t,e)}},{key:"extractTail",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length;return new F(this.extractInput(t,e),t)}},{key:"appendTail",value:function(t){return I(t)&&(t=new F(String(t))),t.appendTo(this)}},{key:"_appendCharRaw",value:function(t){return t?(this._value+=t,new b({inserted:t,rawInserted:t})):new b}},{key:"_appendChar",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=this.state,i=D(this.doPrepare(t,n)),o=y(i,2);if(t=o[0],(e=(e=o[1]).aggregate(this._appendCharRaw(t,n))).inserted){var a,u=!1!==this.doValidate(n);if(u&&null!=r){var c=this.state;!0===this.overwrite&&(a=r.state,r.unshift(this.value.length));var l=this.appendTail(r);(u=l.rawInserted===r.toString())&&l.inserted||"shift"!==this.overwrite||(this.state=c,a=r.state,r.shift(),u=(l=this.appendTail(r)).rawInserted===r.toString()),u&&l.inserted&&(this.state=c)}u||(e=new b,this.state=s,r&&a&&(r.state=a))}return e}},{key:"_appendPlaceholder",value:function(){return new b}},{key:"_appendEager",value:function(){return new b}},{key:"append",value:function(t,e,n){if(!I(t))throw new Error("value should be string");var r=new b,s=I(n)?new F(String(n)):n;null!=e&&e.tail&&(e._beforeTailState=this.state);for(var i=0;i<t.length;++i)r.aggregate(this._appendChar(t[i],e,s));return null!=s&&(r.tailShift+=this.appendTail(s).tailShift),this.eager&&null!=e&&e.input&&t&&r.aggregate(this._appendEager()),r}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length;return this._value=this.value.slice(0,t)+this.value.slice(e),new b}},{key:"withValueRefresh",value:function(t){if(this._refreshing||!this.isInitialized)return t();this._refreshing=!0;var e=this.rawInputValue,n=this.value,r=t();return this.rawInputValue=e,this.value&&this.value!==n&&0===n.indexOf(this.value)&&this.append(n.slice(this.value.length),{},""),delete this._refreshing,r}},{key:"runIsolated",value:function(t){if(this._isolated||!this.isInitialized)return t(this);this._isolated=!0;var e=this.state,n=t(this);return this.state=e,delete this._isolated,n}},{key:"doPrepare",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.prepare?this.prepare(t,this,e):t}},{key:"doValidate",value:function(t){return(!this.validate||this.validate(this.value,this,t))&&(!this.parent||this.parent.doValidate(t))}},{key:"doCommit",value:function(){this.commit&&this.commit(this.value,this)}},{key:"doFormat",value:function(t){return this.format?this.format(t,this):t}},{key:"doParse",value:function(t){return this.parse?this.parse(t,this):t}},{key:"splice",value:function(t,e,n,r){var s,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{input:!0},o=t+e,a=this.extractTail(o);this.eager&&(r=A(r),s=this.extractInput(0,o,{raw:!0}));var u=this.nearestInputPos(t,e>1&&0!==t&&!this.eager?E:r),c=new b({tailShift:u-t}).aggregate(this.remove(u));if(this.eager&&r!==E&&s===this.rawInputValue)if(r===S)for(var l;s===this.rawInputValue&&(l=this.value.length);)c.aggregate(new b({tailShift:-1})).aggregate(this.remove(l-1));else r===T&&a.unshift();return c.aggregate(this.append(n,i,a))}},{key:"maskEquals",value:function(t){return this.mask===t}},{key:"typedValueEquals",value:function(e){var n=this.typedValue;return e===n||t.EMPTY_VALUES.includes(e)&&t.EMPTY_VALUES.includes(n)||this.doFormat(e)===this.doFormat(this.typedValue)}}]),t}();function O(t){if(null==t)throw new Error("mask property should be defined");return t instanceof RegExp?M.MaskedRegExp:I(t)?M.MaskedPattern:t instanceof Date||t===Date?M.MaskedDate:t instanceof Number||"number"==typeof t||t===Number?M.MaskedNumber:Array.isArray(t)||t===Array?M.MaskedDynamic:M.Masked&&t.prototype instanceof M.Masked?t:t instanceof M.Masked?t.constructor:t instanceof Function?M.MaskedFunction:(console.warn("Mask not found for mask",t),M.Masked)}function L(t){if(M.Masked&&t instanceof M.Masked)return t;var e=(t=Object.assign({},t)).mask;if(M.Masked&&e instanceof M.Masked)return e;var n=O(e);if(!n)throw new Error("Masked class is not found for provided mask, appropriate module needs to be import manually before creating mask.");return new n(t)}R.DEFAULTS={format:function(t){return t},parse:function(t){return t}},R.EMPTY_VALUES=[void 0,null,""],M.Masked=R,M.createMask=L;var P=["mask"],V={0:/\d/,a:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,"*":/./},B=function(){function t(e){s(this,t);var n=e.mask,r=l(e,P);this.masked=L({mask:n}),Object.assign(this,r)}return o(t,[{key:"reset",value:function(){this.isFilled=!1,this.masked.reset()}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length;return 0===t&&e>=1?(this.isFilled=!1,this.masked.remove(t,e)):new b}},{key:"value",get:function(){return this.masked.value||(this.isFilled&&!this.isOptional?this.placeholderChar:"")}},{key:"unmaskedValue",get:function(){return this.masked.unmaskedValue}},{key:"isComplete",get:function(){return Boolean(this.masked.value)||this.isOptional}},{key:"_appendChar",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isFilled)return new b;var n=this.masked.state,r=this.masked._appendChar(t,e);return r.inserted&&!1===this.doValidate(e)&&(r.inserted=r.rawInserted="",this.masked.state=n),r.inserted||this.isOptional||this.lazy||e.input||(r.inserted=this.placeholderChar),r.skip=!r.inserted&&!this.isOptional,this.isFilled=Boolean(r.inserted),r}},{key:"append",value:function(){var t;return(t=this.masked).append.apply(t,arguments)}},{key:"_appendPlaceholder",value:function(){var t=new b;return this.isFilled||this.isOptional||(this.isFilled=!0,t.inserted=this.placeholderChar),t}},{key:"_appendEager",value:function(){return new b}},{key:"extractTail",value:function(){var t;return(t=this.masked).extractTail.apply(t,arguments)}},{key:"appendTail",value:function(){var t;return(t=this.masked).appendTail.apply(t,arguments)}},{key:"extractInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,n=arguments.length>2?arguments[2]:void 0;return this.masked.extractInput(t,e,n)}},{key:"nearestInputPos",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,n=0,r=this.value.length,s=Math.min(Math.max(t,n),r);switch(e){case k:case S:return this.isComplete?s:n;case _:case T:return this.isComplete?s:r;default:return s}}},{key:"doValidate",value:function(){var t,e;return(t=this.masked).doValidate.apply(t,arguments)&&(!this.parent||(e=this.parent).doValidate.apply(e,arguments))}},{key:"doCommit",value:function(){this.masked.doCommit()}},{key:"state",get:function(){return{masked:this.masked.state,isFilled:this.isFilled}},set:function(t){this.masked.state=t.masked,this.isFilled=t.isFilled}}]),t}(),U=function(){function t(e){s(this,t),Object.assign(this,e),this._value="",this.isFixed=!0}return o(t,[{key:"value",get:function(){return this._value}},{key:"unmaskedValue",get:function(){return this.isUnmasking?this.value:""}},{key:"reset",value:function(){this._isRawInput=!1,this._value=""}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._value.length;return this._value=this._value.slice(0,t)+this._value.slice(e),this._value||(this._isRawInput=!1),new b}},{key:"nearestInputPos",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,n=0,r=this._value.length;switch(e){case k:case S:return n;default:return r}}},{key:"extractInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._value.length,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.raw&&this._isRawInput&&this._value.slice(t,e)||""}},{key:"isComplete",get:function(){return!0}},{key:"isFilled",get:function(){return Boolean(this._value)}},{key:"_appendChar",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new b;if(this._value)return n;var r=this.char===t,s=r&&(this.isUnmasking||e.input||e.raw)&&(!e.raw||!this.eager)&&!e.tail;return s&&(n.rawInserted=this.char),this._value=n.inserted=this.char,this._isRawInput=s&&(e.raw||e.input),n}},{key:"_appendEager",value:function(){return this._appendChar(this.char,{tail:!0})}},{key:"_appendPlaceholder",value:function(){var t=new b;return this._value||(this._value=t.inserted=this.char),t}},{key:"extractTail",value:function(){return arguments.length>1&&void 0!==arguments[1]||this.value.length,new F("")}},{key:"appendTail",value:function(t){return I(t)&&(t=new F(String(t))),t.appendTo(this)}},{key:"append",value:function(t,e,n){var r=this._appendChar(t[0],e);return null!=n&&(r.tailShift+=this.appendTail(n).tailShift),r}},{key:"doCommit",value:function(){}},{key:"state",get:function(){return{_value:this._value,_isRawInput:this._isRawInput}},set:function(t){Object.assign(this,t)}}]),t}(),q=["chunks"],j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s(this,t),this.chunks=e,this.from=n}return o(t,[{key:"toString",value:function(){return this.chunks.map(String).join("")}},{key:"extend",value:function(e){if(String(e)){I(e)&&(e=new F(String(e)));var n=this.chunks[this.chunks.length-1],r=n&&(n.stop===e.stop||null==e.stop)&&e.from===n.from+n.toString().length;if(e instanceof F)r?n.extend(e.toString()):this.chunks.push(e);else if(e instanceof t){if(null==e.stop)for(var s;e.chunks.length&&null==e.chunks[0].stop;)(s=e.chunks.shift()).from+=e.from,this.extend(s);e.toString()&&(e.stop=e.blockIndex,this.chunks.push(e))}}}},{key:"appendTo",value:function(e){if(!(e instanceof M.MaskedPattern))return new F(this.toString()).appendTo(e);for(var n=new b,r=0;r<this.chunks.length&&!n.skip;++r){var s=this.chunks[r],i=e._mapPosToBlock(e.value.length),o=s.stop,a=void 0;if(null!=o&&(!i||i.index<=o)&&((s instanceof t||e._stops.indexOf(o)>=0)&&n.aggregate(e._appendPlaceholder(o)),a=s instanceof t&&e._blocks[o]),a){var u=a.appendTail(s);u.skip=!1,n.aggregate(u),e._value+=u.inserted;var c=s.toString().slice(u.rawInserted.length);c&&n.aggregate(e.append(c,{tail:!0}))}else n.aggregate(e.append(s.toString(),{tail:!0}))}return n}},{key:"state",get:function(){return{chunks:this.chunks.map((function(t){return t.state})),from:this.from,stop:this.stop,blockIndex:this.blockIndex}},set:function(e){var n=e.chunks,r=l(e,q);Object.assign(this,r),this.chunks=n.map((function(e){var n="chunks"in e?new t:new F;return n.state=e,n}))}},{key:"unshift",value:function(t){if(!this.chunks.length||null!=t&&this.from>=t)return"";for(var e=null!=t?t-this.from:t,n=0;n<this.chunks.length;){var r=this.chunks[n],s=r.unshift(e);if(r.toString()){if(!s)break;++n}else this.chunks.splice(n,1);if(s)return s}return""}},{key:"shift",value:function(){if(!this.chunks.length)return"";for(var t=this.chunks.length-1;0<=t;){var e=this.chunks[t],n=e.shift();if(e.toString()){if(!n)break;--t}else this.chunks.splice(t,1);if(n)return n}return""}}]),t}(),K=function(){function t(e,n){s(this,t),this.masked=e,this._log=[];var r=e._mapPosToBlock(n)||(n<0?{index:0,offset:0}:{index:this.masked._blocks.length,offset:0}),i=r.offset,o=r.index;this.offset=i,this.index=o,this.ok=!1}return o(t,[{key:"block",get:function(){return this.masked._blocks[this.index]}},{key:"pos",get:function(){return this.masked._blockStartPos(this.index)+this.offset}},{key:"state",get:function(){return{index:this.index,offset:this.offset,ok:this.ok}},set:function(t){Object.assign(this,t)}},{key:"pushState",value:function(){this._log.push(this.state)}},{key:"popState",value:function(){var t=this._log.pop();return this.state=t,t}},{key:"bindBlock",value:function(){this.block||(this.index<0&&(this.index=0,this.offset=0),this.index>=this.masked._blocks.length&&(this.index=this.masked._blocks.length-1,this.offset=this.block.value.length))}},{key:"_pushLeft",value:function(t){for(this.pushState(),this.bindBlock();0<=this.index;--this.index,this.offset=(null===(e=this.block)||void 0===e?void 0:e.value.length)||0){var e;if(t())return this.ok=!0}return this.ok=!1}},{key:"_pushRight",value:function(t){for(this.pushState(),this.bindBlock();this.index<this.masked._blocks.length;++this.index,this.offset=0)if(t())return this.ok=!0;return this.ok=!1}},{key:"pushLeftBeforeFilled",value:function(){var t=this;return this._pushLeft((function(){if(!t.block.isFixed&&t.block.value)return t.offset=t.block.nearestInputPos(t.offset,S),0!==t.offset||void 0}))}},{key:"pushLeftBeforeInput",value:function(){var t=this;return this._pushLeft((function(){if(!t.block.isFixed)return t.offset=t.block.nearestInputPos(t.offset,k),!0}))}},{key:"pushLeftBeforeRequired",value:function(){var t=this;return this._pushLeft((function(){if(!(t.block.isFixed||t.block.isOptional&&!t.block.value))return t.offset=t.block.nearestInputPos(t.offset,k),!0}))}},{key:"pushRightBeforeFilled",value:function(){var t=this;return this._pushRight((function(){if(!t.block.isFixed&&t.block.value)return t.offset=t.block.nearestInputPos(t.offset,T),t.offset!==t.block.value.length||void 0}))}},{key:"pushRightBeforeInput",value:function(){var t=this;return this._pushRight((function(){if(!t.block.isFixed)return t.offset=t.block.nearestInputPos(t.offset,E),!0}))}},{key:"pushRightBeforeRequired",value:function(){var t=this;return this._pushRight((function(){if(!(t.block.isFixed||t.block.isOptional&&!t.block.value))return t.offset=t.block.nearestInputPos(t.offset,E),!0}))}}]),t}(),G=function(t){a(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return o(n,[{key:"_update",value:function(t){t.mask&&(t.validate=function(e){return e.search(t.mask)>=0}),p(u(n.prototype),"_update",this).call(this,t)}}]),n}(R);M.MaskedRegExp=G;var $=["_blocks"],z=function(t){a(n,t);var e=d(n);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),t.definitions=Object.assign({},V,t.definitions),e.call(this,Object.assign({},n.DEFAULTS,t))}return o(n,[{key:"_update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.definitions=Object.assign({},this.definitions,t.definitions),p(u(n.prototype),"_update",this).call(this,t),this._rebuildMask()}},{key:"_rebuildMask",value:function(){var t=this,e=this.definitions;this._blocks=[],this._stops=[],this._maskedBlocks={};var r=this.mask;if(r&&e)for(var s=!1,i=!1,o=0;o<r.length;++o)if(!this.blocks||"continue"!==function(){var e=r.slice(o),n=Object.keys(t.blocks).filter((function(t){return 0===e.indexOf(t)}));n.sort((function(t,e){return e.length-t.length}));var s=n[0];if(s){var i=L(Object.assign({parent:t,lazy:t.lazy,eager:t.eager,placeholderChar:t.placeholderChar,overwrite:t.overwrite},t.blocks[s]));return i&&(t._blocks.push(i),t._maskedBlocks[s]||(t._maskedBlocks[s]=[]),t._maskedBlocks[s].push(t._blocks.length-1)),o+=s.length-1,"continue"}}()){var a=r[o],u=a in e;if(a!==n.STOP_CHAR)if("{"!==a&&"}"!==a)if("["!==a&&"]"!==a){if(a===n.ESCAPE_CHAR){if(++o,!(a=r[o]))break;u=!1}var c=u?new B({parent:this,lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,mask:e[a],isOptional:i}):new U({char:a,eager:this.eager,isUnmasking:s});this._blocks.push(c)}else i=!i;else s=!s;else this._stops.push(this._blocks.length)}}},{key:"state",get:function(){return Object.assign({},p(u(n.prototype),"state",this),{_blocks:this._blocks.map((function(t){return t.state}))})},set:function(t){var e=t._blocks,r=l(t,$);this._blocks.forEach((function(t,n){return t.state=e[n]})),m(u(n.prototype),"state",r,this,!0)}},{key:"reset",value:function(){p(u(n.prototype),"reset",this).call(this),this._blocks.forEach((function(t){return t.reset()}))}},{key:"isComplete",get:function(){return this._blocks.every((function(t){return t.isComplete}))}},{key:"isFilled",get:function(){return this._blocks.every((function(t){return t.isFilled}))}},{key:"isFixed",get:function(){return this._blocks.every((function(t){return t.isFixed}))}},{key:"isOptional",get:function(){return this._blocks.every((function(t){return t.isOptional}))}},{key:"doCommit",value:function(){this._blocks.forEach((function(t){return t.doCommit()})),p(u(n.prototype),"doCommit",this).call(this)}},{key:"unmaskedValue",get:function(){return this._blocks.reduce((function(t,e){return t+e.unmaskedValue}),"")},set:function(t){m(u(n.prototype),"unmaskedValue",t,this,!0)}},{key:"value",get:function(){return this._blocks.reduce((function(t,e){return t+e.value}),"")},set:function(t){m(u(n.prototype),"value",t,this,!0)}},{key:"appendTail",value:function(t){return p(u(n.prototype),"appendTail",this).call(this,t).aggregate(this._appendPlaceholder())}},{key:"_appendEager",value:function(){var t,e=new b,n=null===(t=this._mapPosToBlock(this.value.length))||void 0===t?void 0:t.index;if(null==n)return e;this._blocks[n].isFilled&&++n;for(var r=n;r<this._blocks.length;++r){var s=this._blocks[r]._appendEager();if(!s.inserted)break;e.aggregate(s)}return e}},{key:"_appendCharRaw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._mapPosToBlock(this.value.length),r=new b;if(!n)return r;for(var s=n.index;;++s){var i,o,a=this._blocks[s];if(!a)break;var u=a._appendChar(t,Object.assign({},e,{_beforeTailState:null===(i=e._beforeTailState)||void 0===i||null===(o=i._blocks)||void 0===o?void 0:o[s]})),c=u.skip;if(r.aggregate(u),c||u.rawInserted)break}return r}},{key:"extractTail",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,r=new j;return e===n||this._forEachBlocksInRange(e,n,(function(e,n,s,i){var o=e.extractTail(s,i);o.stop=t._findStopBefore(n),o.from=t._blockStartPos(n),o instanceof j&&(o.blockIndex=n),r.extend(o)})),r}},{key:"extractInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t===e)return"";var r="";return this._forEachBlocksInRange(t,e,(function(t,e,s,i){r+=t.extractInput(s,i,n)})),r}},{key:"_findStopBefore",value:function(t){for(var e,n=0;n<this._stops.length;++n){var r=this._stops[n];if(!(r<=t))break;e=r}return e}},{key:"_appendPlaceholder",value:function(t){var e=this,n=new b;if(this.lazy&&null==t)return n;var r=this._mapPosToBlock(this.value.length);if(!r)return n;var s=r.index,i=null!=t?t:this._blocks.length;return this._blocks.slice(s,i).forEach((function(r){if(!r.lazy||null!=t){var s=null!=r._blocks?[r._blocks.length]:[],i=r._appendPlaceholder.apply(r,s);e._value+=i.inserted,n.aggregate(i)}})),n}},{key:"_mapPosToBlock",value:function(t){for(var e="",n=0;n<this._blocks.length;++n){var r=this._blocks[n],s=e.length;if(t<=(e+=r.value).length)return{index:n,offset:t-s}}}},{key:"_blockStartPos",value:function(t){return this._blocks.slice(0,t).reduce((function(t,e){return t+e.value.length}),0)}},{key:"_forEachBlocksInRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,n=arguments.length>2?arguments[2]:void 0,r=this._mapPosToBlock(t);if(r){var s=this._mapPosToBlock(e),i=s&&r.index===s.index,o=r.offset,a=s&&i?s.offset:this._blocks[r.index].value.length;if(n(this._blocks[r.index],r.index,o,a),s&&!i){for(var u=r.index+1;u<s.index;++u)n(this._blocks[u],u,0,this._blocks[u].value.length);n(this._blocks[s.index],s.index,0,s.offset)}}}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,r=p(u(n.prototype),"remove",this).call(this,t,e);return this._forEachBlocksInRange(t,e,(function(t,e,n,s){r.aggregate(t.remove(n,s))})),r}},{key:"nearestInputPos",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;if(!this._blocks.length)return 0;var n=new K(this,t);if(e===E)return n.pushRightBeforeInput()?n.pos:(n.popState(),n.pushLeftBeforeInput()?n.pos:this.value.length);if(e===k||e===S){if(e===k){if(n.pushRightBeforeFilled(),n.ok&&n.pos===t)return t;n.popState()}if(n.pushLeftBeforeInput(),n.pushLeftBeforeRequired(),n.pushLeftBeforeFilled(),e===k){if(n.pushRightBeforeInput(),n.pushRightBeforeRequired(),n.ok&&n.pos<=t)return n.pos;if(n.popState(),n.ok&&n.pos<=t)return n.pos;n.popState()}return n.ok?n.pos:e===S?0:(n.popState(),n.ok?n.pos:(n.popState(),n.ok?n.pos:0))}return e===_||e===T?(n.pushRightBeforeInput(),n.pushRightBeforeRequired(),n.pushRightBeforeFilled()?n.pos:e===T?this.value.length:(n.popState(),n.ok?n.pos:(n.popState(),n.ok?n.pos:this.nearestInputPos(t,k)))):t}},{key:"maskedBlock",value:function(t){return this.maskedBlocks(t)[0]}},{key:"maskedBlocks",value:function(t){var e=this,n=this._maskedBlocks[t];return n?n.map((function(t){return e._blocks[t]})):[]}}]),n}(R);z.DEFAULTS={lazy:!0,placeholderChar:"_"},z.STOP_CHAR="`",z.ESCAPE_CHAR="\\",z.InputDefinition=B,z.FixedDefinition=U,M.MaskedPattern=z;var H=function(t){a(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return o(n,[{key:"_matchFrom",get:function(){return this.maxLength-String(this.from).length}},{key:"_update",value:function(t){t=Object.assign({to:this.to||0,from:this.from||0,maxLength:this.maxLength||0},t);var e=String(t.to).length;null!=t.maxLength&&(e=Math.max(e,t.maxLength)),t.maxLength=e;for(var r=String(t.from).padStart(e,"0"),s=String(t.to).padStart(e,"0"),i=0;i<s.length&&s[i]===r[i];)++i;t.mask=s.slice(0,i).replace(/0/g,"\\0")+"0".repeat(e-i),p(u(n.prototype),"_update",this).call(this,t)}},{key:"isComplete",get:function(){return p(u(n.prototype),"isComplete",this)&&Boolean(this.value)}},{key:"boundaries",value:function(t){var e="",n="",r=y(t.match(/^(\D*)(\d*)(\D*)/)||[],3),s=r[1],i=r[2];return i&&(e="0".repeat(s.length)+i,n="9".repeat(s.length)+i),[e=e.padEnd(this.maxLength,"0"),n=n.padEnd(this.maxLength,"9")]}},{key:"doPrepare",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=D(p(u(n.prototype),"doPrepare",this).call(this,t.replace(/\D/g,""),r)),i=y(s,2);if(t=i[0],e=i[1],!this.autofix||!t)return t;var o=String(this.from).padStart(this.maxLength,"0"),a=String(this.to).padStart(this.maxLength,"0"),c=this.value+t;if(c.length>this.maxLength)return"";var l=this.boundaries(c),h=y(l,2),d=h[0],f=h[1];return Number(f)<this.from?o[c.length-1]:Number(d)>this.to?"pad"===this.autofix&&c.length<this.maxLength?["",e.aggregate(this.append(o[c.length-1]+t,r))]:a[c.length-1]:t}},{key:"doValidate",value:function(){var t,e=this.value,r=e.search(/[^0]/);if(-1===r&&e.length<=this._matchFrom)return!0;for(var s=this.boundaries(e),i=y(s,2),o=i[0],a=i[1],c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return this.from<=Number(a)&&Number(o)<=this.to&&(t=p(u(n.prototype),"doValidate",this)).call.apply(t,[this].concat(l))}}]),n}(z);M.MaskedRange=H;var Q=function(t){a(n,t);var e=d(n);function n(t){return s(this,n),e.call(this,Object.assign({},n.DEFAULTS,t))}return o(n,[{key:"_update",value:function(t){t.mask===Date&&delete t.mask,t.pattern&&(t.mask=t.pattern);var e=t.blocks;t.blocks=Object.assign({},n.GET_DEFAULT_BLOCKS()),t.min&&(t.blocks.Y.from=t.min.getFullYear()),t.max&&(t.blocks.Y.to=t.max.getFullYear()),t.min&&t.max&&t.blocks.Y.from===t.blocks.Y.to&&(t.blocks.m.from=t.min.getMonth()+1,t.blocks.m.to=t.max.getMonth()+1,t.blocks.m.from===t.blocks.m.to&&(t.blocks.d.from=t.min.getDate(),t.blocks.d.to=t.max.getDate())),Object.assign(t.blocks,this.blocks,e),Object.keys(t.blocks).forEach((function(e){var n=t.blocks[e];!("autofix"in n)&&"autofix"in t&&(n.autofix=t.autofix)})),p(u(n.prototype),"_update",this).call(this,t)}},{key:"doValidate",value:function(){for(var t,e=this.date,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(t=p(u(n.prototype),"doValidate",this)).call.apply(t,[this].concat(s))&&(!this.isComplete||this.isDateExist(this.value)&&null!=e&&(null==this.min||this.min<=e)&&(null==this.max||e<=this.max))}},{key:"isDateExist",value:function(t){return this.format(this.parse(t,this),this).indexOf(t)>=0}},{key:"date",get:function(){return this.typedValue},set:function(t){this.typedValue=t}},{key:"typedValue",get:function(){return this.isComplete?p(u(n.prototype),"typedValue",this):null},set:function(t){m(u(n.prototype),"typedValue",t,this,!0)}},{key:"maskEquals",value:function(t){return t===Date||p(u(n.prototype),"maskEquals",this).call(this,t)}}]),n}(z);Q.DEFAULTS={pattern:"d{.}`m{.}`Y",format:function(t){return t?[String(t.getDate()).padStart(2,"0"),String(t.getMonth()+1).padStart(2,"0"),t.getFullYear()].join("."):""},parse:function(t){var e=y(t.split("."),3),n=e[0],r=e[1],s=e[2];return new Date(s,r-1,n)}},Q.GET_DEFAULT_BLOCKS=function(){return{d:{mask:H,from:1,to:31,maxLength:2},m:{mask:H,from:1,to:12,maxLength:2},Y:{mask:H,from:1900,to:9999}}},M.MaskedDate=Q;var W=function(){function t(){s(this,t)}return o(t,[{key:"selectionStart",get:function(){var t;try{t=this._unsafeSelectionStart}catch(t){}return null!=t?t:this.value.length}},{key:"selectionEnd",get:function(){var t;try{t=this._unsafeSelectionEnd}catch(t){}return null!=t?t:this.value.length}},{key:"select",value:function(t,e){if(null!=t&&null!=e&&(t!==this.selectionStart||e!==this.selectionEnd))try{this._unsafeSelect(t,e)}catch(t){}}},{key:"_unsafeSelect",value:function(t,e){}},{key:"isActive",get:function(){return!1}},{key:"bindEvents",value:function(t){}},{key:"unbindEvents",value:function(){}}]),t}();M.MaskElement=W;var Y=function(t){a(n,t);var e=d(n);function n(t){var r;return s(this,n),(r=e.call(this)).input=t,r._handlers={},r}return o(n,[{key:"rootElement",get:function(){var t,e,n;return null!==(t=null===(e=(n=this.input).getRootNode)||void 0===e?void 0:e.call(n))&&void 0!==t?t:document}},{key:"isActive",get:function(){return this.input===this.rootElement.activeElement}},{key:"_unsafeSelectionStart",get:function(){return this.input.selectionStart}},{key:"_unsafeSelectionEnd",get:function(){return this.input.selectionEnd}},{key:"_unsafeSelect",value:function(t,e){this.input.setSelectionRange(t,e)}},{key:"value",get:function(){return this.input.value},set:function(t){this.input.value=t}},{key:"bindEvents",value:function(t){var e=this;Object.keys(t).forEach((function(r){return e._toggleEventHandler(n.EVENTS_MAP[r],t[r])}))}},{key:"unbindEvents",value:function(){var t=this;Object.keys(this._handlers).forEach((function(e){return t._toggleEventHandler(e)}))}},{key:"_toggleEventHandler",value:function(t,e){this._handlers[t]&&(this.input.removeEventListener(t,this._handlers[t]),delete this._handlers[t]),e&&(this.input.addEventListener(t,e),this._handlers[t]=e)}}]),n}(W);Y.EVENTS_MAP={selectionChange:"keydown",input:"input",drop:"drop",click:"click",focus:"focus",commit:"blur"},M.HTMLMaskElement=Y;var X=function(t){a(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return o(n,[{key:"_unsafeSelectionStart",get:function(){var t=this.rootElement,e=t.getSelection&&t.getSelection(),n=e&&e.anchorOffset,r=e&&e.focusOffset;return null==r||null==n||n<r?n:r}},{key:"_unsafeSelectionEnd",get:function(){var t=this.rootElement,e=t.getSelection&&t.getSelection(),n=e&&e.anchorOffset,r=e&&e.focusOffset;return null==r||null==n||n>r?n:r}},{key:"_unsafeSelect",value:function(t,e){if(this.rootElement.createRange){var n=this.rootElement.createRange();n.setStart(this.input.firstChild||this.input,t),n.setEnd(this.input.lastChild||this.input,e);var r=this.rootElement,s=r.getSelection&&r.getSelection();s&&(s.removeAllRanges(),s.addRange(n))}}},{key:"value",get:function(){return this.input.textContent},set:function(t){this.input.textContent=t}}]),n}(Y);M.HTMLContenteditableMaskElement=X;var Z=["mask"],J=function(){function t(e,n){s(this,t),this.el=e instanceof W?e:e.isContentEditable&&"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName?new X(e):new Y(e),this.masked=L(n),this._listeners={},this._value="",this._unmaskedValue="",this._saveSelection=this._saveSelection.bind(this),this._onInput=this._onInput.bind(this),this._onChange=this._onChange.bind(this),this._onDrop=this._onDrop.bind(this),this._onFocus=this._onFocus.bind(this),this._onClick=this._onClick.bind(this),this.alignCursor=this.alignCursor.bind(this),this.alignCursorFriendly=this.alignCursorFriendly.bind(this),this._bindEvents(),this.updateValue(),this._onChange()}return o(t,[{key:"mask",get:function(){return this.masked.mask},set:function(t){if(!this.maskEquals(t))if(t instanceof M.Masked||this.masked.constructor!==O(t)){var e=L({mask:t});e.unmaskedValue=this.masked.unmaskedValue,this.masked=e}else this.masked.updateOptions({mask:t})}},{key:"maskEquals",value:function(t){var e;return null==t||(null===(e=this.masked)||void 0===e?void 0:e.maskEquals(t))}},{key:"value",get:function(){return this._value},set:function(t){this.value!==t&&(this.masked.value=t,this.updateControl(),this.alignCursor())}},{key:"unmaskedValue",get:function(){return this._unmaskedValue},set:function(t){this.unmaskedValue!==t&&(this.masked.unmaskedValue=t,this.updateControl(),this.alignCursor())}},{key:"typedValue",get:function(){return this.masked.typedValue},set:function(t){this.masked.typedValueEquals(t)||(this.masked.typedValue=t,this.updateControl(),this.alignCursor())}},{key:"_bindEvents",value:function(){this.el.bindEvents({selectionChange:this._saveSelection,input:this._onInput,drop:this._onDrop,click:this._onClick,focus:this._onFocus,commit:this._onChange})}},{key:"_unbindEvents",value:function(){this.el&&this.el.unbindEvents()}},{key:"_fireEvent",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var s=this._listeners[t];s&&s.forEach((function(t){return t.apply(void 0,n)}))}},{key:"selectionStart",get:function(){return this._cursorChanging?this._changingCursorPos:this.el.selectionStart}},{key:"cursorPos",get:function(){return this._cursorChanging?this._changingCursorPos:this.el.selectionEnd},set:function(t){this.el&&this.el.isActive&&(this.el.select(t,t),this._saveSelection())}},{key:"_saveSelection",value:function(){this.value!==this.el.value&&console.warn("Element value was changed outside of mask. Syncronize mask using `mask.updateValue()` to work properly."),this._selection={start:this.selectionStart,end:this.cursorPos}}},{key:"updateValue",value:function(){this.masked.value=this.el.value,this._value=this.masked.value}},{key:"updateControl",value:function(){var t=this.masked.unmaskedValue,e=this.masked.value,n=this.unmaskedValue!==t||this.value!==e;this._unmaskedValue=t,this._value=e,this.el.value!==e&&(this.el.value=e),n&&this._fireChangeEvents()}},{key:"updateOptions",value:function(t){var e=t.mask,n=l(t,Z),r=!this.maskEquals(e),s=!x(this.masked,n);r&&(this.mask=e),s&&this.masked.updateOptions(n),(r||s)&&this.updateControl()}},{key:"updateCursor",value:function(t){null!=t&&(this.cursorPos=t,this._delayUpdateCursor(t))}},{key:"_delayUpdateCursor",value:function(t){var e=this;this._abortUpdateCursor(),this._changingCursorPos=t,this._cursorChanging=setTimeout((function(){e.el&&(e.cursorPos=e._changingCursorPos,e._abortUpdateCursor())}),10)}},{key:"_fireChangeEvents",value:function(){this._fireEvent("accept",this._inputEvent),this.masked.isComplete&&this._fireEvent("complete",this._inputEvent)}},{key:"_abortUpdateCursor",value:function(){this._cursorChanging&&(clearTimeout(this._cursorChanging),delete this._cursorChanging)}},{key:"alignCursor",value:function(){this.cursorPos=this.masked.nearestInputPos(this.masked.nearestInputPos(this.cursorPos,k))}},{key:"alignCursorFriendly",value:function(){this.selectionStart===this.cursorPos&&this.alignCursor()}},{key:"on",value:function(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this}},{key:"off",value:function(t,e){if(!this._listeners[t])return this;if(!e)return delete this._listeners[t],this;var n=this._listeners[t].indexOf(e);return n>=0&&this._listeners[t].splice(n,1),this}},{key:"_onInput",value:function(t){if(this._inputEvent=t,this._abortUpdateCursor(),!this._selection)return this.updateValue();var e=new N(this.el.value,this.cursorPos,this.value,this._selection),n=this.masked.rawInputValue,r=this.masked.splice(e.startChangePos,e.removed.length,e.inserted,e.removeDirection,{input:!0,raw:!0}).offset,s=n===this.masked.rawInputValue?e.removeDirection:E,i=this.masked.nearestInputPos(e.startChangePos+r,s);s!==E&&(i=this.masked.nearestInputPos(i,E)),this.updateControl(),this.updateCursor(i),delete this._inputEvent}},{key:"_onChange",value:function(){this.value!==this.el.value&&this.updateValue(),this.masked.doCommit(),this.updateControl(),this._saveSelection()}},{key:"_onDrop",value:function(t){t.preventDefault(),t.stopPropagation()}},{key:"_onFocus",value:function(t){this.alignCursorFriendly()}},{key:"_onClick",value:function(t){this.alignCursorFriendly()}},{key:"destroy",value:function(){this._unbindEvents(),this._listeners.length=0,delete this.el}}]),t}();M.InputMask=J;var tt=function(t){a(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return o(n,[{key:"_update",value:function(t){t.enum&&(t.mask="*".repeat(t.enum[0].length)),p(u(n.prototype),"_update",this).call(this,t)}},{key:"doValidate",value:function(){for(var t,e=this,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return this.enum.some((function(t){return t.indexOf(e.unmaskedValue)>=0}))&&(t=p(u(n.prototype),"doValidate",this)).call.apply(t,[this].concat(s))}}]),n}(z);M.MaskedEnum=tt;var et,nt=function(t){a(n,t);var e=d(n);function n(t){return s(this,n),e.call(this,Object.assign({},n.DEFAULTS,t))}return o(n,[{key:"_update",value:function(t){p(u(n.prototype),"_update",this).call(this,t),this._updateRegExps()}},{key:"_updateRegExps",value:function(){var t="^"+(this.allowNegative?"[+|\\-]?":""),e=(this.scale?"("+C(this.radix)+"\\d{0,"+this.scale+"})?":"")+"$";this._numberRegExpInput=new RegExp(t+"(0|([1-9]+\\d*))?"+e),this._numberRegExp=new RegExp(t+"\\d*"+e),this._mapToRadixRegExp=new RegExp("["+this.mapToRadix.map(C).join("")+"]","g"),this._thousandsSeparatorRegExp=new RegExp(C(this.thousandsSeparator),"g")}},{key:"_removeThousandsSeparators",value:function(t){return t.replace(this._thousandsSeparatorRegExp,"")}},{key:"_insertThousandsSeparators",value:function(t){var e=t.split(this.radix);return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandsSeparator),e.join(this.radix)}},{key:"doPrepare",value:function(t){var e;t=t.replace(this._mapToRadixRegExp,this.radix);for(var r=this._removeThousandsSeparators(t),s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];var a=D((e=p(u(n.prototype),"doPrepare",this)).call.apply(e,[this,r].concat(i))),c=y(a,2),l=c[0],h=c[1];return t&&!r&&(h.skip=!0),[l,h]}},{key:"_separatorsCount",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0,r=0;r<t;++r)this._value.indexOf(this.thousandsSeparator,r)===r&&(++n,e&&(t+=this.thousandsSeparator.length));return n}},{key:"_separatorsCountFromSlice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._value;return this._separatorsCount(this._removeThousandsSeparators(t).length,!0)}},{key:"extractInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,r=arguments.length>2?arguments[2]:void 0,s=this._adjustRangeWithSeparators(t,e),i=y(s,2);return t=i[0],e=i[1],this._removeThousandsSeparators(p(u(n.prototype),"extractInput",this).call(this,t,e,r))}},{key:"_appendCharRaw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.thousandsSeparator)return p(u(n.prototype),"_appendCharRaw",this).call(this,t,e);var r=e.tail&&e._beforeTailState?e._beforeTailState._value:this._value,s=this._separatorsCountFromSlice(r);this._value=this._removeThousandsSeparators(this.value);var i=p(u(n.prototype),"_appendCharRaw",this).call(this,t,e);this._value=this._insertThousandsSeparators(this._value);var o=e.tail&&e._beforeTailState?e._beforeTailState._value:this._value,a=this._separatorsCountFromSlice(o);return i.tailShift+=(a-s)*this.thousandsSeparator.length,i.skip=!i.rawInserted&&t===this.thousandsSeparator,i}},{key:"_findSeparatorAround",value:function(t){if(this.thousandsSeparator){var e=t-this.thousandsSeparator.length+1,n=this.value.indexOf(this.thousandsSeparator,e);if(n<=t)return n}return-1}},{key:"_adjustRangeWithSeparators",value:function(t,e){var n=this._findSeparatorAround(t);n>=0&&(t=n);var r=this._findSeparatorAround(e);return r>=0&&(e=r+this.thousandsSeparator.length),[t,e]}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.value.length,n=this._adjustRangeWithSeparators(t,e),r=y(n,2);t=r[0],e=r[1];var s=this.value.slice(0,t),i=this.value.slice(e),o=this._separatorsCount(s.length);this._value=this._insertThousandsSeparators(this._removeThousandsSeparators(s+i));var a=this._separatorsCountFromSlice(s);return new b({tailShift:(a-o)*this.thousandsSeparator.length})}},{key:"nearestInputPos",value:function(t,e){if(!this.thousandsSeparator)return t;switch(e){case E:case k:case S:var n=this._findSeparatorAround(t-1);if(n>=0){var r=n+this.thousandsSeparator.length;if(t<r||this.value.length<=r||e===S)return n}break;case _:case T:var s=this._findSeparatorAround(t);if(s>=0)return s+this.thousandsSeparator.length}return t}},{key:"doValidate",value:function(t){var e=(t.input?this._numberRegExpInput:this._numberRegExp).test(this._removeThousandsSeparators(this.value));if(e){var r=this.number;e=e&&!isNaN(r)&&(null==this.min||this.min>=0||this.min<=this.number)&&(null==this.max||this.max<=0||this.number<=this.max)}return e&&p(u(n.prototype),"doValidate",this).call(this,t)}},{key:"doCommit",value:function(){if(this.value){var t=this.number,e=t;null!=this.min&&(e=Math.max(e,this.min)),null!=this.max&&(e=Math.min(e,this.max)),e!==t&&(this.unmaskedValue=String(e));var r=this.value;this.normalizeZeros&&(r=this._normalizeZeros(r)),this.padFractionalZeros&&this.scale>0&&(r=this._padFractionalZeros(r)),this._value=r}p(u(n.prototype),"doCommit",this).call(this)}},{key:"_normalizeZeros",value:function(t){var e=this._removeThousandsSeparators(t).split(this.radix);return e[0]=e[0].replace(/^(\D*)(0*)(\d*)/,(function(t,e,n,r){return e+r})),t.length&&!/\d$/.test(e[0])&&(e[0]=e[0]+"0"),e.length>1&&(e[1]=e[1].replace(/0*$/,""),e[1].length||(e.length=1)),this._insertThousandsSeparators(e.join(this.radix))}},{key:"_padFractionalZeros",value:function(t){if(!t)return t;var e=t.split(this.radix);return e.length<2&&e.push(""),e[1]=e[1].padEnd(this.scale,"0"),e.join(this.radix)}},{key:"unmaskedValue",get:function(){return this._removeThousandsSeparators(this._normalizeZeros(this.value)).replace(this.radix,".")},set:function(t){m(u(n.prototype),"unmaskedValue",t.replace(".",this.radix),this,!0)}},{key:"typedValue",get:function(){return Number(this.unmaskedValue)},set:function(t){m(u(n.prototype),"unmaskedValue",String(t),this,!0)}},{key:"number",get:function(){return this.typedValue},set:function(t){this.typedValue=t}},{key:"allowNegative",get:function(){return this.signed||null!=this.min&&this.min<0||null!=this.max&&this.max<0}},{key:"typedValueEquals",value:function(t){return(p(u(n.prototype),"typedValueEquals",this).call(this,t)||n.EMPTY_VALUES.includes(t)&&n.EMPTY_VALUES.includes(this.typedValue))&&!(0===t&&""===this.value)}}]),n}(R);nt.DEFAULTS={radix:",",thousandsSeparator:"",mapToRadix:["."],scale:2,signed:!1,normalizeZeros:!0,padFractionalZeros:!1},nt.EMPTY_VALUES=[].concat(function(t){if(Array.isArray(t))return w(t)}(et=R.EMPTY_VALUES)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(et)||v(et)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[0]),M.MaskedNumber=nt;var rt=function(t){a(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return o(n,[{key:"_update",value:function(t){t.mask&&(t.validate=t.mask),p(u(n.prototype),"_update",this).call(this,t)}}]),n}(R);M.MaskedFunction=rt;var st=["compiledMasks","currentMaskRef","currentMask"],it=function(t){a(n,t);var e=d(n);function n(t){var r;return s(this,n),(r=e.call(this,Object.assign({},n.DEFAULTS,t))).currentMask=null,r}return o(n,[{key:"_update",value:function(t){p(u(n.prototype),"_update",this).call(this,t),"mask"in t&&(this.compiledMasks=Array.isArray(t.mask)?t.mask.map((function(t){return L(t)})):[])}},{key:"_appendCharRaw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._applyDispatch(t,e);return this.currentMask&&n.aggregate(this.currentMask._appendChar(t,this.currentMaskFlags(e))),n}},{key:"_applyDispatch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.tail&&null!=e._beforeTailState?e._beforeTailState._value:this.value,r=this.rawInputValue,s=e.tail&&null!=e._beforeTailState?e._beforeTailState._rawInputValue:r,i=r.slice(s.length),o=this.currentMask,a=new b,u=null==o?void 0:o.state;if(this.currentMask=this.doDispatch(t,Object.assign({},e)),this.currentMask)if(this.currentMask!==o){if(this.currentMask.reset(),s){var c=this.currentMask.append(s,{raw:!0});a.tailShift=c.inserted.length-n.length}i&&(a.tailShift+=this.currentMask.append(i,{raw:!0,tail:!0}).tailShift)}else this.currentMask.state=u;return a}},{key:"_appendPlaceholder",value:function(){var t=this._applyDispatch.apply(this,arguments);return this.currentMask&&t.aggregate(this.currentMask._appendPlaceholder()),t}},{key:"_appendEager",value:function(){var t=this._applyDispatch.apply(this,arguments);return this.currentMask&&t.aggregate(this.currentMask._appendEager()),t}},{key:"currentMaskFlags",value:function(t){var e,n;return Object.assign({},t,{_beforeTailState:(null===(e=t._beforeTailState)||void 0===e?void 0:e.currentMaskRef)===this.currentMask&&(null===(n=t._beforeTailState)||void 0===n?void 0:n.currentMask)||t._beforeTailState})}},{key:"doDispatch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.dispatch(t,this,e)}},{key:"doValidate",value:function(t){return p(u(n.prototype),"doValidate",this).call(this,t)&&(!this.currentMask||this.currentMask.doValidate(this.currentMaskFlags(t)))}},{key:"doPrepare",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=D(p(u(n.prototype),"doPrepare",this).call(this,t,e)),s=y(r,2),i=s[0],o=s[1];if(this.currentMask){var a,c=D(p(u(n.prototype),"doPrepare",this).call(this,i,this.currentMaskFlags(e))),l=y(c,2);i=l[0],a=l[1],o=o.aggregate(a)}return[i,o]}},{key:"reset",value:function(){var t;null===(t=this.currentMask)||void 0===t||t.reset(),this.compiledMasks.forEach((function(t){return t.reset()}))}},{key:"value",get:function(){return this.currentMask?this.currentMask.value:""},set:function(t){m(u(n.prototype),"value",t,this,!0)}},{key:"unmaskedValue",get:function(){return this.currentMask?this.currentMask.unmaskedValue:""},set:function(t){m(u(n.prototype),"unmaskedValue",t,this,!0)}},{key:"typedValue",get:function(){return this.currentMask?this.currentMask.typedValue:""},set:function(t){var e=String(t);this.currentMask&&(this.currentMask.typedValue=t,e=this.currentMask.unmaskedValue),this.unmaskedValue=e}},{key:"isComplete",get:function(){var t;return Boolean(null===(t=this.currentMask)||void 0===t?void 0:t.isComplete)}},{key:"isFilled",get:function(){var t;return Boolean(null===(t=this.currentMask)||void 0===t?void 0:t.isFilled)}},{key:"remove",value:function(){var t,e=new b;return this.currentMask&&e.aggregate((t=this.currentMask).remove.apply(t,arguments)).aggregate(this._applyDispatch()),e}},{key:"state",get:function(){var t;return Object.assign({},p(u(n.prototype),"state",this),{_rawInputValue:this.rawInputValue,compiledMasks:this.compiledMasks.map((function(t){return t.state})),currentMaskRef:this.currentMask,currentMask:null===(t=this.currentMask)||void 0===t?void 0:t.state})},set:function(t){var e=t.compiledMasks,r=t.currentMaskRef,s=t.currentMask,i=l(t,st);this.compiledMasks.forEach((function(t,n){return t.state=e[n]})),null!=r&&(this.currentMask=r,this.currentMask.state=s),m(u(n.prototype),"state",i,this,!0)}},{key:"extractInput",value:function(){var t;return this.currentMask?(t=this.currentMask).extractInput.apply(t,arguments):""}},{key:"extractTail",value:function(){for(var t,e,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return this.currentMask?(t=this.currentMask).extractTail.apply(t,s):(e=p(u(n.prototype),"extractTail",this)).call.apply(e,[this].concat(s))}},{key:"doCommit",value:function(){this.currentMask&&this.currentMask.doCommit(),p(u(n.prototype),"doCommit",this).call(this)}},{key:"nearestInputPos",value:function(){for(var t,e,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return this.currentMask?(t=this.currentMask).nearestInputPos.apply(t,s):(e=p(u(n.prototype),"nearestInputPos",this)).call.apply(e,[this].concat(s))}},{key:"overwrite",get:function(){return this.currentMask?this.currentMask.overwrite:p(u(n.prototype),"overwrite",this)},set:function(t){console.warn('"overwrite" option is not available in dynamic mask, use this option in siblings')}},{key:"eager",get:function(){return this.currentMask?this.currentMask.eager:p(u(n.prototype),"eager",this)},set:function(t){console.warn('"eager" option is not available in dynamic mask, use this option in siblings')}},{key:"maskEquals",value:function(t){return Array.isArray(t)&&this.compiledMasks.every((function(e,n){var r;return e.maskEquals(null===(r=t[n])||void 0===r?void 0:r.mask)}))}},{key:"typedValueEquals",value:function(t){var e;return Boolean(null===(e=this.currentMask)||void 0===e?void 0:e.typedValueEquals(t))}}]),n}(R);it.DEFAULTS={dispatch:function(t,e,n){if(e.compiledMasks.length){var r=e.rawInputValue,s=e.compiledMasks.map((function(s,i){return s.reset(),s.append(r,{raw:!0}),s.append(t,e.currentMaskFlags(n)),{weight:s.rawInputValue.length,index:i}}));return s.sort((function(t,e){return e.weight-t.weight})),e.compiledMasks[s[0].index]}}},M.MaskedDynamic=it;var ot={MASKED:"value",UNMASKED:"unmaskedValue",TYPED:"typedValue"};function at(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ot.MASKED,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ot.MASKED,r=L(t);return function(t){return r.runIsolated((function(r){return r[e]=t,r[n]}))}}function ut(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return at.apply(void 0,n)(t)}M.PIPE_TYPE=ot,M.createPipe=at,M.pipe=ut;try{globalThis.IMask=M}catch(t){}},92:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=n(706),s=n(591),i=document.querySelector("body[data-display='bandeja']");if(i){const t=i.querySelector("aside ul"),e=i.querySelector("header small"),n=i.querySelector("footer .price");let o=0,a={},u=[];const c=i.querySelectorAll(".category label");let l=[],h=[];const d=(0,s.getFirestore)(),f=[],p=[];(0,s.onSnapshot)((0,s.collection)(d,"Paes"),(t=>{t.forEach((t=>{f.push(t.data())})),console.log("tiposPaes: ",f),g()})),(0,s.onSnapshot)((0,s.collection)(d,"Hamburguer"),(t=>{t.forEach((t=>{p.push(t.data())})),g()})),(0,s.onSnapshot)((0,s.collection)(d,"Ingredientes"),(t=>{t.forEach((t=>{p.push(t.data())})),g()}));const g=()=>{console.log("renderIngredientes")},m=()=>{t.innerHTML=""},y=()=>{h=[],l=[],c.forEach((t=>{if(t.querySelector("input:checked")){const e=t.querySelector("h3")?.innerHTML,n=t.querySelector("div")?.innerHTML,r=parseFloat(n.split(" ")[1].replace(",","."));if(null==e||isNaN(r))console.log("Erro: esse iongrediente no possua descrio ou preo vlido ");else{const t={name:e,price:r};l.push(t),h.push(r)}}})),_()},v=()=>{a={description:"Novo Hamburguer",price:o,ingredients:l}},w=()=>{0==u.length?u.push(a):u[u.length-1]=a;const t=i.querySelector("aside ul");t.innerHTML="",u.forEach((e=>{const n=document.createElement("li");"Novo Hamburguer"==e.description?(n.innerHTML=`<div style="color: white">${e.description}</div>\n\n        <div style="color: white">${(0,r.formatCurrency)(e.price)}</div>\n        <button type="button" aria-label="Remover Hamburguer 1">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z" fill="black"/>\n            </svg>\n        </button>`,n.style.backgroundColor="gray",n.style.outlineStyle="solid",n.style.outlineWidth="3px",n.style.outlineColor="gray",t.appendChild(n)):(n.innerHTML=`<div>${e.description}</div>\n\n        <div>${(0,r.formatCurrency)(e.price)}</div>\n        <button type="button" aria-label="Remover Hamburguer 1">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z" fill="black"/>\n            </svg>\n        </button>`,t.appendChild(n))}))},b=()=>{if(a.price>0){const{price:t}=a,e=`Hamburguer ${u.length}`,n=a.ingredients;let r={price:t,description:e,ingredients:[]};r.ingredients=[...n],u.pop(),u.push(r),u.push(a),u[u.length-1].description="Novo Hamburguer",E(),T()}else alert("Hamburguer vazio! Favor adicionar algum ingrediente ao seu hambrguer.")},I=()=>{switch(u.length){case 0:e.innerText="";break;case 1:e.innerText="Montando Hamburguer...";break;case 2:e.innerText="1 Hamburguer";break;default:e.innerText=u.length-1+" Hamburgueres"}S()},E=()=>{c.forEach((t=>{t.querySelector("input").checked=!1}))},k=()=>{o=h.reduce(((t,e)=>t+e),0)},S=()=>{let t=0;u.forEach((e=>{t+=e.price})),n.innerHTML=`<small>Subtotal</small>${(0,r.formatCurrency)(t)}`},_=()=>{k(),v()},T=()=>{y(),v(),w(),I()};E(),y(),m(),v(),w(),I(),c.forEach((t=>{t.addEventListener("change",(()=>{T()}))})),i.querySelector('button[aria-label="Salvar Hamburguer"]')?.addEventListener("click",(()=>{b()}))}},596:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),(0,n(503).initializeApp)({apiKey:"AIzaSyC05geY2ZWQOSDne-J0_tFRtIH5FcTo6HU",authDomain:"hburger-projeto.firebaseapp.com",projectId:"hburger-projeto",storageBucket:"hburger-projeto.appspot.com",messagingSenderId:"131149991908",appId:"1:131149991908:web:37831fdc2e36c853f4c1f1"})},706:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.formatCurrency=void 0,e.formatCurrency=function(t){return t.toLocaleString("pt-br",{style:"currency",currency:"BRL"})}},560:function(t,e,n){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(n(131)),i=document.querySelector("body[data-display='payment']");if(i){const t=i.querySelector("#cartao"),e=i.querySelector("#validade"),n=i.querySelector("#cvv"),r=(i.querySelector("#nome"),(new Date).getFullYear());(0,s.default)(t,{mask:"0000 0000 0000 0000"}),(0,s.default)(e,{mask:"MM/YY",blocks:{YY:{mask:s.default.MaskedRange,from:String(r).substring(2,4),to:String(r+10).substring(2,4)},MM:{mask:s.default.MaskedRange,from:1,to:12}}}),(0,s.default)(n,{mask:"000"})}},389:(t,e,n)=>{n.d(e,{ZR:()=>i.ZR,Jn:()=>V,l4:()=>T,H9:()=>x,Vr:()=>N,Af:()=>C,Z8:()=>O,lz:()=>D,qX:()=>M,Xd:()=>F,wN:()=>R,P2:()=>j,Mq:()=>U,C6:()=>q,ZF:()=>B,TP:()=>G,KN:()=>K,Ub:()=>$});var r=n(463),s=n(333),i=n(444);let o,a;const u=new WeakMap,c=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap;let f={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return c.get(t);if("objectStoreNames"===e)return t.objectStoreNames||l.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function p(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(m(this),t),g(u.get(this))}:function(...t){return g(e.apply(m(this),t))}:function(t,...n){const r=e.call(m(this),t,...n);return l.set(r,t.sort?t.sort():[t]),g(r)}:(t instanceof IDBTransaction&&function(t){if(c.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));c.set(t,e)}(t),n=t,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,f):t);var e,n}function g(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(g(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&u.set(e,t)})).catch((()=>{})),d.set(e,t),e}(t);if(h.has(t))return h.get(t);const e=p(t);return e!==t&&(h.set(t,e),d.set(e,t)),e}const m=t=>d.get(t),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(w.get(e))return w.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!y.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return w.set(e,i),i}var I;I=f,f={...I,get:(t,e,n)=>b(t,e)||I.get(t,e,n),has:(t,e)=>!!b(t,e)||I.has(t,e)};class E{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const k="@firebase/app",S="0.8.4",_=new s.Yd("@firebase/app"),T="[DEFAULT]",A={[k]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},C=new Map,D=new Map;function x(t,e){try{t.container.addComponent(e)}catch(n){_.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function N(t,e){t.container.addOrOverwriteComponent(e)}function F(t){const e=t.name;if(D.has(e))return _.debug(`There were multiple attempts to register component ${e}.`),!1;D.set(e,t);for(const e of C.values())x(e,t);return!0}function M(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function R(t,e,n=T){M(t,e).clearInstance(n)}function O(){D.clear()}const L=new i.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class P{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw L.create("app-deleted",{appName:this._name})}}const V="9.14.0";function B(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const s=Object.assign({name:T,automaticDataCollectionEnabled:!1},e),o=s.name;if("string"!=typeof o||!o)throw L.create("bad-app-name",{appName:String(o)});if(n||(n=(0,i.aH)()),!n)throw L.create("no-options");const a=C.get(o);if(a){if((0,i.vZ)(n,a.options)&&(0,i.vZ)(s,a.config))return a;throw L.create("duplicate-app",{appName:o})}const u=new r.H0(o);for(const t of D.values())u.addComponent(t);const c=new P(n,s,u);return C.set(o,c),c}function U(t=T){const e=C.get(t);if(!e&&t===T)return B();if(!e)throw L.create("no-app",{appName:t});return e}function q(){return Array.from(C.values())}async function j(t){const e=t.name;C.has(e)&&(C.delete(e),await Promise.all(t.container.getProviders().map((t=>t.delete()))),t.isDeleted=!0)}function K(t,e,n){var s;let i=null!==(s=A[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${i}" with version "${e}":`];return o&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void _.warn(t.join(" "))}F(new r.wA(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}function G(t,e){if(null!==t&&"function"!=typeof t)throw L.create("invalid-log-argument");(0,s.Am)(t,e)}function $(t){(0,s.Ub)(t)}const z="firebase-heartbeat-store";let H=null;function Q(){return H||(H=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=g(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(g(o.result),t.oldVersion,t.newVersion,g(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(z)}}).catch((t=>{throw L.create("idb-open",{originalErrorMessage:t.message})}))),H}async function W(t,e){var n;try{const n=(await Q()).transaction(z,"readwrite"),r=n.objectStore(z);return await r.put(e,Y(t)),n.done}catch(t){if(t instanceof i.ZR)_.warn(t.message);else{const e=L.create("idb-set",{originalErrorMessage:null===(n=t)||void 0===n?void 0:n.message});_.warn(e.message)}}}function Y(t){return`${t.name}!${t.options.appId}`}class X{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new J(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Z();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Z(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),tt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),tt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,i.L)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Z(){return(new Date).toISOString().substring(0,10)}class J{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.hl)()&&(0,i.eu)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(t){var e;try{return(await Q()).transaction(z).objectStore(z).get(Y(t))}catch(t){if(t instanceof i.ZR)_.warn(t.message);else{const n=L.create("idb-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message});_.warn(n.message)}}}(this.app)||{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function tt(t){return(0,i.L)(JSON.stringify({version:2,heartbeats:t})).length}F(new r.wA("platform-logger",(t=>new E(t)),"PRIVATE")),F(new r.wA("heartbeat",(t=>new X(t)),"PRIVATE")),K(k,S,""),K(k,S,"esm2017"),K("fire-js","")},463:(t,e,n)=>{n.d(e,{H0:()=>a,wA:()=>s});var r=n(444);class s{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const i="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.BH;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:i})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===i?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:i:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},333:(t,e,n)=>{n.d(e,{Am:()=>h,Ub:()=>l,Yd:()=>c,in:()=>s});const r=[];var s;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},u=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=a[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class c{constructor(t){this.name=t,this._logLevel=o,this._logHandler=u,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in s))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?i[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...t),this._logHandler(this,s.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...t),this._logHandler(this,s.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,s.INFO,...t),this._logHandler(this,s.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,s.WARN,...t),this._logHandler(this,s.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...t),this._logHandler(this,s.ERROR,...t)}}function l(t){r.forEach((e=>{e.setLogLevel(t)}))}function h(t,e){for(const n of r){let r=null;e&&e.level&&(r=i[e.level]),n.userLogHandler=null===t?null:(e,n,...i)=>{const o=i.map((t=>{if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((t=>t)).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:s[n].toLowerCase(),message:o,args:i,type:e.name})}}}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(596),n(92),n(560)})();